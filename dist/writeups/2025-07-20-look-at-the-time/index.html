<!DOCTYPE html><html lang="en" data-astro-cid-dxom2xcl> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon-dark.svg" media="(prefers-color-scheme: light)"><link rel="icon" type="image/svg+xml" href="/favicon.svg" media="(prefers-color-scheme: dark)"><meta name="generator" content="Astro v4.16.18"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://towerofhanoi.it/writeups/2025-07-20-look-at-the-time/"><!-- Primary Meta Tags --><title>ToH CTF 2025 - Look at the Time!</title><meta name="title" content="ToH CTF 2025 - Look at the Time!"><meta name="description" content="Official writeup for the ToH CTF 2025 challenge &#34;Look at the Time!&#34;"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://towerofhanoi.it/writeups/2025-07-20-look-at-the-time/"><meta property="og:title" content="ToH CTF 2025 - Look at the Time!"><meta property="og:description" content="Official writeup for the ToH CTF 2025 challenge &#34;Look at the Time!&#34;"><meta property="og:image" content="/writeup_images/look-at-the-time.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://towerofhanoi.it/writeups/2025-07-20-look-at-the-time/"><meta property="twitter:title" content="ToH CTF 2025 - Look at the Time!"><meta property="twitter:description" content="Official writeup for the ToH CTF 2025 challenge &#34;Look at the Time!&#34;"><meta property="twitter:image" content="/writeup_images/look-at-the-time.png"><style>:root{--accent: #fea819;--accent-dark: #ac7010;--accent-dark-010: #ac70100a}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}body{font-family:Atkinson,sans-serif;margin:0;padding:0;text-align:left;background:#171717 no-repeat;background-size:100% 600px;word-wrap:break-word;overflow-wrap:break-word;color:#aaa;font-size:20px;line-height:1.25}main{width:720px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em}h1,h2,h3,h4,h5,h6{margin:1em 0 .5rem;color:#fff;line-height:1.2}h1{font-size:3.052em}h2{font-size:2.441em}h3{font-size:1.953em}h4{font-size:1.563em}h5{font-size:1.25em}strong,b{font-weight:700}a,a:hover{color:var(--accent)}p{margin-bottom:1em}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%}img{max-width:100%;height:auto;border-radius:8px}code{padding:0 .3em;background-color:#1f1f1f;border-radius:.2em;font-size:.8em}pre{padding:1em;border-radius:.2em}pre>code{all:unset;font-size:.8em}blockquote{border-left:4px solid var(--accent);padding:.01em 0 .01em 1em;margin:0;background-color:var(--accent-dark-010)}hr{border:none;border-top:1px solid #e9e9e9}@media (max-width: 720px){body{font-size:18px}main{padding:1em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}table{border-collapse:collapse;text-align:center}tr{border:1px solid #e9e9e9}th,td{padding:.5em;text-align:center}th{background-color:#1f1f1f;color:#fff}td{background-color:#1b1b1b}a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:#1f1f1f;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
@media (prefers-color-scheme: dark){.markdown-alert{--color-border-default: #30363d;--color-accent-fg: #58a6ff;--color-accent-emphasis: #1f6feb;--color-danger-fg: #f85149;--color-danger-emphasis: #da3633;--color-attention-fg: #d29922;--color-attention-emphasis: #9e6a03;--color-done-fg: #a371f7;--color-done-emphasis: #8957e5;--color-success-fg: #3fb950;--color-success-emphasis: #238636}}@media (prefers-color-scheme: light){.markdown-alert{--color-border-default: #d0d7de;--color-accent-fg: #0969da;--color-accent-emphasis: #0969da;--color-danger-fg: #d1242f;--color-danger-emphasis: #cf222e;--color-attention-fg: #9a6700;--color-attention-emphasis: #9a6700;--color-done-fg: #8250df;--color-done-emphasis: #8250df;--color-success-fg: #1a7f37;--color-success-emphasis: #1f883d}}.markdown-alert{border-left:.25em solid var(--borderColor-default, var(--color-border-default));color:inherit;margin-bottom:16px;padding:.5rem 1em}.markdown-alert>:last-child{margin-bottom:0!important}.markdown-alert .markdown-alert-title{align-items:center;display:flex;font-size:14px;font-weight:500;line-height:1}.markdown-alert .markdown-alert-title svg.octicon{margin-right:8px!important;margin-right:var(--base-size-8,8px)!important;fill:currentColor}.markdown-alert.markdown-alert-note{border-left-color:var(--borderColor-accent-emphasis,var(--color-accent-emphasis))}.markdown-alert.markdown-alert-note .markdown-alert-title{color:var(--color-accent-fg);color:var(--fgColor-accent,var(--color-accent-fg))}.markdown-alert.markdown-alert-tip{border-left-color:var(--borderColor-success-emphasis,var(--color-success-emphasis))}.markdown-alert.markdown-alert-tip .markdown-alert-title{color:var(--color-success-fg);color:var(--fgColor-success,var(--color-success-fg))}.markdown-alert.markdown-alert-important{border-left-color:var(--borderColor-done-emphasis,var(--color-done-emphasis))}.markdown-alert.markdown-alert-important .markdown-alert-title{color:var(--color-done-fg);color:var(--fgColor-done,var(--color-done-fg))}.markdown-alert.markdown-alert-warning{border-left-color:var(--borderColor-attention-emphasis,var(--color-attention-emphasis))}.markdown-alert.markdown-alert-warning .markdown-alert-title{color:var(--color-attention-fg);color:var(--fgColor-attention,var(--color-attention-fg))}.markdown-alert.markdown-alert-caution{border-left-color:var(--borderColor-danger-emphasis,var(--color-danger-emphasis))}.markdown-alert.markdown-alert-caution .markdown-alert-title{color:var(--color-danger-fg);color:var(--fgColor-danger,var(--color-danger-fg))}main[data-astro-cid-dxom2xcl]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-dxom2xcl]{width:100%}.hero-image[data-astro-cid-dxom2xcl] img[data-astro-cid-dxom2xcl]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-dxom2xcl]{width:75%;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title[data-astro-cid-dxom2xcl]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-dxom2xcl] h1[data-astro-cid-dxom2xcl]{margin:0 0 .5em}.date[data-astro-cid-dxom2xcl]{margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on[data-astro-cid-dxom2xcl]{font-style:italic}
</style></head> <body data-astro-cid-dxom2xcl> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <a href="/" style="padding: 1rem 0 0 0;" data-astro-cid-3ef6ksr2> <img src="/new_tower_logo.png" alt="Tower of Hanoi Logo" width="50rem" height="50rem" style="border-radius: 0;" data-astro-cid-3ef6ksr2> </a> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Home </a>  <a href="/blog" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Blogposts </a>  <a href="/writeups" class="active" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Writeups </a>  <a href="/about" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> About </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://x.com/towerofhanoi" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Tower of Hanoi on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://github.com/towerofhanoi" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Tower of Hanoi's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://ctftime.org/team/300" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Tower of Hanoi's CTF Time page</span> <svg viewBox="0 0 16 16" width="32" height="32" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M 0,0 H 16 V 16 H 0 L 4.7205698,7.7838485 Z" data-astro-cid-3ef6ksr2></path> </svg> </a> </div> </nav> </header>  <main data-astro-cid-dxom2xcl> <article data-astro-cid-dxom2xcl> <div class="hero-image" data-astro-cid-dxom2xcl> <img width="720" height="360" src="/writeup_images/look-at-the-time.png" alt="" data-astro-cid-dxom2xcl> </div> <div class="prose" data-astro-cid-dxom2xcl> <div class="title" data-astro-cid-dxom2xcl> <div class="date" data-astro-cid-dxom2xcl> <time datetime="2025-07-20T16:00:00.000Z"> Jul 20, 2025 </time>  </div> <h1 data-astro-cid-dxom2xcl>ToH CTF 2025 - Look at the Time!</h1> <h3 data-astro-cid-dxom2xcl> by Frank01001</h3> <hr data-astro-cid-dxom2xcl> </div>  <blockquote>
<p>It’s summer. You’re heading back home after an evening at the beach. Looking out of the car window, bored, you tune into the radio. It’s been so long. Listening to this old recording, you can’t even recall exactly when it was.
<br><br>
Submit the date and time of the recording in the format <code>toh{DD-MM-YYYY-HH-MM}</code>. The time should be provided in the local time zone where the audio was recorded.
<br><br>
Hint: The answer isn’t in the file metadata.</p>
</blockquote>
<h2 id="description">Description</h2>
<p>You are given an audio file called <code>summer.m4a</code>. The task is to determine the date and time of the recording based on the content of the audio.</p>
<p><audio controls src="/writeup_files/look-at-the-time/summer.m4a"></audio></p>
<p>The audio was recorded in a car from the radio. It plays music that is a periodic interlude for <a href="https://www.raiplaysound.it/radio1">Rai Radio 1</a>, the top Italian public radio channel. The music is a jingle that plays every hour, and it is followed by a time signal that tells the current time in a coded format.</p>
<p>For international players who may not be familiar with this, it was sufficient to realize that what was playing was a time signal and hear the words “Rai Radio 1”, which can be heard at the start of the clip. By simply searching things like “Rai Time Signal” on Google, it is possible to find a variety of links detailing the structure of the time signal and how to decode it.</p>
<p>Other examples of such transmission can be found on YouTube, such as this one:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/KXq4JYT6S3M?si=CuqGBRfxTwMPVh83" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<h2 id="historical-context">Historical Context</h2>
<p>Between 1979 and 2016, the italian national television and radio broadcast company (RAI) used to broadcast the exact time from the atomic clock of the INRiM, the national institute of metrologic research. After the 31st of December 2016, INRiM exact time stopped being broadcast by radio, in favour of the more efficient and precise Network Time Protocol syncronization. The time signal as of 2022 is still broadcast on Rai Radio 1 for nostalgia purposes, but isn’t used to sync devices anymore.</p>
<h2 id="time-signal-structure">Time Signal Structure</h2>
<p>The following is a diagram that I remastered and translated to English from <a href="https://www.leradiodisophie.it/Immagini-13/src-codice-segnale-orario-inrim.jpg">the original source</a>.</p>
<p><img src="/writeup_files/look-at-the-time/signal_structure.png" alt="Signal Structure"></p>
<p>If the signal was clean, it would be straightforward to decode the content. However, the audio has been recorded on the road and there are even sounds of the car’s turning signals.</p>
<p>Luckily, we know the information in the time signal frames is encoded with Frequency Shift Keying (FSK). That is, the signal is modulated by two different frequencies, one for the “0” bit and one for the “1” bit. 0 corresponds to 2kHz and 1 corresponds to 2.5kHz. The duration of each bit is 30 ms. We can start by filtering the audio to isolate the two frequencies with a bandpass filter.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> numpy </span><span style="color:#4D9375">as</span><span style="color:#DBD7CAEE"> np</span></span>
<span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> matplotlib</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pyplot </span><span style="color:#4D9375">as</span><span style="color:#DBD7CAEE"> plt</span></span>
<span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> wave</span></span>
<span class="line"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> scipy</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">signal </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> butter</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> sosfiltfilt</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> sosfreqz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#758575DD"># 1. parameters you may want to tweak</span></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#DBD7CAEE">wav_path   </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./signal.wav</span><span style="color:#C98A7D77">"</span><span style="color:#758575DD">      # path to your file</span></span>
<span class="line"><span style="color:#DBD7CAEE">f1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> f2     </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 2000</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2500</span><span style="color:#758575DD">          # centre frequencies (Hz)</span></span>
<span class="line"><span style="color:#DBD7CAEE">bw         </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 200</span><span style="color:#758575DD">                 # full bandwidth (Hz)  ⇢  ±bw/2 either side</span></span>
<span class="line"><span style="color:#DBD7CAEE">filter_order </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 8</span><span style="color:#758575DD">                 # 8-pole Butterworth</span></span>
<span class="line"><span style="color:#DBD7CAEE">samples_to_show </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 44100</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 5</span><span style="color:#758575DD">      # 5 s of waveform in the plot</span></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> bandpass</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">signal</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> centre</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> bw</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> fs</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> order</span><span style="color:#CB7676">=</span><span style="color:#4C9A91">8</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#C98A7D77">    """</span></span>
<span class="line"><span style="color:#C98A7D">    Zero-phase Butterworth band-pass using second-order sections.</span></span>
<span class="line"><span style="color:#C98A7D">    centre : centre frequency in Hz</span></span>
<span class="line"><span style="color:#C98A7D">    bw     : full bandwidth in Hz   (pass-band = centre ± bw/2)</span></span>
<span class="line"><span style="color:#C98A7D77">    """</span></span>
<span class="line"><span style="color:#DBD7CAEE">    low  </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> centre </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span></span>
<span class="line"><span style="color:#DBD7CAEE">    high </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> centre </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span></span>
<span class="line"><span style="color:#DBD7CAEE">    sos  </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> butter</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">order</span><span style="color:#666666">,</span><span style="color:#666666"> [</span><span style="color:#DBD7CAEE">low</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> high</span><span style="color:#666666">],</span><span style="color:#BD976A"> btype</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">bandpass</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#BD976A">                  fs</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">fs</span><span style="color:#666666">,</span><span style="color:#BD976A"> output</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">sos</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> sosfiltfilt</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">sos</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> signal</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#758575DD"># open WAV, extract mono float signal</span></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#4D9375">with</span><span style="color:#DBD7CAEE"> wave</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">open</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">wav_path</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rb</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#4D9375"> as</span><span style="color:#DBD7CAEE"> wf</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    n_channels   </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> wf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">getnchannels</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">    sample_width </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> wf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">getsampwidth</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">    fs           </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> wf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">getframerate</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">    n_frames     </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> wf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">getnframes</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#B8A965">    print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">wf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">getparams</span><span style="color:#666666">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">    audio_bytes  </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> wf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">readframes</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">n_frames</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># inter-leaved int16 → mono float32 in [-1,1]</span></span>
<span class="line"><span style="color:#DBD7CAEE">signal </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> np</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">frombuffer</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">audio_bytes</span><span style="color:#666666">,</span><span style="color:#BD976A"> dtype</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">np</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">int16</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">reshape</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> n_channels</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">signal </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> signal</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">mean</span><span style="color:#666666">(</span><span style="color:#BD976A">axis</span><span style="color:#666666">=</span><span style="color:#4C9A91">1</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">astype</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">np</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">float32</span><span style="color:#666666">)</span><span style="color:#CB7676"> /</span><span style="color:#4C9A91"> 32768.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#758575DD"># filter</span></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#DBD7CAEE">filtered1 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> bandpass</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">signal</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> f1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> bw</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> fs</span><span style="color:#666666">,</span><span style="color:#BD976A"> order</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">filter_order</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">filtered2 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> bandpass</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">signal</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> f2</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> bw</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> fs</span><span style="color:#666666">,</span><span style="color:#BD976A"> order</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">filter_order</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#758575DD"># quick frequency-response sanity check (optional)</span></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#DBD7CAEE">w</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> h </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> sosfreqz</span><span style="color:#666666">(</span></span>
<span class="line"><span style="color:#DBD7CAEE">    butter</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">filter_order</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#666666">        [</span><span style="color:#DBD7CAEE">f1</span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> f1</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#666666">],</span></span>
<span class="line"><span style="color:#BD976A">        btype</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">bandpass</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> fs</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">fs</span><span style="color:#666666">,</span><span style="color:#BD976A"> output</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">sos</span><span style="color:#C98A7D77">'</span><span style="color:#666666">),</span></span>
<span class="line"><span style="color:#BD976A">worN</span><span style="color:#666666">=</span><span style="color:#4C9A91">4096</span><span style="color:#666666">,</span><span style="color:#BD976A"> fs</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">fs</span><span style="color:#666666">)</span></span>
<span class="line"></span></code></pre>
<p>Then, to plot the result:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">figure</span><span style="color:#666666">(</span><span style="color:#BD976A">figsize</span><span style="color:#666666">=(</span><span style="color:#4C9A91">6</span><span style="color:#666666">,</span><span style="color:#4C9A91">4</span><span style="color:#666666">))</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">semilogx</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">w</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 20</span><span style="color:#CB7676">*</span><span style="color:#DBD7CAEE">np</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log10</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">np</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">abs</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">h</span><span style="color:#666666">)))</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">title</span><span style="color:#666666">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">filter_order</span><span style="color:#C99076">}</span><span style="color:#C98A7D">-pole band-pass </span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">f1</span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D">–</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">f1</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D"> Hz'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">xlabel</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Frequency (Hz)</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE">; plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ylabel</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Magnitude (dB)</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">(</span><span style="color:#4D9375">True</span><span style="color:#666666">,</span><span style="color:#BD976A"> which</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">both</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> ls</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">tight_layout</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">show</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#758575DD"># time-domain plot (first few seconds)</span></span>
<span class="line"><span style="color:#758575DD"># ------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#DBD7CAEE">time </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> np</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">arange</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">signal</span><span style="color:#666666">))</span><span style="color:#CB7676"> /</span><span style="color:#DBD7CAEE"> fs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">fig</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> axs </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">subplots</span><span style="color:#666666">(</span><span style="color:#4C9A91">2</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#BD976A"> figsize</span><span style="color:#666666">=(</span><span style="color:#4C9A91">12</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 8</span><span style="color:#666666">),</span><span style="color:#BD976A"> sharex</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">plot</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">time</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> signal</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">],</span></span>
<span class="line"><span style="color:#BD976A">            color</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">0.6</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> lw</span><span style="color:#666666">=</span><span style="color:#4C9A91">0.7</span><span style="color:#666666">,</span><span style="color:#BD976A"> label</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Original</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">plot</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">time</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> filtered1</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">],</span></span>
<span class="line"><span style="color:#BD976A">            label</span><span style="color:#666666">=</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'Filtered </span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">f1</span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D">-</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">f1</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D"> Hz'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">set_ylabel</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Amplitude</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">set_title</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Band-pass around </span><span style="color:#C99076">{</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D"> Hz</span><span style="color:#C98A7D77">'</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">format</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">f1</span><span style="color:#666666">))</span></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">legend</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">plot</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">time</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> signal</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">],</span></span>
<span class="line"><span style="color:#BD976A">            color</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">0.6</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> lw</span><span style="color:#666666">=</span><span style="color:#4C9A91">0.7</span><span style="color:#666666">,</span><span style="color:#BD976A"> label</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Original</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">plot</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">time</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> filtered2</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">],</span></span>
<span class="line"><span style="color:#BD976A">            label</span><span style="color:#666666">=</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'Filtered </span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">f2</span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D">-</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">f2</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D"> Hz'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">set_ylabel</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Amplitude</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">set_xlabel</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Time (s)</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">set_title</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Band-pass around </span><span style="color:#C99076">{</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D"> Hz</span><span style="color:#C98A7D77">'</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">format</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">f2</span><span style="color:#666666">))</span></span>
<span class="line"><span style="color:#DBD7CAEE">axs</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">legend</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">tight_layout</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">show</span><span style="color:#666666">()</span></span>
<span class="line"></span></code></pre>
<p><img src="/writeup_files/look-at-the-time/poles.png" alt="poles">
<img src="/writeup_files/look-at-the-time/filters_raw.png" alt="Filtered Signal"></p>
<p>This is not very easy to visualize in detail, so let’s try to highlight the two frequencies with different colors.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#758575DD"># Show the first 2 seconds of both filtered signals together</span></span>
<span class="line"><span style="color:#DBD7CAEE">samples_to_show </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 44100</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 2</span><span style="color:#758575DD">  # 2 seconds</span></span>
<span class="line"><span style="color:#DBD7CAEE">grid_interval_ms </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 30</span><span style="color:#758575DD">  # 30ms grid lines</span></span>
<span class="line"><span style="color:#DBD7CAEE">grid_interval_samples </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid_interval_ms </span><span style="color:#CB7676">/</span><span style="color:#4C9A91"> 1000</span><span style="color:#CB7676"> *</span><span style="color:#DBD7CAEE"> fs</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">grid_start_ms </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 10</span><span style="color:#758575DD">  # Start position of first grid line (in ms)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">figure</span><span style="color:#666666">(</span><span style="color:#BD976A">figsize</span><span style="color:#666666">=(</span><span style="color:#4C9A91">14</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 6</span><span style="color:#666666">))</span></span>
<span class="line"><span style="color:#DBD7CAEE">time </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> np</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">arange</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">)</span><span style="color:#CB7676"> /</span><span style="color:#DBD7CAEE"> fs  </span><span style="color:#758575DD"># time in seconds for x-axis</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># Plot both filtered signals</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">plot</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">time</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> filtered1</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#BD976A">         color</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">blue</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> lw</span><span style="color:#666666">=</span><span style="color:#4C9A91">1.2</span><span style="color:#666666">,</span><span style="color:#BD976A"> alpha</span><span style="color:#666666">=</span><span style="color:#4C9A91">0.8</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#BD976A">         label</span><span style="color:#666666">=</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'Band-pass </span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">f1</span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D">-</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">f1</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D"> Hz'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">plot</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">time</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> filtered2</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE">samples_to_show</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#BD976A">         color</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">green</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> lw</span><span style="color:#666666">=</span><span style="color:#4C9A91">1.2</span><span style="color:#666666">,</span><span style="color:#BD976A"> alpha</span><span style="color:#666666">=</span><span style="color:#4C9A91">0.8</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#BD976A">         label</span><span style="color:#666666">=</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'Band-pass </span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">f2</span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D">-</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">f2</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">bw</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">2</span><span style="color:#CB7676">:.0f</span><span style="color:#C99076">}</span><span style="color:#C98A7D"> Hz'</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># Add vertical grid lines every 30ms, starting from grid_start_ms</span></span>
<span class="line"><span style="color:#DBD7CAEE">grid_positions </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> np</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">arange</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid_start_ms</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">1000</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> time</span><span style="color:#666666">[</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> grid_interval_ms</span><span style="color:#CB7676">/</span><span style="color:#4C9A91">1000</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> pos </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> grid_positions</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">axvline</span><span style="color:#666666">(</span><span style="color:#BD976A">x</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">pos</span><span style="color:#666666">,</span><span style="color:#BD976A"> color</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">red</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> linestyle</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> alpha</span><span style="color:#666666">=</span><span style="color:#4C9A91">0.5</span><span style="color:#666666">,</span><span style="color:#BD976A"> linewidth</span><span style="color:#666666">=</span><span style="color:#4C9A91">0.8</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># Add labels and legend</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">xlabel</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Time (s)</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ylabel</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Amplitude</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">title</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Comparison of Band-pass Filtered Signals (2 seconds)</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">legend</span><span style="color:#666666">(</span><span style="color:#BD976A">loc</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">upper right</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">(</span><span style="color:#4D9375">True</span><span style="color:#666666">,</span><span style="color:#BD976A"> which</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">major</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> axis</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">y</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> alpha</span><span style="color:#666666">=</span><span style="color:#4C9A91">0.3</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">tight_layout</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">plt</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">show</span><span style="color:#666666">()</span></span>
<span class="line"></span></code></pre>
<p>This plot shows the signal intensities colored by frequency. The blue line represents the 2kHz signal, and the green line represents the 2.5kHz signal. The red vertical lines indicate the 30ms intervals where the bits are transmitted.</p>
<p>The small numbers in each bit of multi-bit blocks correspond to values that should be summed to form the final value. For example, in the reference of the structure, the value of the Hour is 10 + 2 + 1 = 13, whereas the value of minutes is 20 + 4 + 2 = 26 which corresponds to 1:26 PM</p>
<p>Parity computation is odd, which means that the parity bit is 1 if the number of 1s in the frame is odd, and 0 if it is even.</p>
<p><img src="/writeup_files/look-at-the-time/colored_filtered.png" alt="Better Filtered Signal"></p>
<p>Since the signal is noisy, we need to reason on what we have. Some values of bits will be likely to be correct (when adjacent bits are the same), while others will have a degree of uncertainty (when adjacent bits are different).</p>
<ol>
<li>
<p>First, the first two bits of each frame are always the same (code segment identifiers). As such, we know that for a well-formed frame, the first two bits should be “01”. The start of the second frame is instead always “10”.</p>
</li>
<li>
<p>At the same time, we can proceed to pin values of bits where no change occurs (high confidence bits).</p>
</li>
</ol>
<p><img src="/writeup_files/look-at-the-time/5.jpg" alt="5"></p>
<ol start="3">
<li>
<p>Minutes are 40 + x + 2 + 1. x cannot be 20, as it would exceed the maximum value of 59. So, the bit corresponding to 20 is 0. Thus, the value of minutes can either be 43 or 47. Let’s leave it in doubt for now.</p>
</li>
<li>
<p>We can do a similar reasoning for the hours. Given the confident bits, the bit corresponding to 10 must be 0 (the 20 bit is surely 1). As such, the hour can either be 21 or 23.</p>
</li>
<li>
<p>The time zone is surely CEST (UTC+2), because the bit is in a high confidence zone of 1.</p>
</li>
<li>
<p>P1 looks like is more likely to be 1 than zero. In fact, even though it is mixed, there is a clear peak for the frequency of 2kHz. Since parity is odd, we need the sum of bits (including parity) to be odd. The value of P1 is 0, so the number of preceding 1s is even. This means remaining bits will need to have the same value. Either both are 0 or both are 1.<br><br>
This means the time was either 21:43 or 23:47.</p>
</li>
<li>
<p>Month is either 3 or 7 (March or July). Looking at Italian Leap second history on Google, we can see they either happen in June or December. So the bits for leap second are all 0s (no leap second).</p>
</li>
</ol>
<p><img src="/writeup_files/look-at-the-time/6.jpg" alt="6"></p>
<ol start="8">
<li>Looking at the sharp transition between the bit for 10 and 8 of the Year, we can tell that it’s likely they are a 1 and a 0 respectively. This means the year is x + 10 + 4 + 2 + 1 = either 2017 or 2037. The challenge mentions nostalgia for the past, not looking forward to the future, so we can assume the year is 2017.</li>
</ol>
<p><img src="/writeup_files/look-at-the-time/7.jpg" alt="7"></p>
<ol start="9">
<li>Now in the second frame we are just missing the parity bit and the last bit for the Time Zone change. The parity bit is likely one, since the signal ends with a 2.5kHz tail. So the sum of bits (including parity) is odd. The time zone change bit is likely 0, since the signal ends with a 2.5kHz tail. We already have 7 bits of 1s, so the remaining bit must be 1 to make the total number of 1s odd.</li>
</ol>
<p><img src="/writeup_files/look-at-the-time/8.jpg" alt="8"></p>
<ol start="10">
<li>The Time Zone Change block is 111, which means no change in time zone is scheduled for the next 7 days. Again, searching on Google, we can see that in 2017 the time zone changed from CET to CEST on March 26 and from CEST to CET on October 29. Possible days of the month with bits we have pinned are 8, 12, 18, 22, 28. If this is March, we can only have the 28th (it is already summer time), otherwise, we can have any the above. Given the shape of the peaks, the most likely is th 18th. As such, it’s unlikely to be March, so we can assume the date is July 18th. This assumption would fit with the transition we have in the block that indicates the day of the week, which looks to be a 2 (Tuesday). July 18th, 2017 was a Tuesday.</li>
</ol>
<p><img src="/writeup_files/look-at-the-time/9.jpg" alt="9"></p>
<ol start="11">
<li>Finally, we break the last assumption. Between the two remaining bits, the one in the Hours and the one in the Minutes, the one in the Hours is less uncertain. It looks like the 2.5kHz signal, while less intense, is mounting right at the start of the 30 ms block. On the contrary, the 2kHz signal is clearly decreasing during the block. That being the case, both bits are likely 1, which means the time is 23:47.</li>
</ol>
<p>Thus, the final information block is
01100011100011110001110110000101 1000010111111001</p>
<p>Date Tuesday July 18 2017 23:47 CEST</p>
<p>Thus, the flag is <code>toh{18-07-2017-23-47}</code>.</p>
<p>To read more about the INRiM time signal, as well as a working python implementation of the encoder and (more or less) decoder, you can check out my <a href="https://github.com/Frank01001/pyRAIsrc/">pyRAIsrc</a>, which was made private during the CTF to avoid OSINTs, but is now public again.</p>  </div> </article> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2025 Tower of Hanoi. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte> <a href="https://twitter.com/towerofhanoi" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Tower of Hanoi on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-sz7xmlte><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/towerofhanoi" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Tower of Haoi's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://ctftime.org/team/300" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Tower of Hanoi's CTF Time page</span> <svg viewBox="0 0 16 16" width="32" height="32" data-astro-cid-sz7xmlte> <path fill="currentColor" d="M 0,0 H 16 V 16 H 0 L 4.7205698,7.7838485 Z" data-astro-cid-sz7xmlte></path> </svg> </a> </div> </footer>  </body></html>